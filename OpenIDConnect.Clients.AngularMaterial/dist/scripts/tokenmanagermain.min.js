!function(){function hex2b64(h){var i,c,ret="";for(i=0;i+3<=h.length;i+=3)c=parseInt(h.substring(i,i+3),16),ret+=b64map.charAt(c>>6)+b64map.charAt(63&c);if(i+1==h.length?(c=parseInt(h.substring(i,i+1),16),ret+=b64map.charAt(c<<2)):i+2==h.length&&(c=parseInt(h.substring(i,i+2),16),ret+=b64map.charAt(c>>2)+b64map.charAt((3&c)<<4)),b64pad)for(;(3&ret.length)>0;)ret+=b64pad;return ret}function b64tohex(s){var i,slop,v,ret="",k=0;for(i=0;i<s.length&&s.charAt(i)!=b64pad;++i)v=b64map.indexOf(s.charAt(i)),0>v||(0==k?(ret+=int2char(v>>2),slop=3&v,k=1):1==k?(ret+=int2char(slop<<2|v>>4),slop=15&v,k=2):2==k?(ret+=int2char(slop),ret+=int2char(v>>2),slop=3&v,k=3):(ret+=int2char(slop<<2|v>>4),ret+=int2char(15&v),k=0));return 1==k&&(ret+=int2char(slop<<2)),ret}function b64toBA(s){var i,h=b64tohex(s),a=new Array;for(i=0;2*i<h.length;++i)a[i]=parseInt(h.substring(2*i,2*i+2),16);return a}function BigInteger(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){for(;--n>=0;){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864),w[j++]=67108863&v}return c}function am2(i,x,w,j,c,n){for(var xl=32767&x,xh=x>>15;--n>=0;){var l=32767&this[i],h=this[i++]>>15,m=xh*l+h*xl;l=xl*l+((32767&m)<<15)+w[j]+(1073741823&c),c=(l>>>30)+(m>>>15)+xh*h+(c>>>30),w[j++]=1073741823&l}return c}function am3(i,x,w,j,c,n){for(var xl=16383&x,xh=x>>14;--n>=0;){var l=16383&this[i],h=this[i++]>>14,m=xh*l+h*xl;l=xl*l+((16383&m)<<14)+w[j]+c,c=(l>>28)+(m>>14)+xh*h,w[j++]=268435455&l}return c}function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return null==c?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t,r.s=this.s}function bnpFromInt(x){this.t=1,this.s=0>x?-1:0,x>0?this[0]=x:-1>x?this[0]=x+this.DV:this.t=0}function nbv(i){var r=nbi();return r.fromInt(i),r}function bnpFromString(s,b){var k;if(16==b)k=4;else if(8==b)k=3;else if(256==b)k=8;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return void this.fromRadix(s,b);k=2}this.t=0,this.s=0;for(var i=s.length,mi=!1,sh=0;--i>=0;){var x=8==k?255&s[i]:intAt(s,i);0>x?"-"==s.charAt(i)&&(mi=!0):(mi=!1,0==sh?this[this.t++]=x:sh+k>this.DB?(this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh,this[this.t++]=x>>this.DB-sh):this[this.t-1]|=x<<sh,sh+=k,sh>=this.DB&&(sh-=this.DB))}8==k&&0!=(128&s[0])&&(this.s=-1,sh>0&&(this[this.t-1]|=(1<<this.DB-sh)-1<<sh)),this.clamp(),mi&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var c=this.s&this.DM;this.t>0&&this[this.t-1]==c;)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(16==b)k=4;else if(8==b)k=3;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return this.toRadix(b);k=2}var d,km=(1<<k)-1,m=!1,r="",i=this.t,p=this.DB-i*this.DB%k;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)>0&&(m=!0,r=int2char(d));i>=0;)k>p?(d=(this[i]&(1<<p)-1)<<k-p,d|=this[--i]>>(p+=this.DB-k)):(d=this[i]>>(p-=k)&km,0>=p&&(p+=this.DB,--i)),d>0&&(m=!0),m&&(r+=int2char(d));return m?r:"0"}function bnNegate(){var r=nbi();return BigInteger.ZERO.subTo(this,r),r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(0!=r)return r;var i=this.t;if(r=i-a.t,0!=r)return this.s<0?-r:r;for(;--i>=0;)if(0!=(r=this[i]-a[i]))return r;return 0}function nbits(x){var t,r=1;return 0!=(t=x>>>16)&&(x=t,r+=16),0!=(t=x>>8)&&(x=t,r+=8),0!=(t=x>>4)&&(x=t,r+=4),0!=(t=x>>2)&&(x=t,r+=2),0!=(t=x>>1)&&(x=t,r+=1),r}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n,r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0),r.s=this.s}function bnpLShiftTo(n,r){var i,bs=n%this.DB,cbs=this.DB-bs,bm=(1<<cbs)-1,ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM;for(i=this.t-1;i>=0;--i)r[i+ds+1]=this[i]>>cbs|c,c=(this[i]&bm)<<bs;for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c,r.t=this.t+ds+1,r.s=this.s,r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t)return void(r.t=0);var bs=n%this.DB,cbs=this.DB-bs,bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i)r[i-ds-1]|=(this[i]&bm)<<cbs,r[i-ds]=this[i]>>bs;bs>0&&(r[this.t-ds-1]|=(this.s&bm)<<cbs),r.t=this.t-ds,r.clamp()}function bnpSubTo(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);m>i;)c+=this[i]-a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c-=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c-=a[i],r[i++]=c&this.DM,c>>=this.DB;c-=a.s}r.s=0>c?-1:0,-1>c?r[i++]=this.DV+c:c>0&&(r[i++]=c),r.t=i,r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs(),i=x.t;for(r.t=i+y.t;--i>=0;)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0,r.clamp(),this.s!=a.s&&BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){for(var x=this.abs(),i=r.t=2*x.t;--i>=0;)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);(r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV&&(r[i+x.t]-=x.DV,r[i+x.t+1]=1)}r.t>0&&(r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)),r.s=0,r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(!(pm.t<=0)){var pt=this.abs();if(pt.t<pm.t)return null!=q&&q.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=nbi());var y=nbi(),ts=this.s,ms=m.s,nsh=this.DB-nbits(pm[pm.t-1]);nsh>0?(pm.lShiftTo(nsh,y),pt.lShiftTo(nsh,r)):(pm.copyTo(y),pt.copyTo(r));var ys=y.t,y0=y[ys-1];if(0!=y0){var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0),d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2,i=r.t,j=i-ys,t=null==q?nbi():q;for(y.dlShiftTo(j,t),r.compareTo(t)>=0&&(r[r.t++]=1,r.subTo(t,r)),BigInteger.ONE.dlShiftTo(ys,t),t.subTo(y,y);y.t<ys;)y[y.t++]=0;for(;--j>=0;){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd)for(y.dlShiftTo(j,t),r.subTo(t,r);r[i]<--qd;)r.subTo(t,r)}null!=q&&(r.drShiftTo(ys,q),ts!=ms&&BigInteger.ZERO.subTo(q,q)),r.t=ys,r.clamp(),nsh>0&&r.rShiftTo(nsh,r),0>ts&&BigInteger.ZERO.subTo(r,r)}}}function bnMod(a){var r=nbi();return this.abs().divRemTo(a,null,r),this.s<0&&r.compareTo(BigInteger.ZERO)>0&&a.subTo(r,r),r}function Classic(m){this.m=m}function cConvert(x){return x.s<0||x.compareTo(this.m)>=0?x.mod(this.m):x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function cSqrTo(x,r){x.squareTo(r),this.reduce(r)}function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if(0==(1&x))return 0;var y=3&x;return y=y*(2-(15&x)*y)&15,y=y*(2-(255&x)*y)&255,y=y*(2-((65535&x)*y&65535))&65535,y=y*(2-x*y%this.DV)%this.DV,y>0?this.DV-y:-y}function Montgomery(m){this.m=m,this.mp=m.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function montConvert(x){var r=nbi();return x.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),x.s<0&&r.compareTo(BigInteger.ZERO)>0&&this.m.subTo(r,r),r}function montRevert(x){var r=nbi();return x.copyTo(r),this.reduce(r),r}function montReduce(x){for(;x.t<=this.mt2;)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=32767&x[i],u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;for(j=i+this.m.t,x[j]+=this.m.am(0,u0,x,i,0,this.m.t);x[j]>=x.DV;)x[j]-=x.DV,x[++j]++}x.clamp(),x.drShiftTo(this.m.t,x),x.compareTo(this.m)>=0&&x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r),this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)}function bnpExp(e,z){if(e>4294967295||1>e)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;for(g.copyTo(r);--i>=0;)if(z.sqrTo(r,r2),(e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2,r2=t}return z.revert(r)}function bnModPowInt(e,m){var z;return z=256>e||m.isEven()?new Classic(m):new Montgomery(m),this.exp(e,z)}function bnClone(){var r=nbi();return this.copyTo(r),r}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(b){if(null==b&&(b=10),0==this.signum()||2>b||b>36)return"0";var cs=this.chunkSize(b),a=Math.pow(b,cs),d=nbv(a),y=nbi(),z=nbi(),r="";for(this.divRemTo(d,y,z);y.signum()>0;)r=(a+z.intValue()).toString(b).substr(1)+r,y.divRemTo(d,y,z);return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0),null==b&&(b=10);for(var cs=this.chunkSize(b),d=Math.pow(b,cs),mi=!1,j=0,w=0,i=0;i<s.length;++i){var x=intAt(s,i);0>x?"-"==s.charAt(i)&&0==this.signum()&&(mi=!0):(w=b*w+x,++j>=cs&&(this.dMultiply(d),this.dAddOffset(w,0),j=0,w=0))}j>0&&(this.dMultiply(Math.pow(b,j)),this.dAddOffset(w,0)),mi&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(BigInteger.ONE.shiftLeft(a-1),this);else{var x=new Array,t=7&a;x.length=(a>>3)+1,b.nextBytes(x),t>0?x[0]&=(1<<t)-1:x[0]=0,this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var d,p=this.DB-i*this.DB%8,k=0;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p&&(r[k++]=d|this.s<<this.DB-p);i>=0;)8>p?(d=(this[i]&(1<<p)-1)<<8-p,d|=this[--i]>>(p+=this.DB-8)):(d=this[i]>>(p-=8)&255,0>=p&&(p+=this.DB,--i)),0!=(128&d)&&(d|=-256),0==k&&(128&this.s)!=(128&d)&&++k,(k>0||d!=this.s)&&(r[k++]=d);return r}function bnEquals(a){return 0==this.compareTo(a)}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;m>i;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){for(f=a.s&this.DM,i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{for(f=this.s&this.DM,i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s),r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();return this.bitwiseTo(a,op_and,r),r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();return this.bitwiseTo(a,op_or,r),r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();return this.bitwiseTo(a,op_xor,r),r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();return this.bitwiseTo(a,op_andnot,r),r}function bnNot(){for(var r=nbi(),i=0;i<this.t;++i)r[i]=this.DM&~this[i];return r.t=this.t,r.s=~this.s,r}function bnShiftLeft(n){var r=nbi();return 0>n?this.rShiftTo(-n,r):this.lShiftTo(n,r),r}function bnShiftRight(n){var r=nbi();return 0>n?this.lShiftTo(-n,r):this.rShiftTo(n,r),r}function lbit(x){if(0==x)return-1;var r=0;return 0==(65535&x)&&(x>>=16,r+=16),0==(255&x)&&(x>>=8,r+=8),0==(15&x)&&(x>>=4,r+=4),0==(3&x)&&(x>>=2,r+=2),0==(1&x)&&++r,r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(0!=this[i])return i*this.DB+lbit(this[i]);return this.s<0?this.t*this.DB:-1}function cbit(x){for(var r=0;0!=x;)x&=x-1,++r;return r}function bnBitCount(){for(var r=0,x=this.s&this.DM,i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);return j>=this.t?0!=this.s:0!=(this[j]&1<<n%this.DB)}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);return this.bitwiseTo(r,op,r),r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);m>i;)c+=this[i]+a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c+=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c+=a[i],r[i++]=c&this.DM,c>>=this.DB;c+=a.s}r.s=0>c?-1:0,c>0?r[i++]=c:-1>c&&(r[i++]=this.DV+c),r.t=i,r.clamp()}function bnAdd(a){var r=nbi();return this.addTo(a,r),r}function bnSubtract(a){var r=nbi();return this.subTo(a,r),r}function bnMultiply(a){var r=nbi();return this.multiplyTo(a,r),r}function bnSquare(){var r=nbi();return this.squareTo(r),r}function bnDivide(a){var r=nbi();return this.divRemTo(a,r,null),r}function bnRemainder(a){var r=nbi();return this.divRemTo(a,null,r),r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();return this.divRemTo(a,q,r),new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(n,w){if(0!=n){for(;this.t<=w;)this[this.t++]=0;for(this[w]+=n;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);for(r.s=0,r.t=i;i>0;)r[--i]=0;var j;for(j=r.t-this.t;j>i;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);j>i;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;for(r.s=0;--i>=0;)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp(),r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);if(x.compareTo(this.m)<0)return x;var r=nbi();return x.copyTo(r),this.reduce(r),r}function barrettRevert(x){return x}function barrettReduce(x){for(x.drShiftTo(this.m.t-1,this.r2),x.t>this.m.t+1&&(x.t=this.m.t+1,x.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);x.compareTo(this.r2)<0;)x.dAddOffset(1,this.m.t+1);for(x.subTo(this.r2,x);x.compareTo(this.m)>=0;)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r),this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function bnModPow(e,m){var k,z,i=e.bitLength(),r=nbv(1);if(0>=i)return r;k=18>i?1:48>i?3:144>i?4:768>i?5:6,z=8>i?new Classic(m):m.isEven()?new Barrett(m):new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;if(g[1]=z.convert(this),k>1){var g2=nbi();for(z.sqrTo(g[1],g2);km>=n;)g[n]=nbi(),z.mulTo(g2,g[n-2],g[n]),n+=2}var w,t,j=e.t-1,is1=!0,r2=nbi();for(i=nbits(e[j])-1;j>=0;){for(i>=k1?w=e[j]>>i-k1&km:(w=(e[j]&(1<<i+1)-1)<<k1-i,j>0&&(w|=e[j-1]>>this.DB+i-k1)),n=k;0==(1&w);)w>>=1,--n;if((i-=n)<0&&(i+=this.DB,--j),is1)g[w].copyTo(r),is1=!1;else{for(;n>1;)z.sqrTo(r,r2),z.sqrTo(r2,r),n-=2;n>0?z.sqrTo(r,r2):(t=r,r=r2,r2=t),z.mulTo(r2,g[w],r)}for(;j>=0&&0==(e[j]&1<<i);)z.sqrTo(r,r2),t=r,r=r2,r2=t,--i<0&&(i=this.DB-1,--j)}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone(),y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y,y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(0>g)return x;for(g>i&&(g=i),g>0&&(x.rShiftTo(g,x),y.rShiftTo(g,y));x.signum()>0;)(i=x.getLowestSetBit())>0&&x.rShiftTo(i,x),(i=y.getLowestSetBit())>0&&y.rShiftTo(i,y),x.compareTo(y)>=0?(x.subTo(y,x),x.rShiftTo(1,x)):(y.subTo(x,y),y.rShiftTo(1,y));return g>0&&y.lShiftTo(g,y),y}function bnpModInt(n){if(0>=n)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(0==d)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||0==m.signum())return BigInteger.ZERO;for(var u=m.clone(),v=this.clone(),a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);0!=u.signum();){for(;u.isEven();)u.rShiftTo(1,u),ac?(a.isEven()&&b.isEven()||(a.addTo(this,a),b.subTo(m,b)),a.rShiftTo(1,a)):b.isEven()||b.subTo(m,b),b.rShiftTo(1,b);for(;v.isEven();)v.rShiftTo(1,v),ac?(c.isEven()&&d.isEven()||(c.addTo(this,c),d.subTo(m,d)),c.rShiftTo(1,c)):d.isEven()||d.subTo(m,d),d.rShiftTo(1,d);u.compareTo(v)>=0?(u.subTo(v,u),ac&&a.subTo(c,a),b.subTo(d,b)):(v.subTo(u,v),ac&&c.subTo(a,c),d.subTo(b,d))}return 0!=v.compareTo(BigInteger.ONE)?BigInteger.ZERO:d.compareTo(m)>=0?d.subtract(m):d.signum()<0?(d.addTo(m,d),d.signum()<0?d.add(m):d):d}function bnIsProbablePrime(t){var i,x=this.abs();if(1==x.t&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return!0;return!1}if(x.isEven())return!1;for(i=1;i<lowprimes.length;){for(var m=lowprimes[i],j=i+1;j<lowprimes.length&&lplim>m;)m*=lowprimes[j++];for(m=x.modInt(m);j>i;)if(m%lowprimes[i++]==0)return!1}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE),k=n1.getLowestSetBit();if(0>=k)return!1;var r=n1.shiftRight(k);t=t+1>>1,t>lowprimes.length&&(t=lowprimes.length);for(var a=nbi(),i=0;t>i;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(0!=y.compareTo(BigInteger.ONE)&&0!=y.compareTo(n1)){for(var j=1;j++<k&&0!=y.compareTo(n1);)if(y=y.modPowInt(2,this),0==y.compareTo(BigInteger.ONE))return!1;if(0!=y.compareTo(n1))return!1}}return!0}function parseBigInt(str,r){return new BigInteger(str,r)}function linebrk(s,n){for(var ret="",i=0;i+n<s.length;)ret+=s.substring(i,i+n)+"\n",i+=n;return ret+s.substring(i,s.length)}function byte2Hex(b){return 16>b?"0"+b.toString(16):b.toString(16)}function pkcs1pad2(s,n){if(n<s.length+11)return alert("Message too long for RSA"),null;for(var ba=new Array,i=s.length-1;i>=0&&n>0;){var c=s.charCodeAt(i--);128>c?ba[--n]=c:c>127&&2048>c?(ba[--n]=63&c|128,ba[--n]=c>>6|192):(ba[--n]=63&c|128,ba[--n]=c>>6&63|128,ba[--n]=c>>12|224)}ba[--n]=0;for(var rng=new SecureRandom,x=new Array;n>2;){for(x[0]=0;0==x[0];)rng.nextBytes(x);ba[--n]=x[0]}return ba[--n]=2,ba[--n]=0,new BigInteger(ba)}function oaep_mgf1_arr(seed,len,hash){for(var mask="",i=0;mask.length<len;)mask+=hash(String.fromCharCode.apply(String,seed.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return mask}function oaep_pad(s,n,hash){if(s.length+2*SHA1_SIZE+2>n)throw"Message too long for RSA";var i,PS="";for(i=0;i<n-s.length-2*SHA1_SIZE-2;i+=1)PS+="\x00";var DB=rstr_sha1("")+PS+""+s,seed=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(seed);var dbMask=oaep_mgf1_arr(seed,DB.length,hash||rstr_sha1),maskedDB=[];for(i=0;i<DB.length;i+=1)maskedDB[i]=DB.charCodeAt(i)^dbMask.charCodeAt(i);var seedMask=oaep_mgf1_arr(maskedDB,seed.length,rstr_sha1),maskedSeed=[0];for(i=0;i<seed.length;i+=1)maskedSeed[i+1]=seed[i]^seedMask.charCodeAt(i);return new BigInteger(maskedSeed.concat(maskedDB))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(N,E){this.isPublic=!0,"string"!=typeof N?(this.n=N,this.e=E):null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16)):alert("Invalid RSA public key")}function RSADoPublic(x){return x.modPowInt(this.e,this.n)}function RSAEncrypt(text){var m=pkcs1pad2(text,this.n.bitLength()+7>>3);if(null==m)return null;var c=this.doPublic(m);if(null==c)return null;var h=c.toString(16);return 0==(1&h.length)?h:"0"+h}function RSAEncryptOAEP(text,hash){var m=oaep_pad(text,this.n.bitLength()+7>>3,hash);if(null==m)return null;var c=this.doPublic(m);if(null==c)return null;var h=c.toString(16);return 0==(1&h.length)?h:"0"+h}function pkcs1unpad2(d,n){for(var b=d.toByteArray(),i=0;i<b.length&&0==b[i];)++i;if(b.length-i!=n-1||2!=b[i])return null;for(++i;0!=b[i];)if(++i>=b.length)return null;for(var ret="";++i<b.length;){var c=255&b[i];128>c?ret+=String.fromCharCode(c):c>191&&224>c?(ret+=String.fromCharCode((31&c)<<6|63&b[i+1]),++i):(ret+=String.fromCharCode((15&c)<<12|(63&b[i+1])<<6|63&b[i+2]),i+=2)}return ret}function oaep_mgf1_str(seed,len,hash){for(var mask="",i=0;mask.length<len;)mask+=hash(seed+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])),i+=1;return mask}function oaep_unpad(d,n,hash){d=d.toByteArray();var i;for(i=0;i<d.length;i+=1)d[i]&=255;for(;d.length<n;)d.unshift(0);if(d=String.fromCharCode.apply(String,d),d.length<2*SHA1_SIZE+2)throw"Cipher too short";var i,maskedSeed=d.substr(1,SHA1_SIZE),maskedDB=d.substr(SHA1_SIZE+1),seedMask=oaep_mgf1_str(maskedDB,SHA1_SIZE,hash||rstr_sha1),seed=[];for(i=0;i<maskedSeed.length;i+=1)seed[i]=maskedSeed.charCodeAt(i)^seedMask.charCodeAt(i);var dbMask=oaep_mgf1_str(String.fromCharCode.apply(String,seed),d.length-SHA1_SIZE,rstr_sha1),DB=[];for(i=0;i<maskedDB.length;i+=1)DB[i]=maskedDB.charCodeAt(i)^dbMask.charCodeAt(i);if(DB=String.fromCharCode.apply(String,DB),DB.substr(0,SHA1_SIZE)!==rstr_sha1(""))throw"Hash mismatch";DB=DB.substr(SHA1_SIZE);var first_one=DB.indexOf(""),last_zero=-1!=first_one?DB.substr(0,first_one).lastIndexOf("\x00"):-1;if(last_zero+1!=first_one)throw"Malformed data";return DB.substr(first_one+1)}function RSASetPrivate(N,E,D){this.isPrivate=!0,"string"!=typeof N?(this.n=N,this.e=E,this.d=D):null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16),this.d=parseBigInt(D,16)):alert("Invalid RSA private key")}function RSASetPrivateEx(N,E,D,P,Q,DP,DQ,C){if(this.isPrivate=!0,null==N)throw"RSASetPrivateEx N == null";if(null==E)throw"RSASetPrivateEx E == null";if(0==N.length)throw"RSASetPrivateEx N.length == 0";if(0==E.length)throw"RSASetPrivateEx E.length == 0";null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16),this.d=parseBigInt(D,16),this.p=parseBigInt(P,16),this.q=parseBigInt(Q,16),this.dmp1=parseBigInt(DP,16),this.dmq1=parseBigInt(DQ,16),this.coeff=parseBigInt(C,16)):alert("Invalid RSA private key in RSASetPrivateEx")}function RSAGenerate(B,E){var rng=new SecureRandom,qs=B>>1;this.e=parseInt(E,16);for(var ee=new BigInteger(E,16);;){for(;this.p=new BigInteger(B-qs,1,rng),0!=this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(qs,1,rng),0!=this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var t=this.p;this.p=this.q,this.q=t}var p1=this.p.subtract(BigInteger.ONE),q1=this.q.subtract(BigInteger.ONE),phi=p1.multiply(q1);if(0==phi.gcd(ee).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=ee.modInverse(phi),this.dmp1=this.d.mod(p1),this.dmq1=this.d.mod(q1),this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=!0}function RSADoPrivate(x){if(null==this.p||null==this.q)return x.modPow(this.d,this.n);for(var xp=x.mod(this.p).modPow(this.dmp1,this.p),xq=x.mod(this.q).modPow(this.dmq1,this.q);xp.compareTo(xq)<0;)xp=xp.add(this.p);return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq)}function RSADecrypt(ctext){var c=parseBigInt(ctext,16),m=this.doPrivate(c);return null==m?null:pkcs1unpad2(m,this.n.bitLength()+7>>3)}function RSADecryptOAEP(ctext,hash){var c=parseBigInt(ctext,16),m=this.doPrivate(c);return null==m?null:oaep_unpad(m,this.n.bitLength()+7>>3,hash)}function _rsapem_pemToBase64(sPEMPrivateKey){var s=sPEMPrivateKey;return s=s.replace("-----BEGIN RSA PRIVATE KEY-----",""),s=s.replace("-----END RSA PRIVATE KEY-----",""),s=s.replace(/[ \n]+/g,"")}function _rsapem_getPosArrayOfChildrenFromHex(hPrivateKey){var a=new Array,v1=ASN1HEX.getStartPosOfV_AtObj(hPrivateKey,0),n1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,v1),e1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,n1),d1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,e1),p1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,d1),q1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,p1),dp1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,q1),dq1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dp1),co1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dq1);return a.push(v1,n1,e1,d1,p1,q1,dp1,dq1,co1),a}function _rsapem_getHexValueArrayOfChildrenFromHex(hPrivateKey){var posArray=_rsapem_getPosArrayOfChildrenFromHex(hPrivateKey),v=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[0]),n=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[1]),e=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[2]),d=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[3]),p=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[4]),q=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[5]),dp=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[6]),dq=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[7]),co=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[8]),a=new Array;return a.push(v,n,e,d,p,q,dp,dq,co),a}function _rsapem_readPrivateKeyFromASN1HexString(keyHex){var a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function _rsapem_readPrivateKeyFromPEMString(keyPEM){var keyB64=_rsapem_pemToBase64(keyPEM),keyHex=b64tohex(keyB64),a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function _rsasign_getHexPaddedDigestInfoForString(d,e,a){var b=function(f){return KJUR.crypto.Util.hashString(f,a)},c=b(d);return KJUR.crypto.Util.getPaddedDigestInfoHex(c,a,e)}function _zeroPaddingOfSignature(e,d){for(var c="",a=d/4-e.length,b=0;a>b;b++)c+="0";return c+e}function _rsasign_signString(d,a){var b=function(e){return KJUR.crypto.Util.hashString(e,a)},c=b(d);return this.signWithMessageHash(c,a)}function _rsasign_signWithMessageHash(e,c){var f=KJUR.crypto.Util.getPaddedDigestInfoHex(e,c,this.n.bitLength()),b=parseBigInt(f,16),d=this.doPrivate(b),a=d.toString(16);return _zeroPaddingOfSignature(a,this.n.bitLength())}function _rsasign_signStringWithSHA1(a){return _rsasign_signString.call(this,a,"sha1")}function _rsasign_signStringWithSHA256(a){return _rsasign_signString.call(this,a,"sha256")}function pss_mgf1_str(c,a,e){for(var b="",d=0;b.length<a;)b+=hextorstr(e(rstrtohex(c+String.fromCharCode.apply(String,[(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))),d+=1;return b}function _rsasign_signStringPSS(e,a,d){var c=function(f){return KJUR.crypto.Util.hashHex(f,a)},b=c(rstrtohex(e));return void 0===d&&(d=-1),this.signWithMessageHashPSS(b,a,d)}function _rsasign_signWithMessageHashPSS(l,a,k){var d,b=hextorstr(l),g=b.length,m=this.n.bitLength()-1,c=Math.ceil(m/8),o=function(i){return KJUR.crypto.Util.hashHex(i,a)};if(-1===k||void 0===k)k=g;else if(-2===k)k=c-g-2;else if(-2>k)throw"invalid salt length";if(g+k+2>c)throw"data too long";var f="";k>0&&(f=new Array(k),(new SecureRandom).nextBytes(f),f=String.fromCharCode.apply(String,f));var n=hextorstr(o(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+b+f))),j=[];for(d=0;c-k-g-2>d;d+=1)j[d]=0;var e=String.fromCharCode.apply(String,j)+""+f,h=pss_mgf1_str(n,e.length,o),q=[];for(d=0;d<e.length;d+=1)q[d]=e.charCodeAt(d)^h.charCodeAt(d);var p=65280>>8*c-m&255;for(q[0]&=~p,d=0;g>d;d++)q.push(n.charCodeAt(d));return q.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(q)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(a,d,c){var b=new RSAKey;b.setPublic(d,c);var e=b.doPublic(a);return e}function _rsasign_getHexDigestInfoFromSig(a,c,b){var e=_rsasign_getDecryptSignatureBI(a,c,b),d=e.toString(16).replace(/^1f+00/,"");return d}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(f){for(var e in KJUR.crypto.Util.DIGESTINFOHEAD){var d=KJUR.crypto.Util.DIGESTINFOHEAD[e],b=d.length;if(f.substring(0,b)==d){var c=[e,f.substring(b)];return c}}return[]}function _rsasign_verifySignatureWithArgs(f,b,g,j){var e=_rsasign_getHexDigestInfoFromSig(b,g,j),h=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==h.length)return!1;var d=h[0],i=h[1],a=function(k){return KJUR.crypto.Util.hashString(k,d)},c=a(f);return i==c}function _rsasign_verifyHexSignatureForMessage(c,b){var d=parseBigInt(c,16),a=_rsasign_verifySignatureWithArgs(b,d,this.n.toString(16),this.e.toString(16));return a}function _rsasign_verifyString(f,j){j=j.replace(_RE_HEXDECONLY,""),j=j.replace(/[ \n]+/g,"");var b=parseBigInt(j,16);if(b.bitLength()>this.n.bitLength())return 0;var i=this.doPublic(b),e=i.toString(16).replace(/^1f+00/,""),g=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==g.length)return!1;var d=g[0],h=g[1],a=function(k){return KJUR.crypto.Util.hashString(k,d)},c=a(f);return h==c}function _rsasign_verifyWithMessageHash(e,a){a=a.replace(_RE_HEXDECONLY,""),a=a.replace(/[ \n]+/g,"");var b=parseBigInt(a,16);if(b.bitLength()>this.n.bitLength())return 0;var h=this.doPublic(b),g=h.toString(16).replace(/^1f+00/,""),c=_rsasign_getAlgNameAndHashFromHexDisgestInfo(g);if(0==c.length)return!1;var f=(c[0],c[1]);return f==e}function _rsasign_verifyStringPSS(c,b,a,f){var e=function(g){return KJUR.crypto.Util.hashHex(g,a)},d=e(rstrtohex(c));return void 0===f&&(f=-1),this.verifyWithMessageHashPSS(d,b,a,f)}function _rsasign_verifyWithMessageHashPSS(f,s,l,c){var k=new BigInteger(s,16);if(k.bitLength()>this.n.bitLength())return!1;var q,r=function(i){return KJUR.crypto.Util.hashHex(i,l)},j=hextorstr(f),h=j.length,g=this.n.bitLength()-1,m=Math.ceil(g/8);if(-1===c||void 0===c)c=h;else if(-2===c)c=m-h-2;else if(-2>c)throw"invalid salt length";if(h+c+2>m)throw"data too long";var a=this.doPublic(k).toByteArray();for(q=0;q<a.length;q+=1)a[q]&=255;for(;a.length<m;)a.unshift(0);if(188!==a[m-1])throw"encoded message does not end in 0xbc";a=String.fromCharCode.apply(String,a);var d=a.substr(0,m-h-1),e=a.substr(d.length,h),p=65280>>8*m-g&255;if(0!==(d.charCodeAt(0)&p))throw"bits beyond keysize not zero";var n=pss_mgf1_str(e,d.length,r),o=[];for(q=0;q<d.length;q+=1)o[q]=d.charCodeAt(q)^n.charCodeAt(q);o[0]&=~p;var b=m-h-c-2;for(q=0;b>q;q+=1)if(0!==o[q])throw"leftmost octets not zero";if(1!==o[b])throw"0x01 marker not found";return e===hextorstr(r(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+j+String.fromCharCode.apply(String,o.slice(-c)))))}function X509(){this.subjectPublicKeyRSA=null,this.subjectPublicKeyRSA_hN=null,this.subjectPublicKeyRSA_hE=null,this.hex=null,this.getSerialNumberHex=function(){return ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,1])},this.getIssuerHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3])},this.getIssuerString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3]))},this.getSubjectHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5])},this.getSubjectString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5]))},this.getNotBefore=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,0]);return s=s.replace(/(..)/g,"%$1"),s=decodeURIComponent(s)},this.getNotAfter=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,1]);return s=s.replace(/(..)/g,"%$1"),s=decodeURIComponent(s)},this.readCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert),rsa=new RSAKey;rsa.setPublic(a[0],a[1]),this.subjectPublicKeyRSA=rsa,this.subjectPublicKeyRSA_hN=a[0],this.subjectPublicKeyRSA_hE=a[1],this.hex=hCert},this.readCertPEMWithoutRSAInit=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert);this.subjectPublicKeyRSA.setPublic(a[0],a[1]),this.subjectPublicKeyRSA_hN=a[0],this.subjectPublicKeyRSA_hE=a[1],this.hex=hCert}}function Base64x(){}function stoBA(s){for(var a=new Array,i=0;i<s.length;i++)a[i]=s.charCodeAt(i);return a}function BAtos(a){for(var s="",i=0;i<a.length;i++)s+=String.fromCharCode(a[i]);return s}function BAtohex(a){for(var s="",i=0;i<a.length;i++){var hex1=a[i].toString(16);1==hex1.length&&(hex1="0"+hex1),s+=hex1}return s}function stohex(s){return BAtohex(stoBA(s))}function stob64(s){return hex2b64(stohex(s))}function stob64u(s){return b64tob64u(hex2b64(stohex(s)))}function b64utos(s){return BAtos(b64toBA(b64utob64(s)))}function b64tob64u(s){return s=s.replace(/\=/g,""),s=s.replace(/\+/g,"-"),s=s.replace(/\//g,"_")}function b64utob64(s){return s.length%4==2?s+="==":s.length%4==3&&(s+="="),s=s.replace(/-/g,"+"),s=s.replace(/_/g,"/");
}function hextob64u(s){return b64tob64u(hex2b64(s))}function b64utohex(s){return b64tohex(b64utob64(s))}function utf8tob64(s){return hex2b64(uricmptohex(encodeURIComponentAll(s)))}function b64toutf8(s){return decodeURIComponent(hextouricmp(b64tohex(s)))}function utf8tohex(s){return uricmptohex(encodeURIComponentAll(s))}function hextoutf8(s){return decodeURIComponent(hextouricmp(s))}function hextorstr(sHex){for(var s="",i=0;i<sHex.length-1;i+=2)s+=String.fromCharCode(parseInt(sHex.substr(i,2),16));return s}function rstrtohex(s){for(var result="",i=0;i<s.length;i++)result+=("0"+s.charCodeAt(i).toString(16)).slice(-2);return result}function hextob64(s){return hex2b64(s)}function hextob64nl(s){var b64=hextob64(s),b64nl=b64.replace(/(.{64})/g,"$1\r\n");return b64nl=b64nl.replace(/\r\n$/,"")}function b64nltohex(s){var b64=s.replace(/[^0-9A-Za-z\/+=]*/g,""),hex=b64tohex(b64);return hex}function uricmptohex(s){return s.replace(/%/g,"")}function hextouricmp(s){return s.replace(/(..)/g,"%$1")}function encodeURIComponentAll(u8){for(var s=encodeURIComponent(u8),s2="",i=0;i<s.length;i++)"%"==s[i]?(s2+=s.substr(i,3),i+=2):s2=s2+"%"+stohex(s[i]);return s2}function newline_toUnix(s){return s=s.replace(/\r\n/gm,"\n")}function newline_toDos(s){return s=s.replace(/\r\n/gm,"\n"),s=s.replace(/\n/gm,"\r\n")}function DefaultHttpRequest(){function setHeaders(xhr,headers){for(var keys=Object.keys(headers),i=0;i<keys.length;i++){var key=keys[i],value=headers[key];xhr.setRequestHeader(key,value)}}this.getJSON=function(url,config){return _promiseFactory.create(function(resolve,reject){try{var xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.responseType="json",config&&config.headers&&setHeaders(xhr,config.headers),xhr.onload=function(){try{if(200===xhr.status){var response=xhr.response;"string"==typeof response&&(response=JSON.parse(response)),resolve(response)}else reject(Error(xhr.statusText+"("+xhr.status+")"))}catch(err){reject(err)}},xhr.onerror=function(){reject(Error("Network error"))},xhr.send()}catch(err){return reject(err)}})}}function DefaultPromise(promise){this.then=function(successCallback,errorCallback){var childPromise=promise.then(successCallback,errorCallback);return new DefaultPromise(childPromise)},this["catch"]=function(errorCallback){var childPromise=promise["catch"](errorCallback);return new DefaultPromise(childPromise)}}function DefaultPromiseFactory(){this.resolve=function(value){return new DefaultPromise(Promise.resolve(value))},this.reject=function(reason){return new DefaultPromise(Promise.reject(reason))},this.create=function(callback){return new DefaultPromise(new Promise(callback))}}function log(){}function copy(obj,target){target=target||{};for(var key in obj)obj.hasOwnProperty(key)&&(target[key]=obj[key]);return target}function rand(){return((Date.now()+Math.random())*Math.random()).toString().replace(".","")}function error(message){return _promiseFactory.reject(Error(message))}function parseOidcResult(queryString){log("parseOidcResult"),queryString=queryString||location.hash;var idx=queryString.lastIndexOf("#");idx>=0&&(queryString=queryString.substr(idx+1));for(var m,params={},regex=/([^&=]+)=([^&]*)/g,counter=0;m=regex.exec(queryString);)if(params[decodeURIComponent(m[1])]=decodeURIComponent(m[2]),counter++>50)return{error:"Response exceeded expected number of parameters"};for(var prop in params)return params}function getJson(url,token){log("getJson",url);var config={};return token&&(config.headers={Authorization:"Bearer "+token}),_httpRequest.getJSON(url,config)}function OidcClient(settings){this._settings=settings||{},this._settings.request_state_key||(this._settings.request_state_key="OidcClient.request_state"),this._settings.request_state_store||(this._settings.request_state_store=window.localStorage),"undefined"==typeof this._settings.load_user_profile&&(this._settings.load_user_profile=!0),"undefined"==typeof this._settings.filter_protocol_claims&&(this._settings.filter_protocol_claims=!0),this._settings.authority&&this._settings.authority.indexOf(".well-known/openid-configuration")<0&&("/"!==this._settings.authority[this._settings.authority.length-1]&&(this._settings.authority+="/"),this._settings.authority+=".well-known/openid-configuration"),this._settings.response_type||(this._settings.response_type="id_token token"),Object.defineProperty(this,"isOidc",{get:function(){if(this._settings.response_type){var result=this._settings.response_type.split(/\s+/g).filter(function(item){return"id_token"===item});return!!result[0]}return!1}}),Object.defineProperty(this,"isOAuth",{get:function(){if(this._settings.response_type){var result=this._settings.response_type.split(/\s+/g).filter(function(item){return"token"===item});return!!result[0]}return!1}})}var _promiseFactory,_httpRequest,CryptoJS=CryptoJS||function(Math,undefined){var C={},C_lib=C.lib={},Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;return overrides&&subtype.mixIn(overrides),subtype.hasOwnProperty("init")||(subtype.init=function(){subtype.$super.init.apply(this,arguments)}),subtype.init.prototype=subtype,subtype.$super=this,subtype},create:function(){var instance=this.extend();return instance.init.apply(instance,arguments),instance},init:function(){},mixIn:function(properties){for(var propertyName in properties)properties.hasOwnProperty(propertyName)&&(this[propertyName]=properties[propertyName]);properties.hasOwnProperty("toString")&&(this.toString=properties.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],sigBytes!=undefined?this.sigBytes=sigBytes:this.sigBytes=4*words.length},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words,thatWords=wordArray.words,thisSigBytes=this.sigBytes,thatSigBytes=wordArray.sigBytes;if(this.clamp(),thisSigBytes%4)for(var i=0;thatSigBytes>i;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}else if(thatWords.length>65535)for(var i=0;thatSigBytes>i;i+=4)thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2];else thisWords.push.apply(thisWords,thatWords);return this.sigBytes+=thatSigBytes,this},clamp:function(){var words=this.words,sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8,words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);return clone.words=this.words.slice(0),clone},random:function(nBytes){for(var words=[],i=0;nBytes>i;i+=4)words.push(4294967296*Math.random()|0);return new WordArray.init(words,nBytes)}}),C_enc=C.enc={},Hex=C_enc.Hex={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,hexChars=[],i=0;sigBytes>i;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16)),hexChars.push((15&bite).toString(16))}return hexChars.join("")},parse:function(hexStr){for(var hexStrLength=hexStr.length,words=[],i=0;hexStrLength>i;i+=2)words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4;return new WordArray.init(words,hexStrLength/2)}},Latin1=C_enc.Latin1={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,latin1Chars=[],i=0;sigBytes>i;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){for(var latin1StrLength=latin1Str.length,words=[],i=0;latin1StrLength>i;i++)words[i>>>2]|=(255&latin1Str.charCodeAt(i))<<24-i%4*8;return new WordArray.init(words,latin1StrLength)}},Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}},BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init,this._nDataBytes=0},_append:function(data){"string"==typeof data&&(data=Utf8.parse(data)),this._data.concat(data),this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data,dataWords=data.words,dataSigBytes=data.sigBytes,blockSize=this.blockSize,blockSizeBytes=4*blockSize,nBlocksReady=dataSigBytes/blockSizeBytes;nBlocksReady=doFlush?Math.ceil(nBlocksReady):Math.max((0|nBlocksReady)-this._minBufferSize,0);var nWordsReady=nBlocksReady*blockSize,nBytesReady=Math.min(4*nWordsReady,dataSigBytes);if(nWordsReady){for(var offset=0;nWordsReady>offset;offset+=blockSize)this._doProcessBlock(dataWords,offset);var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0}),C_algo=(C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg),this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this),this._doReset()},update:function(messageUpdate){return this._append(messageUpdate),this._process(),this},finalize:function(messageUpdate){messageUpdate&&this._append(messageUpdate);var hash=this._doFinalize();return hash},blockSize:16,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}}),C.algo={});return C}(Math);!function(){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,W=[],SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],i=0;80>i;i++){if(16>i)W[i]=0|M[offset+i];else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=n<<1|n>>>31}var t=(a<<5|a>>>27)+e+W[i];t+=20>i?(b&c|~b&d)+1518500249:40>i?(b^c^d)+1859775393:60>i?(b&c|b&d|c&d)-1894007588:(b^c^d)-899497514,e=d,d=c,c=b<<30|b>>>2,b=a,a=t}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA1=Hasher._createHelper(SHA1),C.HmacSHA1=Hasher._createHmacHelper(SHA1)}(),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,H=[],K=[];!function(){function isPrime(n){for(var sqrtN=Math.sqrt(n),factor=2;sqrtN>=factor;factor++)if(!(n%factor))return!1;return!0}function getFractionalBits(n){return 4294967296*(n-(0|n))|0}for(var n=2,nPrime=0;64>nPrime;)isPrime(n)&&(8>nPrime&&(H[nPrime]=getFractionalBits(Math.pow(n,.5))),K[nPrime]=getFractionalBits(Math.pow(n,1/3)),nPrime++),n++}();var W=[],SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],f=H[5],g=H[6],h=H[7],i=0;64>i;i++){if(16>i)W[i]=0|M[offset+i];else{var gamma0x=W[i-15],gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3,gamma1x=W[i-2],gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var ch=e&f^~e&g,maj=a&b^a&c^b&c,sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25),t1=h+sigma1+ch+K[i]+W[i],t2=sigma0+maj;h=g,g=f,f=e,e=d+t1|0,d=c,c=b,b=a,a=t1+t2|0}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0,H[5]=H[5]+f|0,H[6]=H[6]+g|0,H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA256=Hasher._createHelper(SHA256),C.HmacSHA256=Hasher._createHmacHelper(SHA256)}(Math),function(undefined){var C=CryptoJS,C_lib=C.lib,Base=C_lib.Base,X32WordArray=C_lib.WordArray,C_x64=C.x64={};C_x64.Word=Base.extend({init:function(high,low){this.high=high,this.low=low}}),C_x64.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],sigBytes!=undefined?this.sigBytes=sigBytes:this.sigBytes=8*words.length},toX32:function(){for(var x64Words=this.words,x64WordsLength=x64Words.length,x32Words=[],i=0;x64WordsLength>i;i++){var x64Word=x64Words[i];x32Words.push(x64Word.high),x32Words.push(x64Word.low)}return X32WordArray.create(x32Words,this.sigBytes)},clone:function(){for(var clone=Base.clone.call(this),words=clone.words=this.words.slice(0),wordsLength=words.length,i=0;wordsLength>i;i++)words[i]=words[i].clone();return clone}})}(),function(){function X64Word_create(){return X64Word.create.apply(X64Word,arguments)}var C=CryptoJS,C_lib=C.lib,Hasher=C_lib.Hasher,C_x64=C.x64,X64Word=C_x64.Word,X64WordArray=C_x64.WordArray,C_algo=C.algo,K=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],W=[];!function(){for(var i=0;80>i;i++)W[i]=X64Word_create()}();var SHA512=C_algo.SHA512=Hasher.extend({_doReset:function(){this._hash=new X64WordArray.init([new X64Word.init(1779033703,4089235720),new X64Word.init(3144134277,2227873595),new X64Word.init(1013904242,4271175723),new X64Word.init(2773480762,1595750129),new X64Word.init(1359893119,2917565137),new X64Word.init(2600822924,725511199),new X64Word.init(528734635,4215389547),new X64Word.init(1541459225,327033209)])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,H0=H[0],H1=H[1],H2=H[2],H3=H[3],H4=H[4],H5=H[5],H6=H[6],H7=H[7],H0h=H0.high,H0l=H0.low,H1h=H1.high,H1l=H1.low,H2h=H2.high,H2l=H2.low,H3h=H3.high,H3l=H3.low,H4h=H4.high,H4l=H4.low,H5h=H5.high,H5l=H5.low,H6h=H6.high,H6l=H6.low,H7h=H7.high,H7l=H7.low,ah=H0h,al=H0l,bh=H1h,bl=H1l,ch=H2h,cl=H2l,dh=H3h,dl=H3l,eh=H4h,el=H4l,fh=H5h,fl=H5l,gh=H6h,gl=H6l,hh=H7h,hl=H7l,i=0;80>i;i++){var Wi=W[i];if(16>i)var Wih=Wi.high=0|M[offset+2*i],Wil=Wi.low=0|M[offset+2*i+1];else{var gamma0x=W[i-15],gamma0xh=gamma0x.high,gamma0xl=gamma0x.low,gamma0h=(gamma0xh>>>1|gamma0xl<<31)^(gamma0xh>>>8|gamma0xl<<24)^gamma0xh>>>7,gamma0l=(gamma0xl>>>1|gamma0xh<<31)^(gamma0xl>>>8|gamma0xh<<24)^(gamma0xl>>>7|gamma0xh<<25),gamma1x=W[i-2],gamma1xh=gamma1x.high,gamma1xl=gamma1x.low,gamma1h=(gamma1xh>>>19|gamma1xl<<13)^(gamma1xh<<3|gamma1xl>>>29)^gamma1xh>>>6,gamma1l=(gamma1xl>>>19|gamma1xh<<13)^(gamma1xl<<3|gamma1xh>>>29)^(gamma1xl>>>6|gamma1xh<<26),Wi7=W[i-7],Wi7h=Wi7.high,Wi7l=Wi7.low,Wi16=W[i-16],Wi16h=Wi16.high,Wi16l=Wi16.low,Wil=gamma0l+Wi7l,Wih=gamma0h+Wi7h+(gamma0l>>>0>Wil>>>0?1:0),Wil=Wil+gamma1l,Wih=Wih+gamma1h+(gamma1l>>>0>Wil>>>0?1:0),Wil=Wil+Wi16l,Wih=Wih+Wi16h+(Wi16l>>>0>Wil>>>0?1:0);Wi.high=Wih,Wi.low=Wil}var chh=eh&fh^~eh&gh,chl=el&fl^~el&gl,majh=ah&bh^ah&ch^bh&ch,majl=al&bl^al&cl^bl&cl,sigma0h=(ah>>>28|al<<4)^(ah<<30|al>>>2)^(ah<<25|al>>>7),sigma0l=(al>>>28|ah<<4)^(al<<30|ah>>>2)^(al<<25|ah>>>7),sigma1h=(eh>>>14|el<<18)^(eh>>>18|el<<14)^(eh<<23|el>>>9),sigma1l=(el>>>14|eh<<18)^(el>>>18|eh<<14)^(el<<23|eh>>>9),Ki=K[i],Kih=Ki.high,Kil=Ki.low,t1l=hl+sigma1l,t1h=hh+sigma1h+(hl>>>0>t1l>>>0?1:0),t1l=t1l+chl,t1h=t1h+chh+(chl>>>0>t1l>>>0?1:0),t1l=t1l+Kil,t1h=t1h+Kih+(Kil>>>0>t1l>>>0?1:0),t1l=t1l+Wil,t1h=t1h+Wih+(Wil>>>0>t1l>>>0?1:0),t2l=sigma0l+majl,t2h=sigma0h+majh+(sigma0l>>>0>t2l>>>0?1:0);hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,el=dl+t1l|0,eh=dh+t1h+(dl>>>0>el>>>0?1:0)|0,dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,al=t1l+t2l|0,ah=t1h+t2h+(t1l>>>0>al>>>0?1:0)|0}H0l=H0.low=H0l+al,H0.high=H0h+ah+(al>>>0>H0l>>>0?1:0),H1l=H1.low=H1l+bl,H1.high=H1h+bh+(bl>>>0>H1l>>>0?1:0),H2l=H2.low=H2l+cl,H2.high=H2h+ch+(cl>>>0>H2l>>>0?1:0),H3l=H3.low=H3l+dl,H3.high=H3h+dh+(dl>>>0>H3l>>>0?1:0),H4l=H4.low=H4l+el,H4.high=H4h+eh+(el>>>0>H4l>>>0?1:0),H5l=H5.low=H5l+fl,H5.high=H5h+fh+(fl>>>0>H5l>>>0?1:0),H6l=H6.low=H6l+gl,H6.high=H6h+gh+(gl>>>0>H6l>>>0?1:0),H7l=H7.low=H7l+hl,H7.high=H7h+hh+(hl>>>0>H7l>>>0?1:0)},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+128>>>10<<5)+30]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+128>>>10<<5)+31]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process();var hash=this._hash.toX32();return hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone},blockSize:32});C.SHA512=Hasher._createHelper(SHA512),C.HmacSHA512=Hasher._createHmacHelper(SHA512)}();var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=",dbits,canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary);j_lm&&"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=am2,dbits=30):j_lm&&"Netscape"!=navigator.appName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;9>=vv;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;var SHA1_SIZE=20;RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA";var SHA1_SIZE=20;RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP,RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString,RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi"),RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash,RSAKey.prototype.signString=_rsasign_signString,RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.sign=_rsasign_signString,RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS,RSAKey.prototype.signStringPSS=_rsasign_signStringPSS,RSAKey.prototype.signPSS=_rsasign_signStringPSS,RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash,RSAKey.prototype.verifyString=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verify=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS,RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS,RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS,RSAKey.SALT_LEN_RECOVER=-2;var ASN1HEX=new function(){this.getByteLengthOfL_AtObj=function(s,pos){if("8"!=s.substring(pos+2,pos+3))return 1;var i=parseInt(s.substring(pos+3,pos+4));return 0==i?-1:i>0&&10>i?i+1:-2},this.getHexOfL_AtObj=function(s,pos){var len=this.getByteLengthOfL_AtObj(s,pos);return 1>len?"":s.substring(pos+2,pos+2+2*len)},this.getIntOfL_AtObj=function(s,pos){var hLength=this.getHexOfL_AtObj(s,pos);if(""==hLength)return-1;var bi;return bi=parseInt(hLength.substring(0,1))<8?new BigInteger(hLength,16):new BigInteger(hLength.substring(2),16),bi.intValue()},this.getStartPosOfV_AtObj=function(s,pos){var l_len=this.getByteLengthOfL_AtObj(s,pos);return 0>l_len?l_len:pos+2*(l_len+1)},this.getHexOfV_AtObj=function(s,pos){var pos1=this.getStartPosOfV_AtObj(s,pos),len=this.getIntOfL_AtObj(s,pos);return s.substring(pos1,pos1+2*len)},this.getHexOfTLV_AtObj=function(s,pos){var hT=s.substr(pos,2),hL=this.getHexOfL_AtObj(s,pos),hV=this.getHexOfV_AtObj(s,pos);return hT+hL+hV},this.getPosOfNextSibling_AtObj=function(s,pos){var pos1=this.getStartPosOfV_AtObj(s,pos),len=this.getIntOfL_AtObj(s,pos);return pos1+2*len},this.getPosArrayOfChildren_AtObj=function(h,pos){var a=new Array,p0=this.getStartPosOfV_AtObj(h,pos);a.push(p0);for(var len=this.getIntOfL_AtObj(h,pos),p=p0,k=0;;){var pNext=this.getPosOfNextSibling_AtObj(h,p);if(null==pNext||pNext-p0>=2*len)break;if(k>=200)break;a.push(pNext),p=pNext,k++}return a},this.getNthChildIndex_AtObj=function(h,idx,nth){var a=this.getPosArrayOfChildren_AtObj(h,idx);return a[nth]},this.getDecendantIndexByNthList=function(h,currentIndex,nthList){if(0==nthList.length)return currentIndex;var firstNth=nthList.shift(),a=this.getPosArrayOfChildren_AtObj(h,currentIndex);return this.getDecendantIndexByNthList(h,a[firstNth],nthList)},this.getDecendantHexTLVByNthList=function(h,currentIndex,nthList){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);return this.getHexOfTLV_AtObj(h,idx)},this.getDecendantHexVByNthList=function(h,currentIndex,nthList){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);return this.getHexOfV_AtObj(h,idx)}};ASN1HEX.getVbyList=function(h,currentIndex,nthList,checkingTag){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);if(void 0===idx)throw"can't find nthList object";if(void 0!==checkingTag&&h.substr(idx,2)!=checkingTag)throw"checking tag doesn't match: "+h.substr(idx,2)+"!="+checkingTag;return this.getHexOfV_AtObj(h,idx)},ASN1HEX.hextooidstr=function(hex){var zeroPadding=function(s,len){return s.length>=len?s:new Array(len-s.length+1).join("0")+s},a=[],hex0=hex.substr(0,2),i0=parseInt(hex0,16);a[0]=new String(Math.floor(i0/40)),a[1]=new String(i0%40);for(var hex1=hex.substr(2),b=[],i=0;i<hex1.length/2;i++)b.push(parseInt(hex1.substr(2*i,2),16));for(var c=[],cbin="",i=0;i<b.length;i++)128&b[i]?cbin+=zeroPadding((127&b[i]).toString(2),7):(cbin+=zeroPadding((127&b[i]).toString(2),7),c.push(new String(parseInt(cbin,2))),cbin="");var s=a.join(".");return c.length>0&&(s=s+"."+c.join(".")),s},X509.pemToBase64=function(sCertPEM){var s=sCertPEM;return s=s.replace("-----BEGIN CERTIFICATE-----",""),s=s.replace("-----END CERTIFICATE-----",""),s=s.replace(/[ \n]+/g,"")},X509.pemToHex=function(sCertPEM){var b64Cert=X509.pemToBase64(sCertPEM),hCert=b64tohex(b64Cert);return hCert},X509.getSubjectPublicKeyPosFromCertHex=function(hCert){var pInfo=X509.getSubjectPublicKeyInfoPosFromCertHex(hCert);if(-1==pInfo)return-1;var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pInfo);if(2!=a.length)return-1;var pBitString=a[1];if("03"!=hCert.substring(pBitString,pBitString+2))return-1;var pBitStringV=ASN1HEX.getStartPosOfV_AtObj(hCert,pBitString);return"00"!=hCert.substring(pBitStringV,pBitStringV+2)?-1:pBitStringV+2},X509.getSubjectPublicKeyInfoPosFromCertHex=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0),a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pTbsCert);return a.length<1?-1:"a003020102"==hCert.substring(a[0],a[0]+10)?a.length<6?-1:a[6]:a.length<5?-1:a[5]},X509.getPublicKeyHexArrayFromCertHex=function(hCert){var p=X509.getSubjectPublicKeyPosFromCertHex(hCert),a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,p);if(2!=a.length)return[];var hN=ASN1HEX.getHexOfV_AtObj(hCert,a[0]),hE=ASN1HEX.getHexOfV_AtObj(hCert,a[1]);return null!=hN&&null!=hE?[hN,hE]:[]},X509.getHexTbsCertificateFromCert=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0);return pTbsCert},X509.getPublicKeyHexArrayFromCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert);return a},X509.hex2dn=function(hDN){for(var s="",a=ASN1HEX.getPosArrayOfChildren_AtObj(hDN,0),i=0;i<a.length;i++){var hRDN=ASN1HEX.getHexOfTLV_AtObj(hDN,a[i]);s=s+"/"+X509.hex2rdn(hRDN)}return s},X509.hex2rdn=function(hRDN){var hType=ASN1HEX.getDecendantHexTLVByNthList(hRDN,0,[0,0]),hValue=ASN1HEX.getDecendantHexVByNthList(hRDN,0,[0,1]),type="";try{type=X509.DN_ATTRHEX[hType]}catch(ex){type=hType}hValue=hValue.replace(/(..)/g,"%$1");var value=decodeURIComponent(hValue);
return type+"="+value},X509.DN_ATTRHEX={"0603550406":"C","060355040a":"O","060355040b":"OU","0603550403":"CN","0603550405":"SN","0603550408":"ST","0603550407":"L"},X509.getPublicKeyFromCertPEM=function(sCertPEM){var info=X509.getPublicKeyInfoPropOfCertPEM(sCertPEM);if("2a864886f70d010101"==info.algoid){var aRSA=KEYUTIL.parsePublicRawRSAKeyHex(info.keyhex),key=new RSAKey;return key.setPublic(aRSA.n,aRSA.e),key}if("2a8648ce3d0201"==info.algoid){var curveName=KJUR.crypto.OID.oidhex2name[info.algparam],key=new KJUR.crypto.ECDSA({curve:curveName,info:info.keyhex});return key.setPublicKeyHex(info.keyhex),key}if("2a8648ce380401"==info.algoid){var p=ASN1HEX.getVbyList(info.algparam,0,[0],"02"),q=ASN1HEX.getVbyList(info.algparam,0,[1],"02"),g=ASN1HEX.getVbyList(info.algparam,0,[2],"02"),y=ASN1HEX.getHexOfV_AtObj(info.keyhex,0);y=y.substr(2);var key=new KJUR.crypto.DSA;return key.setPublic(new BigInteger(p,16),new BigInteger(q,16),new BigInteger(g,16),new BigInteger(y,16)),key}throw"unsupported key"},X509.getPublicKeyInfoPropOfCertPEM=function(sCertPEM){var result={};result.algparam=null;var hCert=X509.pemToHex(sCertPEM),a1=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,0);if(3!=a1.length)throw"malformed X.509 certificate PEM (code:001)";if("30"!=hCert.substr(a1[0],2))throw"malformed X.509 certificate PEM (code:002)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a1[0]);if(a2.length<7)throw"malformed X.509 certificate PEM (code:003)";var a3=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a2[6]);if(2!=a3.length)throw"malformed X.509 certificate PEM (code:004)";var a4=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a3[0]);if(2!=a4.length)throw"malformed X.509 certificate PEM (code:005)";if(result.algoid=ASN1HEX.getHexOfV_AtObj(hCert,a4[0]),"06"==hCert.substr(a4[1],2)?result.algparam=ASN1HEX.getHexOfV_AtObj(hCert,a4[1]):"30"==hCert.substr(a4[1],2)&&(result.algparam=ASN1HEX.getHexOfTLV_AtObj(hCert,a4[1])),"03"!=hCert.substr(a3[1],2))throw"malformed X.509 certificate PEM (code:006)";var unusedBitAndKeyHex=ASN1HEX.getHexOfV_AtObj(hCert,a3[1]);return result.keyhex=unusedBitAndKeyHex.substr(2),result},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:"CryptoJS.algo.MD5",sha1:"CryptoJS.algo.SHA1",sha224:"CryptoJS.algo.SHA224",sha256:"CryptoJS.algo.SHA256",sha384:"CryptoJS.algo.SHA384",sha512:"CryptoJS.algo.SHA512",ripemd160:"CryptoJS.algo.RIPEMD160"},this.getDigestInfoHex=function(hHash,alg){if("undefined"==typeof this.DIGESTINFOHEAD[alg])throw"alg not supported in Util.DIGESTINFOHEAD: "+alg;return this.DIGESTINFOHEAD[alg]+hHash},this.getPaddedDigestInfoHex=function(hHash,alg,keySize){var hDigestInfo=this.getDigestInfoHex(hHash,alg),pmStrLen=keySize/4;if(hDigestInfo.length+22>pmStrLen)throw"key is too short for SigAlg: keylen="+keySize+","+alg;for(var hHead="0001",hTail="00"+hDigestInfo,hMid="",fLen=pmStrLen-hHead.length-hTail.length,i=0;fLen>i;i+=2)hMid+="ff";var hPaddedMessage=hHead+hMid+hTail;return hPaddedMessage},this.hashString=function(s,alg){var md=new KJUR.crypto.MessageDigest({alg:alg});return md.digestString(s)},this.hashHex=function(sHex,alg){var md=new KJUR.crypto.MessageDigest({alg:alg});return md.digestHex(sHex)},this.sha1=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"});return md.digestString(s)},this.sha256=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestString(s)},this.sha256Hex=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestHex(s)},this.sha512=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestString(s)},this.sha512Hex=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestHex(s)},this.md5=function(s){var md=new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return md.digestString(s)},this.ripemd160=function(s){var md=new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return md.digestString(s)},this.getCryptoJSMDByName=function(s){}},KJUR.crypto.MessageDigest=function(params){var md=null,algName=null,provName=null;this.setAlgAndProvider=function(alg,prov){if(null!=alg&&void 0===prov&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(alg)&&"cryptojs"==prov){try{this.md=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[alg]).create()}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)},this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.md.update(wHex)},this.digest=function(){var hash=this.md.finalize();return hash.toString(CryptoJS.enc.Hex)},this.digestString=function(str){return this.updateString(str),this.digest()},this.digestHex=function(hex){return this.updateHex(hex),this.digest()}}if(-1!=":sha256:".indexOf(alg)&&"sjcl"==prov){try{this.md=new sjcl.hash.sha256}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)},this.updateHex=function(hex){var baHex=sjcl.codec.hex.toBits(hex);this.md.update(baHex)},this.digest=function(){var hash=this.md.finalize();return sjcl.codec.hex.fromBits(hash)},this.digestString=function(str){return this.updateString(str),this.digest()},this.digestHex=function(hex){return this.updateHex(hex),this.digest()}}},this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==params&&void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.Mac=function(params){var mac=null,pass=null,algName=null,provName=null,algProv=null;this.setAlgAndProvider=function(alg,prov){if(null==alg&&(alg="hmacsha1"),alg=alg.toLowerCase(),"hmac"!=alg.substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+alg;void 0===prov&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),this.algProv=alg+"/"+prov;var hashAlg=alg.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(hashAlg)&&"cryptojs"==prov){try{var mdObj=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[hashAlg]);this.mac=CryptoJS.algo.HMAC.create(mdObj,this.pass)}catch(ex){throw"setAlgAndProvider hash alg set fail hashAlg="+hashAlg+"/"+ex}this.updateString=function(str){this.mac.update(str)},this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.mac.update(wHex)},this.doFinal=function(){var hash=this.mac.finalize();return hash.toString(CryptoJS.enc.Hex)},this.doFinalString=function(str){return this.updateString(str),this.doFinal()},this.doFinalHex=function(hex){return this.updateHex(hex),this.doFinal()}}},this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},void 0!==params&&(void 0!==params.pass&&(this.pass=params.pass),void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(params){var prvKey=null;if(this._setAlgNames=function(){this.algName.match(/^(.+)with(.+)$/)&&(this.mdAlgName=RegExp.$1.toLowerCase(),this.pubkeyAlgName=RegExp.$2.toLowerCase())},this._zeroPaddingOfSignature=function(hex,bitLength){for(var s="",nZero=bitLength/4-hex.length,i=0;nZero>i;i++)s+="0";return s+hex},this.setAlgAndProvider=function(alg,prov){if(this._setAlgNames(),"cryptojs/jsrsa"!=prov)throw"provider not supported: "+prov;if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+ex}this.init=function(keyparam,pass){var keyObj=null;try{keyObj=void 0===pass?KEYUTIL.getKey(keyparam):KEYUTIL.getKey(keyparam,pass)}catch(ex){throw"init failed:"+ex}if(keyObj.isPrivate===!0)this.prvKey=keyObj,this.state="SIGN";else{if(keyObj.isPublic!==!0)throw"init failed.:"+keyObj;this.pubKey=keyObj,this.state="VERIFY"}},this.initSign=function(params){"string"==typeof params.ecprvhex&&"string"==typeof params.eccurvename?(this.ecprvhex=params.ecprvhex,this.eccurvename=params.eccurvename):this.prvKey=params,this.state="SIGN"},this.initVerifyByPublicKey=function(params){"string"==typeof params.ecpubhex&&"string"==typeof params.eccurvename?(this.ecpubhex=params.ecpubhex,this.eccurvename=params.eccurvename):params instanceof KJUR.crypto.ECDSA?this.pubKey=params:params instanceof RSAKey&&(this.pubKey=params),this.state="VERIFY"},this.initVerifyByCertificatePEM=function(certPEM){var x509=new X509;x509.readCertPEM(certPEM),this.pubKey=x509.subjectPublicKeyRSA,this.state="VERIFY"},this.updateString=function(str){this.md.updateString(str)},this.updateHex=function(hex){this.md.updateHex(hex)},this.sign=function(){if(this.sHashHex=this.md.digest(),"undefined"!=typeof this.ecprvhex&&"undefined"!=typeof this.eccurvename){var ec=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=ec.signHex(this.sHashHex,this.ecprvhex)}else if("rsaandmgf1"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if("rsa"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(str){return this.updateString(str),this.sign()},this.signHex=function(hex){return this.updateHex(hex),this.sign()},this.verify=function(hSigVal){if(this.sHashHex=this.md.digest(),"undefined"!=typeof this.ecpubhex&&"undefined"!=typeof this.eccurvename){var ec=new KJUR.crypto.ECDSA({curve:this.eccurvename});return ec.verifyHex(this.sHashHex,hSigVal,this.ecpubhex)}if("rsaandmgf1"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,hSigVal,this.mdAlgName,this.pssSaltLen);if("rsa"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal);if(this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal);if(this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(key,pass){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.initVerifyByPublicKey=function(rsaPubKey){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName},this.initVerifyByCertificatePEM=function(certPEM){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName},this.initSign=function(prvKey){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName},this.updateString=function(str){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(str){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(hex){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(hSigVal){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=params,void 0!==params&&(void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=params.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==params.psssaltlen&&(this.pssSaltLen=params.psssaltlen),void 0!==params.prvkeypem)){if(void 0!==params.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{var prvKey=new RSAKey;prvKey.readPrivateKeyFromPEMString(params.prvkeypem),this.initSign(prvKey)}catch(ex){throw"fatal error to load pem private key: "+ex}}},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};var utf8tob64u,b64utoutf8;"function"==typeof Buffer?(utf8tob64u=function(s){return b64tob64u(new Buffer(s,"utf8").toString("base64"))},b64utoutf8=function(s){return new Buffer(b64utob64(s),"base64").toString("utf8")}):(utf8tob64u=function(s){return hextob64u(uricmptohex(encodeURIComponentAll(s)))},b64utoutf8=function(s){return decodeURIComponent(hextouricmp(b64utohex(s)))});var jsonParse=function(){function unescapeOne(_,ch,hex){return ch?escapes[ch]:String.fromCharCode(parseInt(hex,16))}var number="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",oneChar='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',string='(?:"'+oneChar+'*")',jsonToken=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+number+"|"+string+")","g"),escapeSequence=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),escapes={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},EMPTY_STRING=new String(""),SLASH="\\",hop=({"{":Object,"[":Array},Object.hasOwnProperty);return function(json,opt_reviver){var result,toks=json.match(jsonToken),tok=toks[0],topLevelPrimitive=!1;"{"===tok?result={}:"["===tok?result=[]:(result=[],topLevelPrimitive=!0);for(var key,stack=[result],i=1-topLevelPrimitive,n=toks.length;n>i;++i){tok=toks[i];var cont;switch(tok.charCodeAt(0)){default:cont=stack[0],cont[key||cont.length]=+tok,key=void 0;break;case 34:if(tok=tok.substring(1,tok.length-1),-1!==tok.indexOf(SLASH)&&(tok=tok.replace(escapeSequence,unescapeOne)),cont=stack[0],!key){if(!(cont instanceof Array)){key=tok||EMPTY_STRING;break}key=cont.length}cont[key]=tok,key=void 0;break;case 91:cont=stack[0],stack.unshift(cont[key||cont.length]=[]),key=void 0;break;case 93:stack.shift();break;case 102:cont=stack[0],cont[key||cont.length]=!1,key=void 0;break;case 110:cont=stack[0],cont[key||cont.length]=null,key=void 0;break;case 116:cont=stack[0],cont[key||cont.length]=!0,key=void 0;break;case 123:cont=stack[0],stack.unshift(cont[key||cont.length]={}),key=void 0;break;case 125:stack.shift()}}if(topLevelPrimitive){if(1!==stack.length)throw new Error;result=result[0]}else if(stack.length)throw new Error;if(opt_reviver){var walk=function(holder,key){var value=holder[key];if(value&&"object"==typeof value){var toDelete=null;for(var k in value)if(hop.call(value,k)&&value!==holder){var v=walk(value,k);void 0!==v?value[k]=v:(toDelete||(toDelete=[]),toDelete.push(k))}if(toDelete)for(var i=toDelete.length;--i>=0;)delete value[toDelete[i]]}return opt_reviver.call(holder,key,value)};result=walk({"":result},"")}return result}}();"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){function _getSignatureInputByString(sHead,sPayload){return utf8tob64u(sHead)+"."+utf8tob64u(sPayload)}function _jws_getHashAlgFromParsedHead(head){var sigAlg=head.alg,hashAlg="";if("RS256"!=sigAlg&&"RS512"!=sigAlg&&"PS256"!=sigAlg&&"PS512"!=sigAlg)throw"JWS signature algorithm not supported: "+sigAlg;return"256"==sigAlg.substr(2)&&(hashAlg="sha256"),"512"==sigAlg.substr(2)&&(hashAlg="sha512"),hashAlg}function _jws_getHashAlgFromHead(sHead){return _jws_getHashAlgFromParsedHead(jsonParse(sHead))}function _jws_generateSignatureValueBySI_NED(sHead,sPayload,sSI,hN,hE,hD){var rsa=new RSAKey;rsa.setPrivate(hN,hE,hD);var hashAlg=_jws_getHashAlgFromHead(sHead),sigValue=rsa.signString(sSI,hashAlg);return sigValue}function _jws_generateSignatureValueBySI_Key(sHead,sPayload,sSI,key,head){var hashAlg=null;hashAlg="undefined"==typeof head?_jws_getHashAlgFromHead(sHead):_jws_getHashAlgFromParsedHead(head);var isPSS="PS"==head.alg.substr(0,2);return key.hashAndSign?b64tob64u(key.hashAndSign(hashAlg,sSI,"binary","base64",isPSS)):hextob64u(isPSS?key.signStringPSS(sSI,hashAlg):key.signString(sSI,hashAlg))}function _jws_generateSignatureValueBySI_PemPrvKey(sHead,sPayload,sSI,sPemPrvKey){var rsa=new RSAKey;rsa.readPrivateKeyFromPEMString(sPemPrvKey);var hashAlg=_jws_getHashAlgFromHead(sHead),sigValue=rsa.signString(sSI,hashAlg);return sigValue}this.parseJWS=function(sJWS,sigValNotNeeded){if(void 0===this.parsedJWS||!sigValNotNeeded&&void 0===this.parsedJWS.sigvalH){if(null==sJWS.match(/^([^.]+)\.([^.]+)\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var b6Head=RegExp.$1,b6Payload=RegExp.$2,b6SigVal=RegExp.$3,sSI=b6Head+"."+b6Payload;if(this.parsedJWS={},this.parsedJWS.headB64U=b6Head,this.parsedJWS.payloadB64U=b6Payload,this.parsedJWS.sigvalB64U=b6SigVal,this.parsedJWS.si=sSI,!sigValNotNeeded){var hSigVal=b64utohex(b6SigVal),biSigVal=parseBigInt(hSigVal,16);this.parsedJWS.sigvalH=hSigVal,this.parsedJWS.sigvalBI=biSigVal}var sHead=b64utoutf8(b6Head),sPayload=b64utoutf8(b6Payload);if(this.parsedJWS.headS=sHead,this.parsedJWS.payloadS=sPayload,!KJUR.jws.JWS.isSafeJSONString(sHead,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+sHead}},this.verifyJWSByNE=function(sJWS,hN,hE){return this.parseJWS(sJWS),_rsasign_verifySignatureWithArgs(this.parsedJWS.si,this.parsedJWS.sigvalBI,hN,hE)},this.verifyJWSByKey=function(sJWS,key){this.parseJWS(sJWS);var hashAlg=_jws_getHashAlgFromParsedHead(this.parsedJWS.headP),isPSS="PS"==this.parsedJWS.headP.alg.substr(0,2);return key.hashAndVerify?key.hashAndVerify(hashAlg,new Buffer(this.parsedJWS.si,"utf8").toString("base64"),b64utob64(this.parsedJWS.sigvalB64U),"base64",isPSS):isPSS?key.verifyStringPSS(this.parsedJWS.si,this.parsedJWS.sigvalH,hashAlg):key.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.verifyJWSByPemX509Cert=function(sJWS,sPemX509Cert){this.parseJWS(sJWS);var x509=new X509;return x509.readCertPEM(sPemX509Cert),x509.subjectPublicKeyRSA.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.generateJWSByNED=function(sHead,sPayload,hN,hE,hD){if(!KJUR.jws.JWS.isSafeJSONString(sHead))throw"JWS Head is not safe JSON string: "+sHead;var sSI=_getSignatureInputByString(sHead,sPayload),hSigValue=_jws_generateSignatureValueBySI_NED(sHead,sPayload,sSI,hN,hE,hD),b64SigValue=hextob64u(hSigValue);return this.parsedJWS={},this.parsedJWS.headB64U=sSI.split(".")[0],this.parsedJWS.payloadB64U=sSI.split(".")[1],this.parsedJWS.sigvalB64U=b64SigValue,sSI+"."+b64SigValue},this.generateJWSByKey=function(sHead,sPayload,key){var obj={};if(!KJUR.jws.JWS.isSafeJSONString(sHead,obj,"headP"))throw"JWS Head is not safe JSON string: "+sHead;var sSI=_getSignatureInputByString(sHead,sPayload),b64SigValue=_jws_generateSignatureValueBySI_Key(sHead,sPayload,sSI,key,obj.headP);return this.parsedJWS={},this.parsedJWS.headB64U=sSI.split(".")[0],this.parsedJWS.payloadB64U=sSI.split(".")[1],this.parsedJWS.sigvalB64U=b64SigValue,sSI+"."+b64SigValue},this.generateJWSByP1PrvKey=function(sHead,sPayload,sPemPrvKey){if(!KJUR.jws.JWS.isSafeJSONString(sHead))throw"JWS Head is not safe JSON string: "+sHead;var sSI=_getSignatureInputByString(sHead,sPayload),hSigValue=_jws_generateSignatureValueBySI_PemPrvKey(sHead,sPayload,sSI,sPemPrvKey),b64SigValue=hextob64u(hSigValue);return this.parsedJWS={},this.parsedJWS.headB64U=sSI.split(".")[0],this.parsedJWS.payloadB64U=sSI.split(".")[1],this.parsedJWS.sigvalB64U=b64SigValue,sSI+"."+b64SigValue}},KJUR.jws.JWS.sign=function(alg,sHeader,sPayload,key,pass){var ns1=KJUR.jws.JWS;if(!ns1.isSafeJSONString(sHeader))throw"JWS Head is not safe JSON string: "+sHead;var pHeader=ns1.readSafeJSONString(sHeader);""!=alg&&null!=alg||void 0===pHeader.alg||(alg=pHeader.alg),""!=alg&&null!=alg&&void 0===pHeader.alg&&(pHeader.alg=alg,sHeader=JSON.stringify(pHeader));var sigAlg=null;if(void 0===ns1.jwsalg2sigalg[alg])throw"unsupported alg name: "+alg;sigAlg=ns1.jwsalg2sigalg[alg];var uHeader=utf8tob64u(sHeader),uPayload=utf8tob64u(sPayload),uSignatureInput=uHeader+"."+uPayload,hSig="";if("Hmac"==sigAlg.substr(0,4)){if(void 0===key)throw"hexadecimal key shall be specified for HMAC";var mac=new KJUR.crypto.Mac({alg:sigAlg,pass:hextorstr(key)});mac.updateString(uSignatureInput),hSig=mac.doFinal()}else if(-1!=sigAlg.indexOf("withECDSA")){var sig=new KJUR.crypto.Signature({alg:sigAlg});sig.init(key,pass),sig.updateString(uSignatureInput),hASN1Sig=sig.sign(),hSig=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)}else if("none"!=sigAlg){var sig=new KJUR.crypto.Signature({alg:sigAlg});sig.init(key,pass),sig.updateString(uSignatureInput),hSig=sig.sign()}var uSig=hextob64u(hSig);return uSignatureInput+"."+uSig},KJUR.jws.JWS.verify=function(sJWS,key){var jws=KJUR.jws.JWS,a=sJWS.split("."),uHeader=a[0],uPayload=a[1],uSignatureInput=uHeader+"."+uPayload,hSig=b64utohex(a[2]),pHeader=jws.readSafeJSONString(b64utoutf8(a[0])),alg=null;if(void 0===pHeader.alg)throw"algorithm not specified in header";alg=pHeader.alg;var sigAlg=null;if(void 0===jws.jwsalg2sigalg[pHeader.alg])throw"unsupported alg name: "+alg;if(sigAlg=jws.jwsalg2sigalg[alg],"none"==sigAlg)return!0;if("Hmac"==sigAlg.substr(0,4)){if(void 0===key)throw"hexadecimal key shall be specified for HMAC";var mac=new KJUR.crypto.Mac({alg:sigAlg,pass:hextorstr(key)});return mac.updateString(uSignatureInput),hSig2=mac.doFinal(),hSig==hSig2}if(-1!=sigAlg.indexOf("withECDSA")){var hASN1Sig=null;try{hASN1Sig=KJUR.crypto.ECDSA.concatSigToASN1Sig(hSig)}catch(ex){return!1}var sig=new KJUR.crypto.Signature({alg:sigAlg});return sig.init(key),sig.updateString(uSignatureInput),sig.verify(hASN1Sig)}var sig=new KJUR.crypto.Signature({alg:sigAlg});return sig.init(key),sig.updateString(uSignatureInput),sig.verify(hSig)},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(s,h,p){var o=null;try{return o=jsonParse(s),"object"!=typeof o?0:o.constructor===Array?0:(h&&(h[p]=o),1)}catch(ex){return 0}},KJUR.jws.JWS.readSafeJSONString=function(s){var o=null;try{return o=jsonParse(s),"object"!=typeof o?null:o.constructor===Array?null:o}catch(ex){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(sJWS){if(null==sJWS.match(/^[^.]+\.[^.]+\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return RegExp.$1},KJUR.jws.IntDate=function(){},KJUR.jws.IntDate.get=function(s){if("now"==s)return KJUR.jws.IntDate.getNow();if("now + 1hour"==s)return KJUR.jws.IntDate.getNow()+3600;if("now + 1day"==s)return KJUR.jws.IntDate.getNow()+86400;if("now + 1month"==s)return KJUR.jws.IntDate.getNow()+2592e3;if("now + 1year"==s)return KJUR.jws.IntDate.getNow()+31536e3;if(s.match(/Z$/))return KJUR.jws.IntDate.getZulu(s);if(s.match(/^[0-9]+$/))return parseInt(s);throw"unsupported format: "+s},KJUR.jws.IntDate.getZulu=function(s){if(a=s.match(/(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/)){var year=parseInt(RegExp.$1),month=parseInt(RegExp.$2)-1,day=parseInt(RegExp.$3),hour=parseInt(RegExp.$4),min=parseInt(RegExp.$5),sec=parseInt(RegExp.$6),d=new Date(Date.UTC(year,month,day,hour,min,sec));return~~(d/1e3)}throw"unsupported format: "+s},KJUR.jws.IntDate.getNow=function(){var d=~~(new Date/1e3);return d},KJUR.jws.IntDate.intDate2UTCString=function(intDate){var d=new Date(1e3*intDate);return d.toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(intDate){var d=new Date(1e3*intDate),year=("0000"+d.getUTCFullYear()).slice(-4),mon=("00"+(d.getUTCMonth()+1)).slice(-2),day=("00"+d.getUTCDate()).slice(-2),hour=("00"+d.getUTCHours()).slice(-2),min=("00"+d.getUTCMinutes()).slice(-2),sec=("00"+d.getUTCSeconds()).slice(-2);return year+mon+day+hour+min+sec+"Z"},function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}function lib$es6$promise$utils$$isFunction(x){return"function"==typeof x}function lib$es6$promise$utils$$isMaybeThenable(x){return"object"==typeof x&&null!==x}function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}function lib$es6$promise$asap$$useNextTick(){return function(){process.nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0,observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=lib$es6$promise$asap$$flush,function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}function lib$es6$promise$asap$$flush(){for(var i=0;lib$es6$promise$asap$$len>i;i+=2){var callback=lib$es6$promise$asap$$queue[i],arg=lib$es6$promise$asap$$queue[i+1];callback(arg),lib$es6$promise$asap$$queue[i]=void 0,lib$es6$promise$asap$$queue[i+1]=void 0}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertx(){try{var r=require,vertx=r("vertx");return lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext,lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}function lib$es6$promise$$internal$$noop(){}function lib$es6$promise$$internal$$selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){return lib$es6$promise$$internal$$GET_THEN_ERROR.error=error,lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=!1,error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?lib$es6$promise$$internal$$resolve(promise,value):lib$es6$promise$$internal$$fulfill(promise,value))},function(reason){sealed||(sealed=!0,lib$es6$promise$$internal$$reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));!sealed&&error&&(sealed=!0,lib$es6$promise$$internal$$reject(promise,error))},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){thenable._state===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,thenable._result):thenable._state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,thenable._result):lib$es6$promise$$internal$$subscribe(thenable,void 0,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor)lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable);else{var then=lib$es6$promise$$internal$$getThen(maybeThenable);then===lib$es6$promise$$internal$$GET_THEN_ERROR?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error):void 0===then?lib$es6$promise$$internal$$fulfill(promise,maybeThenable):lib$es6$promise$utils$$isFunction(then)?lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then):lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}function lib$es6$promise$$internal$$resolve(promise,value){promise===value?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFulfillment()):lib$es6$promise$utils$$objectOrFunction(value)?lib$es6$promise$$internal$$handleMaybeThenable(promise,value):lib$es6$promise$$internal$$fulfill(promise,value)}function lib$es6$promise$$internal$$publishRejection(promise){promise._onerror&&promise._onerror(promise._result),lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._result=value,promise._state=lib$es6$promise$$internal$$FULFILLED,0!==promise._subscribers.length&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise))}function lib$es6$promise$$internal$$reject(promise,reason){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._state=lib$es6$promise$$internal$$REJECTED,promise._result=reason,lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise))}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){
var subscribers=parent._subscribers,length=subscribers.length;parent._onerror=null,subscribers[length]=child,subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment,subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection,0===length&&parent._state&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child,callback,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){return lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e,lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var value,error,succeeded,failed,hasCallback=lib$es6$promise$utils$$isFunction(callback);if(hasCallback){if(value=lib$es6$promise$$internal$$tryCatch(callback,detail),value===lib$es6$promise$$internal$$TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,promise===value)return void lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==lib$es6$promise$$internal$$PENDING||(hasCallback&&succeeded?lib$es6$promise$$internal$$resolve(promise,value):failed?lib$es6$promise$$internal$$reject(promise,error):settled===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,value):settled===lib$es6$promise$$internal$$REJECTED&&lib$es6$promise$$internal$$reject(promise,value))}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$enumerator$$Enumerator(Constructor,input){var enumerator=this;enumerator._instanceConstructor=Constructor,enumerator.promise=new Constructor(lib$es6$promise$$internal$$noop),enumerator._validateInput(input)?(enumerator._input=input,enumerator.length=input.length,enumerator._remaining=input.length,enumerator._init(),0===enumerator.length?lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result):(enumerator.length=enumerator.length||0,enumerator._enumerate(),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result))):lib$es6$promise$$internal$$reject(enumerator.promise,enumerator._validationError())}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}function lib$es6$promise$promise$race$$race(entries){function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries))return lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race.")),promise;for(var length=entries.length,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),void 0,onFulfillment,onRejection);return promise}function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$resolve(promise,object),promise}function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$reject(promise,reason),promise}function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++,this._state=void 0,this._result=void 0,this._subscribers=[],lib$es6$promise$$internal$$noop!==resolver&&(lib$es6$promise$utils$$isFunction(resolver)||lib$es6$promise$promise$$needsResolver(),this instanceof lib$es6$promise$promise$$Promise||lib$es6$promise$promise$$needsNew(),lib$es6$promise$$internal$$initializePromise(this,resolver))}function lib$es6$promise$polyfill$$polyfill(){var local;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;(!P||"[object Promise]"!==Object.prototype.toString.call(P.resolve())||P.cast)&&(local.Promise=lib$es6$promise$promise$$default)}var lib$es6$promise$utils$$_isArray;lib$es6$promise$utils$$_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var lib$es6$promise$asap$$vertxNext,lib$es6$promise$asap$$customSchedulerFn,lib$es6$promise$asap$$scheduleFlush,lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray,lib$es6$promise$asap$$len=0,lib$es6$promise$asap$$asap=({}.toString,function(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback,lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg,lib$es6$promise$asap$$len+=2,2===lib$es6$promise$asap$$len&&(lib$es6$promise$asap$$customSchedulerFn?lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush):lib$es6$promise$asap$$scheduleFlush())}),lib$es6$promise$asap$$browserWindow="undefined"!=typeof window?window:void 0,lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{},lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver,lib$es6$promise$asap$$isNode="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),lib$es6$promise$asap$$isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,lib$es6$promise$asap$$queue=new Array(1e3);lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$isNode?lib$es6$promise$asap$$useNextTick():lib$es6$promise$asap$$BrowserMutationObserver?lib$es6$promise$asap$$useMutationObserver():lib$es6$promise$asap$$isWorker?lib$es6$promise$asap$$useMessageChannel():void 0===lib$es6$promise$asap$$browserWindow&&"function"==typeof require?lib$es6$promise$asap$$attemptVertx():lib$es6$promise$asap$$useSetTimeout();var lib$es6$promise$$internal$$PENDING=void 0,lib$es6$promise$$internal$$FULFILLED=1,lib$es6$promise$$internal$$REJECTED=2,lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject,lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;lib$es6$promise$enumerator$$Enumerator.prototype._validateInput=function(input){return lib$es6$promise$utils$$isArray(input)},lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},lib$es6$promise$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){for(var enumerator=this,length=enumerator.length,promise=enumerator.promise,input=enumerator._input,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)enumerator._eachEntry(input[i],i)},lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var enumerator=this,c=enumerator._instanceConstructor;lib$es6$promise$utils$$isMaybeThenable(entry)?entry.constructor===c&&entry._state!==lib$es6$promise$$internal$$PENDING?(entry._onerror=null,enumerator._settledAt(entry._state,i,entry._result)):enumerator._willSettleAt(c.resolve(entry),i):(enumerator._remaining--,enumerator._result[i]=entry)},lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var enumerator=this,promise=enumerator.promise;promise._state===lib$es6$promise$$internal$$PENDING&&(enumerator._remaining--,state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,value):enumerator._result[i]=value),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(promise,enumerator._result)},lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,void 0,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all,lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race,lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve,lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject,lib$es6$promise$promise$$counter=0,lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default,lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default,lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default,lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default,lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler,lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap,lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap,lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this,state=parent._state;if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection)return this;var child=new this.constructor(lib$es6$promise$$internal$$noop),result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection);return child},"catch":function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill,lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};"function"==typeof define&&define.amd?define(function(){return lib$es6$promise$umd$$ES6Promise}):"undefined"!=typeof module&&module.exports?module.exports=lib$es6$promise$umd$$ES6Promise:"undefined"!=typeof this&&(this.ES6Promise=lib$es6$promise$umd$$ES6Promise),lib$es6$promise$polyfill$$default()}.call(this),_httpRequest=new DefaultHttpRequest,_promiseFactory=new DefaultPromiseFactory,OidcClient.parseOidcResult=parseOidcResult,OidcClient.prototype.loadMetadataAsync=function(){log("OidcClient.loadMetadataAsync");var settings=this._settings;return settings.metadata?_promiseFactory.resolve(settings.metadata):settings.authority?getJson(settings.authority).then(function(metadata){return settings.metadata=metadata,metadata},function(err){return error("Failed to load metadata ("+err.message+")")}):error("No authority configured")},OidcClient.prototype.loadX509SigningKeyAsync=function(){function getKeyAsync(jwks){if(!jwks.keys||!jwks.keys.length)return error("Signing keys empty");var key=jwks.keys[0];return"RSA"!==key.kty?error("Signing key not RSA"):key.x5c&&key.x5c.length?_promiseFactory.resolve(key.x5c[0]):error("RSA keys empty")}log("OidcClient.loadX509SigningKeyAsync");var settings=this._settings;return settings.jwks?getKeyAsync(settings.jwks):this.loadMetadataAsync().then(function(metadata){return metadata.jwks_uri?getJson(metadata.jwks_uri).then(function(jwks){return settings.jwks=jwks,getKeyAsync(jwks)},function(err){return error("Failed to load signing keys ("+err.message+")")}):error("Metadata does not contain jwks_uri")})},OidcClient.prototype.loadUserProfile=function(access_token){return log("OidcClient.loadUserProfile"),this.loadMetadataAsync().then(function(metadata){return metadata.userinfo_endpoint?getJson(metadata.userinfo_endpoint,access_token):_promiseFactory.reject(Error("Metadata does not contain userinfo_endpoint"))})},OidcClient.prototype.loadAuthorizationEndpoint=function(){return log("OidcClient.loadAuthorizationEndpoint"),this._settings.authorization_endpoint?_promiseFactory.resolve(this._settings.authorization_endpoint):this._settings.authority?this.loadMetadataAsync().then(function(metadata){return metadata.authorization_endpoint?metadata.authorization_endpoint:error("Metadata does not contain authorization_endpoint")}):error("No authorization_endpoint configured")},OidcClient.prototype.createTokenRequestAsync=function(){log("OidcClient.createTokenRequestAsync");var client=this,settings=client._settings;return client.loadAuthorizationEndpoint().then(function(authorization_endpoint){var state=rand(),url=authorization_endpoint+"?state="+encodeURIComponent(state);if(client.isOidc){var nonce=rand();url+="&nonce="+encodeURIComponent(nonce)}var required=["client_id","redirect_uri","response_type","scope"];required.forEach(function(key){var value=settings[key];value&&(url+="&"+key+"="+encodeURIComponent(value))});var optional=["prompt","display","max_age","ui_locales","id_token_hint","login_hint","acr_values"];optional.forEach(function(key){var value=settings[key];value&&(url+="&"+key+"="+encodeURIComponent(value))});var request_state={oidc:client.isOidc,oauth:client.isOAuth,state:state};return nonce&&(request_state.nonce=nonce),settings.request_state_store.setItem(settings.request_state_key,JSON.stringify(request_state)),{request_state:request_state,url:url}})},OidcClient.prototype.createLogoutRequestAsync=function(id_token_hint){log("OidcClient.createLogoutRequestAsync");var settings=this._settings;return this.loadMetadataAsync().then(function(metadata){if(!metadata.end_session_endpoint)return error("No end_session_endpoint in metadata");var url=metadata.end_session_endpoint;return id_token_hint&&settings.post_logout_redirect_uri&&(url+="?post_logout_redirect_uri="+encodeURIComponent(settings.post_logout_redirect_uri),url+="&id_token_hint="+encodeURIComponent(id_token_hint)),url})},OidcClient.prototype.validateIdTokenAsync=function(id_token,nonce,access_token){log("OidcClient.validateIdTokenAsync");var client=this,settings=client._settings;return client.loadX509SigningKeyAsync().then(function(cert){var jws=new KJUR.jws.JWS;if(jws.verifyJWSByPemX509Cert(id_token,cert)){var id_token_contents=JSON.parse(jws.parsedJWS.payloadS);return nonce!==id_token_contents.nonce?error("Invalid nonce"):client.loadMetadataAsync().then(function(metadata){if(id_token_contents.iss!==metadata.issuer)return error("Invalid issuer");if(id_token_contents.aud!==settings.client_id)return error("Invalid audience");var now=parseInt(Date.now()/1e3),diff=now-id_token_contents.iat;return diff>300?error("Token issued too long ago"):id_token_contents.exp<now?error("Token expired"):access_token&&settings.load_user_profile?client.loadUserProfile(access_token,id_token_contents).then(function(profile){return copy(profile,id_token_contents)}):id_token_contents})}return error("JWT failed to validate")})},OidcClient.prototype.validateAccessTokenAsync=function(id_token_contents,access_token){if(log("OidcClient.validateAccessTokenAsync"),!id_token_contents.at_hash)return error("No at_hash in id_token");var hash=KJUR.crypto.Util.sha256(access_token),left=hash.substr(0,hash.length/2),left_b64u=hextob64u(left);return left_b64u!==id_token_contents.at_hash?error("at_hash failed to validate"):_promiseFactory.resolve()},OidcClient.prototype.validateIdTokenAndAccessTokenAsync=function(id_token,nonce,access_token){log("OidcClient.validateIdTokenAndAccessTokenAsync");var client=this;return client.validateIdTokenAsync(id_token,nonce,access_token).then(function(id_token_contents){return client.validateAccessTokenAsync(id_token_contents,access_token).then(function(){return id_token_contents})})},OidcClient.prototype.processResponseAsync=function(queryString){log("OidcClient.processResponseAsync");var client=this,settings=client._settings,request_state=settings.request_state_store.getItem(settings.request_state_key);if(settings.request_state_store.removeItem(settings.request_state_key),!request_state)return error("No request state loaded");if(request_state=JSON.parse(request_state),!request_state)return error("No request state loaded");if(!request_state.state)return error("No state loaded");var result=parseOidcResult(queryString);if(!result)return error("No OIDC response");if(result.error)return error(result.error);if(result.state!==request_state.state)return error("Invalid state");if(request_state.oidc){if(!result.id_token)return error("No identity token");if(!request_state.nonce)return error("No nonce loaded")}if(request_state.oauth){if(!result.access_token)return error("No access token");if(!result.token_type||"bearer"!==result.token_type.toLowerCase())return error("Invalid token type");if(!result.expires_in)return error("No token expiration")}var promise=_promiseFactory.resolve();return request_state.oidc&&request_state.oauth?promise=client.validateIdTokenAndAccessTokenAsync(result.id_token,request_state.nonce,result.access_token):request_state.oidc&&(promise=client.validateIdTokenAsync(result.id_token,request_state.nonce)),promise.then(function(profile){if(profile&&settings.filter_protocol_claims){var remove=["nonce","at_hash","iat","nbf","exp","aud","iss"];remove.forEach(function(key){delete profile[key]})}return{profile:profile,id_token:result.id_token,access_token:result.access_token,expires_in:result.expires_in,scope:result.scope,session_state:result.session_state}})},window.OidcClient=OidcClient}(),function(){function DefaultHttpRequest(){function setHeaders(xhr,headers){for(var keys=Object.keys(headers),i=0;i<keys.length;i++){var key=keys[i],value=headers[key];xhr.setRequestHeader(key,value)}}this.getJSON=function(url,config){return _promiseFactory.create(function(resolve,reject){try{var xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.responseType="json",config&&config.headers&&setHeaders(xhr,config.headers),xhr.onload=function(){try{if(200===xhr.status){var response=xhr.response;"string"==typeof response&&(response=JSON.parse(response)),resolve(response)}else reject(Error(xhr.statusText+"("+xhr.status+")"))}catch(err){reject(err)}},xhr.onerror=function(){reject(Error("Network error"))},xhr.send()}catch(err){return reject(err)}})}}function DefaultPromise(promise){this.then=function(successCallback,errorCallback){var childPromise=promise.then(successCallback,errorCallback);return new DefaultPromise(childPromise)},this["catch"]=function(errorCallback){var childPromise=promise["catch"](errorCallback);return new DefaultPromise(childPromise)}}function DefaultPromiseFactory(){this.resolve=function(value){return new DefaultPromise(Promise.resolve(value))},this.reject=function(reason){return new DefaultPromise(Promise.reject(reason))},this.create=function(callback){return new DefaultPromise(new Promise(callback))}}function copy(obj,target){target=target||{};for(var key in obj)obj.hasOwnProperty(key)&&(target[key]=obj[key]);return target}function Token(other){if(other){if(this.profile=other.profile,this.id_token=other.id_token,this.access_token=other.access_token,other.access_token)this.expires_at=parseInt(other.expires_at);else{if(!other.id_token)throw Error("Either access_token or id_token required.");this.expires_at=other.profile.exp}this.scope=other.scope,this.session_state=other.session_state}else this.expires_at=0;Object.defineProperty(this,"scopes",{get:function(){return(this.scope||"").split(" ")}}),Object.defineProperty(this,"expired",{get:function(){var now=parseInt(Date.now()/1e3);return this.expires_at<now}}),Object.defineProperty(this,"expires_in",{get:function(){var now=parseInt(Date.now()/1e3);return this.expires_at-now}})}function FrameLoader(url){this.url=url}function loadToken(mgr){if(mgr._token=null,mgr._settings.persist){var tokenJson=mgr._settings.store.getItem(mgr._settings.persistKey);if(tokenJson){var token=Token.fromJSON(tokenJson);token.expired||(mgr._token=token)}}}function configureTokenExpiring(mgr){function callback(){handle=null,mgr._callTokenExpiring()}function cancel(){handle&&(window.clearTimeout(handle),handle=null)}function setup(duration){handle=window.setTimeout(callback,1e3*duration)}function configure(){if(cancel(),!mgr.expired){var duration=mgr.expires_in;duration>60?setup(duration-60):callback()}}var handle=null;configure(),mgr.addOnTokenObtained(configure),mgr.addOnTokenRemoved(cancel)}function configureAutoRenewToken(mgr){mgr._settings.silent_redirect_uri&&mgr._settings.silent_renew&&mgr.addOnTokenExpiring(function(){mgr.renewTokenSilentAsync()["catch"](function(e){mgr._callSilentTokenRenewFailed(),console.error(e.message||e)})})}function configureTokenExpired(mgr){function callback(){handle=null,mgr._token&&mgr.saveToken(null),mgr._callTokenExpired()}function cancel(){handle&&(window.clearTimeout(handle),handle=null)}function setup(duration){handle=window.setTimeout(callback,1e3*duration)}function configure(){cancel(),mgr.expires_in>0&&setup(mgr.expires_in+1)}var handle=null;configure(),mgr.addOnTokenObtained(configure),mgr.addOnTokenRemoved(cancel)}function TokenManager(settings){this._settings=settings||{},"undefined"==typeof this._settings.persist&&(this._settings.persist=!0),this._settings.store=this._settings.store||window.localStorage,this._settings.persistKey=this._settings.persistKey||"TokenManager.token",this.oidcClient=new OidcClient(this._settings),this._callbacks={tokenRemovedCallbacks:[],tokenExpiringCallbacks:[],tokenExpiredCallbacks:[],tokenObtainedCallbacks:[],silentTokenRenewFailedCallbacks:[]},Object.defineProperty(this,"profile",{get:function(){return this._token?this._token.profile:void 0}}),Object.defineProperty(this,"id_token",{get:function(){return this._token?this._token.id_token:void 0}}),Object.defineProperty(this,"access_token",{get:function(){return this._token&&!this._token.expired?this._token.access_token:void 0}}),Object.defineProperty(this,"expired",{get:function(){return this._token?this._token.expired:!0}}),Object.defineProperty(this,"expires_in",{get:function(){return this._token?this._token.expires_in:0}}),Object.defineProperty(this,"expires_at",{get:function(){return this._token?this._token.expires_at:0}}),Object.defineProperty(this,"scope",{get:function(){return this._token&&this._token.scope}}),Object.defineProperty(this,"scopes",{get:function(){return this._token?[].concat(this._token.scopes):[]}}),Object.defineProperty(this,"session_state",{get:function(){return this._token?this._token.session_state:void 0}});var mgr=this;loadToken(mgr),mgr._settings.store instanceof window.localStorage.constructor&&window.addEventListener("storage",function(e){e.key===mgr._settings.persistKey&&(loadToken(mgr),mgr._token?mgr._callTokenObtained():mgr._callTokenRemoved())}),configureTokenExpired(mgr),configureAutoRenewToken(mgr),window.setTimeout(function(){configureTokenExpiring(mgr)},0)}var _promiseFactory,_httpRequest;_httpRequest=new DefaultHttpRequest,_promiseFactory=new DefaultPromiseFactory,function(){function hex2b64(h){var i,c,ret="";for(i=0;i+3<=h.length;i+=3)c=parseInt(h.substring(i,i+3),16),ret+=b64map.charAt(c>>6)+b64map.charAt(63&c);if(i+1==h.length?(c=parseInt(h.substring(i,i+1),16),ret+=b64map.charAt(c<<2)):i+2==h.length&&(c=parseInt(h.substring(i,i+2),16),ret+=b64map.charAt(c>>2)+b64map.charAt((3&c)<<4)),b64pad)for(;(3&ret.length)>0;)ret+=b64pad;return ret}function b64tohex(s){var i,slop,v,ret="",k=0;for(i=0;i<s.length&&s.charAt(i)!=b64pad;++i)v=b64map.indexOf(s.charAt(i)),0>v||(0==k?(ret+=int2char(v>>2),slop=3&v,k=1):1==k?(ret+=int2char(slop<<2|v>>4),slop=15&v,k=2):2==k?(ret+=int2char(slop),ret+=int2char(v>>2),slop=3&v,k=3):(ret+=int2char(slop<<2|v>>4),ret+=int2char(15&v),k=0));return 1==k&&(ret+=int2char(slop<<2)),ret}function b64toBA(s){var i,h=b64tohex(s),a=new Array;for(i=0;2*i<h.length;++i)a[i]=parseInt(h.substring(2*i,2*i+2),16);return a}function BigInteger(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){for(;--n>=0;){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864),w[j++]=67108863&v}return c}function am2(i,x,w,j,c,n){for(var xl=32767&x,xh=x>>15;--n>=0;){var l=32767&this[i],h=this[i++]>>15,m=xh*l+h*xl;l=xl*l+((32767&m)<<15)+w[j]+(1073741823&c),c=(l>>>30)+(m>>>15)+xh*h+(c>>>30),w[j++]=1073741823&l}return c}function am3(i,x,w,j,c,n){for(var xl=16383&x,xh=x>>14;--n>=0;){var l=16383&this[i],h=this[i++]>>14,m=xh*l+h*xl;l=xl*l+((16383&m)<<14)+w[j]+c,c=(l>>28)+(m>>14)+xh*h,w[j++]=268435455&l}return c}function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return null==c?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t,r.s=this.s}function bnpFromInt(x){this.t=1,this.s=0>x?-1:0,x>0?this[0]=x:-1>x?this[0]=x+this.DV:this.t=0}function nbv(i){var r=nbi();return r.fromInt(i),r}function bnpFromString(s,b){var k;if(16==b)k=4;else if(8==b)k=3;else if(256==b)k=8;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return void this.fromRadix(s,b);k=2}this.t=0,this.s=0;for(var i=s.length,mi=!1,sh=0;--i>=0;){var x=8==k?255&s[i]:intAt(s,i);0>x?"-"==s.charAt(i)&&(mi=!0):(mi=!1,0==sh?this[this.t++]=x:sh+k>this.DB?(this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh,this[this.t++]=x>>this.DB-sh):this[this.t-1]|=x<<sh,sh+=k,sh>=this.DB&&(sh-=this.DB))}8==k&&0!=(128&s[0])&&(this.s=-1,sh>0&&(this[this.t-1]|=(1<<this.DB-sh)-1<<sh)),this.clamp(),mi&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var c=this.s&this.DM;this.t>0&&this[this.t-1]==c;)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(16==b)k=4;else if(8==b)k=3;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return this.toRadix(b);k=2}var d,km=(1<<k)-1,m=!1,r="",i=this.t,p=this.DB-i*this.DB%k;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)>0&&(m=!0,r=int2char(d));i>=0;)k>p?(d=(this[i]&(1<<p)-1)<<k-p,d|=this[--i]>>(p+=this.DB-k)):(d=this[i]>>(p-=k)&km,0>=p&&(p+=this.DB,--i)),d>0&&(m=!0),m&&(r+=int2char(d));return m?r:"0"}function bnNegate(){var r=nbi();return BigInteger.ZERO.subTo(this,r),r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(0!=r)return r;var i=this.t;if(r=i-a.t,0!=r)return this.s<0?-r:r;for(;--i>=0;)if(0!=(r=this[i]-a[i]))return r;return 0}function nbits(x){var t,r=1;return 0!=(t=x>>>16)&&(x=t,r+=16),0!=(t=x>>8)&&(x=t,r+=8),0!=(t=x>>4)&&(x=t,r+=4),0!=(t=x>>2)&&(x=t,r+=2),0!=(t=x>>1)&&(x=t,r+=1),r}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n,r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0),r.s=this.s}function bnpLShiftTo(n,r){var i,bs=n%this.DB,cbs=this.DB-bs,bm=(1<<cbs)-1,ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM;for(i=this.t-1;i>=0;--i)r[i+ds+1]=this[i]>>cbs|c,c=(this[i]&bm)<<bs;for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c,r.t=this.t+ds+1,r.s=this.s,r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t)return void(r.t=0);var bs=n%this.DB,cbs=this.DB-bs,bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i)r[i-ds-1]|=(this[i]&bm)<<cbs,r[i-ds]=this[i]>>bs;bs>0&&(r[this.t-ds-1]|=(this.s&bm)<<cbs),r.t=this.t-ds,r.clamp()}function bnpSubTo(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);m>i;)c+=this[i]-a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c-=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c-=a[i],r[i++]=c&this.DM,c>>=this.DB;c-=a.s}r.s=0>c?-1:0,-1>c?r[i++]=this.DV+c:c>0&&(r[i++]=c),r.t=i,r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs(),i=x.t;for(r.t=i+y.t;--i>=0;)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0,r.clamp(),this.s!=a.s&&BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){for(var x=this.abs(),i=r.t=2*x.t;--i>=0;)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);(r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV&&(r[i+x.t]-=x.DV,r[i+x.t+1]=1)}r.t>0&&(r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)),r.s=0,r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(!(pm.t<=0)){var pt=this.abs();if(pt.t<pm.t)return null!=q&&q.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=nbi());var y=nbi(),ts=this.s,ms=m.s,nsh=this.DB-nbits(pm[pm.t-1]);nsh>0?(pm.lShiftTo(nsh,y),pt.lShiftTo(nsh,r)):(pm.copyTo(y),pt.copyTo(r));var ys=y.t,y0=y[ys-1];if(0!=y0){var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0),d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2,i=r.t,j=i-ys,t=null==q?nbi():q;for(y.dlShiftTo(j,t),r.compareTo(t)>=0&&(r[r.t++]=1,r.subTo(t,r)),BigInteger.ONE.dlShiftTo(ys,t),t.subTo(y,y);y.t<ys;)y[y.t++]=0;for(;--j>=0;){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd)for(y.dlShiftTo(j,t),r.subTo(t,r);r[i]<--qd;)r.subTo(t,r)}null!=q&&(r.drShiftTo(ys,q),ts!=ms&&BigInteger.ZERO.subTo(q,q)),r.t=ys,r.clamp(),nsh>0&&r.rShiftTo(nsh,r),0>ts&&BigInteger.ZERO.subTo(r,r)}}}function bnMod(a){var r=nbi();return this.abs().divRemTo(a,null,r),this.s<0&&r.compareTo(BigInteger.ZERO)>0&&a.subTo(r,r),r}function Classic(m){this.m=m}function cConvert(x){return x.s<0||x.compareTo(this.m)>=0?x.mod(this.m):x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function cSqrTo(x,r){x.squareTo(r),this.reduce(r)}function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if(0==(1&x))return 0;var y=3&x;return y=y*(2-(15&x)*y)&15,y=y*(2-(255&x)*y)&255,y=y*(2-((65535&x)*y&65535))&65535,y=y*(2-x*y%this.DV)%this.DV,y>0?this.DV-y:-y}function Montgomery(m){this.m=m,this.mp=m.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function montConvert(x){var r=nbi();return x.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),x.s<0&&r.compareTo(BigInteger.ZERO)>0&&this.m.subTo(r,r),r}function montRevert(x){var r=nbi();return x.copyTo(r),this.reduce(r),r}function montReduce(x){for(;x.t<=this.mt2;)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=32767&x[i],u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;for(j=i+this.m.t,x[j]+=this.m.am(0,u0,x,i,0,this.m.t);x[j]>=x.DV;)x[j]-=x.DV,x[++j]++}x.clamp(),x.drShiftTo(this.m.t,x),x.compareTo(this.m)>=0&&x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r),this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)}function bnpExp(e,z){if(e>4294967295||1>e)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;for(g.copyTo(r);--i>=0;)if(z.sqrTo(r,r2),(e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2,r2=t}return z.revert(r)}function bnModPowInt(e,m){var z;return z=256>e||m.isEven()?new Classic(m):new Montgomery(m),this.exp(e,z)}function bnClone(){var r=nbi();return this.copyTo(r),r}function bnIntValue(){
if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(b){if(null==b&&(b=10),0==this.signum()||2>b||b>36)return"0";var cs=this.chunkSize(b),a=Math.pow(b,cs),d=nbv(a),y=nbi(),z=nbi(),r="";for(this.divRemTo(d,y,z);y.signum()>0;)r=(a+z.intValue()).toString(b).substr(1)+r,y.divRemTo(d,y,z);return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0),null==b&&(b=10);for(var cs=this.chunkSize(b),d=Math.pow(b,cs),mi=!1,j=0,w=0,i=0;i<s.length;++i){var x=intAt(s,i);0>x?"-"==s.charAt(i)&&0==this.signum()&&(mi=!0):(w=b*w+x,++j>=cs&&(this.dMultiply(d),this.dAddOffset(w,0),j=0,w=0))}j>0&&(this.dMultiply(Math.pow(b,j)),this.dAddOffset(w,0)),mi&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(BigInteger.ONE.shiftLeft(a-1),this);else{var x=new Array,t=7&a;x.length=(a>>3)+1,b.nextBytes(x),t>0?x[0]&=(1<<t)-1:x[0]=0,this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var d,p=this.DB-i*this.DB%8,k=0;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p&&(r[k++]=d|this.s<<this.DB-p);i>=0;)8>p?(d=(this[i]&(1<<p)-1)<<8-p,d|=this[--i]>>(p+=this.DB-8)):(d=this[i]>>(p-=8)&255,0>=p&&(p+=this.DB,--i)),0!=(128&d)&&(d|=-256),0==k&&(128&this.s)!=(128&d)&&++k,(k>0||d!=this.s)&&(r[k++]=d);return r}function bnEquals(a){return 0==this.compareTo(a)}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;m>i;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){for(f=a.s&this.DM,i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{for(f=this.s&this.DM,i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s),r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();return this.bitwiseTo(a,op_and,r),r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();return this.bitwiseTo(a,op_or,r),r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();return this.bitwiseTo(a,op_xor,r),r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();return this.bitwiseTo(a,op_andnot,r),r}function bnNot(){for(var r=nbi(),i=0;i<this.t;++i)r[i]=this.DM&~this[i];return r.t=this.t,r.s=~this.s,r}function bnShiftLeft(n){var r=nbi();return 0>n?this.rShiftTo(-n,r):this.lShiftTo(n,r),r}function bnShiftRight(n){var r=nbi();return 0>n?this.lShiftTo(-n,r):this.rShiftTo(n,r),r}function lbit(x){if(0==x)return-1;var r=0;return 0==(65535&x)&&(x>>=16,r+=16),0==(255&x)&&(x>>=8,r+=8),0==(15&x)&&(x>>=4,r+=4),0==(3&x)&&(x>>=2,r+=2),0==(1&x)&&++r,r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(0!=this[i])return i*this.DB+lbit(this[i]);return this.s<0?this.t*this.DB:-1}function cbit(x){for(var r=0;0!=x;)x&=x-1,++r;return r}function bnBitCount(){for(var r=0,x=this.s&this.DM,i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);return j>=this.t?0!=this.s:0!=(this[j]&1<<n%this.DB)}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);return this.bitwiseTo(r,op,r),r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);m>i;)c+=this[i]+a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c+=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c+=a[i],r[i++]=c&this.DM,c>>=this.DB;c+=a.s}r.s=0>c?-1:0,c>0?r[i++]=c:-1>c&&(r[i++]=this.DV+c),r.t=i,r.clamp()}function bnAdd(a){var r=nbi();return this.addTo(a,r),r}function bnSubtract(a){var r=nbi();return this.subTo(a,r),r}function bnMultiply(a){var r=nbi();return this.multiplyTo(a,r),r}function bnSquare(){var r=nbi();return this.squareTo(r),r}function bnDivide(a){var r=nbi();return this.divRemTo(a,r,null),r}function bnRemainder(a){var r=nbi();return this.divRemTo(a,null,r),r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();return this.divRemTo(a,q,r),new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(n,w){if(0!=n){for(;this.t<=w;)this[this.t++]=0;for(this[w]+=n;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);for(r.s=0,r.t=i;i>0;)r[--i]=0;var j;for(j=r.t-this.t;j>i;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);j>i;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;for(r.s=0;--i>=0;)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp(),r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);if(x.compareTo(this.m)<0)return x;var r=nbi();return x.copyTo(r),this.reduce(r),r}function barrettRevert(x){return x}function barrettReduce(x){for(x.drShiftTo(this.m.t-1,this.r2),x.t>this.m.t+1&&(x.t=this.m.t+1,x.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);x.compareTo(this.r2)<0;)x.dAddOffset(1,this.m.t+1);for(x.subTo(this.r2,x);x.compareTo(this.m)>=0;)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r),this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function bnModPow(e,m){var k,z,i=e.bitLength(),r=nbv(1);if(0>=i)return r;k=18>i?1:48>i?3:144>i?4:768>i?5:6,z=8>i?new Classic(m):m.isEven()?new Barrett(m):new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;if(g[1]=z.convert(this),k>1){var g2=nbi();for(z.sqrTo(g[1],g2);km>=n;)g[n]=nbi(),z.mulTo(g2,g[n-2],g[n]),n+=2}var w,t,j=e.t-1,is1=!0,r2=nbi();for(i=nbits(e[j])-1;j>=0;){for(i>=k1?w=e[j]>>i-k1&km:(w=(e[j]&(1<<i+1)-1)<<k1-i,j>0&&(w|=e[j-1]>>this.DB+i-k1)),n=k;0==(1&w);)w>>=1,--n;if((i-=n)<0&&(i+=this.DB,--j),is1)g[w].copyTo(r),is1=!1;else{for(;n>1;)z.sqrTo(r,r2),z.sqrTo(r2,r),n-=2;n>0?z.sqrTo(r,r2):(t=r,r=r2,r2=t),z.mulTo(r2,g[w],r)}for(;j>=0&&0==(e[j]&1<<i);)z.sqrTo(r,r2),t=r,r=r2,r2=t,--i<0&&(i=this.DB-1,--j)}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone(),y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y,y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(0>g)return x;for(g>i&&(g=i),g>0&&(x.rShiftTo(g,x),y.rShiftTo(g,y));x.signum()>0;)(i=x.getLowestSetBit())>0&&x.rShiftTo(i,x),(i=y.getLowestSetBit())>0&&y.rShiftTo(i,y),x.compareTo(y)>=0?(x.subTo(y,x),x.rShiftTo(1,x)):(y.subTo(x,y),y.rShiftTo(1,y));return g>0&&y.lShiftTo(g,y),y}function bnpModInt(n){if(0>=n)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(0==d)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||0==m.signum())return BigInteger.ZERO;for(var u=m.clone(),v=this.clone(),a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);0!=u.signum();){for(;u.isEven();)u.rShiftTo(1,u),ac?(a.isEven()&&b.isEven()||(a.addTo(this,a),b.subTo(m,b)),a.rShiftTo(1,a)):b.isEven()||b.subTo(m,b),b.rShiftTo(1,b);for(;v.isEven();)v.rShiftTo(1,v),ac?(c.isEven()&&d.isEven()||(c.addTo(this,c),d.subTo(m,d)),c.rShiftTo(1,c)):d.isEven()||d.subTo(m,d),d.rShiftTo(1,d);u.compareTo(v)>=0?(u.subTo(v,u),ac&&a.subTo(c,a),b.subTo(d,b)):(v.subTo(u,v),ac&&c.subTo(a,c),d.subTo(b,d))}return 0!=v.compareTo(BigInteger.ONE)?BigInteger.ZERO:d.compareTo(m)>=0?d.subtract(m):d.signum()<0?(d.addTo(m,d),d.signum()<0?d.add(m):d):d}function bnIsProbablePrime(t){var i,x=this.abs();if(1==x.t&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return!0;return!1}if(x.isEven())return!1;for(i=1;i<lowprimes.length;){for(var m=lowprimes[i],j=i+1;j<lowprimes.length&&lplim>m;)m*=lowprimes[j++];for(m=x.modInt(m);j>i;)if(m%lowprimes[i++]==0)return!1}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE),k=n1.getLowestSetBit();if(0>=k)return!1;var r=n1.shiftRight(k);t=t+1>>1,t>lowprimes.length&&(t=lowprimes.length);for(var a=nbi(),i=0;t>i;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(0!=y.compareTo(BigInteger.ONE)&&0!=y.compareTo(n1)){for(var j=1;j++<k&&0!=y.compareTo(n1);)if(y=y.modPowInt(2,this),0==y.compareTo(BigInteger.ONE))return!1;if(0!=y.compareTo(n1))return!1}}return!0}function parseBigInt(str,r){return new BigInteger(str,r)}function linebrk(s,n){for(var ret="",i=0;i+n<s.length;)ret+=s.substring(i,i+n)+"\n",i+=n;return ret+s.substring(i,s.length)}function byte2Hex(b){return 16>b?"0"+b.toString(16):b.toString(16)}function pkcs1pad2(s,n){if(n<s.length+11)return alert("Message too long for RSA"),null;for(var ba=new Array,i=s.length-1;i>=0&&n>0;){var c=s.charCodeAt(i--);128>c?ba[--n]=c:c>127&&2048>c?(ba[--n]=63&c|128,ba[--n]=c>>6|192):(ba[--n]=63&c|128,ba[--n]=c>>6&63|128,ba[--n]=c>>12|224)}ba[--n]=0;for(var rng=new SecureRandom,x=new Array;n>2;){for(x[0]=0;0==x[0];)rng.nextBytes(x);ba[--n]=x[0]}return ba[--n]=2,ba[--n]=0,new BigInteger(ba)}function oaep_mgf1_arr(seed,len,hash){for(var mask="",i=0;mask.length<len;)mask+=hash(String.fromCharCode.apply(String,seed.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return mask}function oaep_pad(s,n,hash){if(s.length+2*SHA1_SIZE+2>n)throw"Message too long for RSA";var i,PS="";for(i=0;i<n-s.length-2*SHA1_SIZE-2;i+=1)PS+="\x00";var DB=rstr_sha1("")+PS+""+s,seed=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(seed);var dbMask=oaep_mgf1_arr(seed,DB.length,hash||rstr_sha1),maskedDB=[];for(i=0;i<DB.length;i+=1)maskedDB[i]=DB.charCodeAt(i)^dbMask.charCodeAt(i);var seedMask=oaep_mgf1_arr(maskedDB,seed.length,rstr_sha1),maskedSeed=[0];for(i=0;i<seed.length;i+=1)maskedSeed[i+1]=seed[i]^seedMask.charCodeAt(i);return new BigInteger(maskedSeed.concat(maskedDB))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(N,E){this.isPublic=!0,"string"!=typeof N?(this.n=N,this.e=E):null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16)):alert("Invalid RSA public key")}function RSADoPublic(x){return x.modPowInt(this.e,this.n)}function RSAEncrypt(text){var m=pkcs1pad2(text,this.n.bitLength()+7>>3);if(null==m)return null;var c=this.doPublic(m);if(null==c)return null;var h=c.toString(16);return 0==(1&h.length)?h:"0"+h}function RSAEncryptOAEP(text,hash){var m=oaep_pad(text,this.n.bitLength()+7>>3,hash);if(null==m)return null;var c=this.doPublic(m);if(null==c)return null;var h=c.toString(16);return 0==(1&h.length)?h:"0"+h}function pkcs1unpad2(d,n){for(var b=d.toByteArray(),i=0;i<b.length&&0==b[i];)++i;if(b.length-i!=n-1||2!=b[i])return null;for(++i;0!=b[i];)if(++i>=b.length)return null;for(var ret="";++i<b.length;){var c=255&b[i];128>c?ret+=String.fromCharCode(c):c>191&&224>c?(ret+=String.fromCharCode((31&c)<<6|63&b[i+1]),++i):(ret+=String.fromCharCode((15&c)<<12|(63&b[i+1])<<6|63&b[i+2]),i+=2)}return ret}function oaep_mgf1_str(seed,len,hash){for(var mask="",i=0;mask.length<len;)mask+=hash(seed+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])),i+=1;return mask}function oaep_unpad(d,n,hash){d=d.toByteArray();var i;for(i=0;i<d.length;i+=1)d[i]&=255;for(;d.length<n;)d.unshift(0);if(d=String.fromCharCode.apply(String,d),d.length<2*SHA1_SIZE+2)throw"Cipher too short";var i,maskedSeed=d.substr(1,SHA1_SIZE),maskedDB=d.substr(SHA1_SIZE+1),seedMask=oaep_mgf1_str(maskedDB,SHA1_SIZE,hash||rstr_sha1),seed=[];for(i=0;i<maskedSeed.length;i+=1)seed[i]=maskedSeed.charCodeAt(i)^seedMask.charCodeAt(i);var dbMask=oaep_mgf1_str(String.fromCharCode.apply(String,seed),d.length-SHA1_SIZE,rstr_sha1),DB=[];for(i=0;i<maskedDB.length;i+=1)DB[i]=maskedDB.charCodeAt(i)^dbMask.charCodeAt(i);if(DB=String.fromCharCode.apply(String,DB),DB.substr(0,SHA1_SIZE)!==rstr_sha1(""))throw"Hash mismatch";DB=DB.substr(SHA1_SIZE);var first_one=DB.indexOf(""),last_zero=-1!=first_one?DB.substr(0,first_one).lastIndexOf("\x00"):-1;if(last_zero+1!=first_one)throw"Malformed data";return DB.substr(first_one+1)}function RSASetPrivate(N,E,D){this.isPrivate=!0,"string"!=typeof N?(this.n=N,this.e=E,this.d=D):null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16),this.d=parseBigInt(D,16)):alert("Invalid RSA private key")}function RSASetPrivateEx(N,E,D,P,Q,DP,DQ,C){if(this.isPrivate=!0,null==N)throw"RSASetPrivateEx N == null";if(null==E)throw"RSASetPrivateEx E == null";if(0==N.length)throw"RSASetPrivateEx N.length == 0";if(0==E.length)throw"RSASetPrivateEx E.length == 0";null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16),this.d=parseBigInt(D,16),this.p=parseBigInt(P,16),this.q=parseBigInt(Q,16),this.dmp1=parseBigInt(DP,16),this.dmq1=parseBigInt(DQ,16),this.coeff=parseBigInt(C,16)):alert("Invalid RSA private key in RSASetPrivateEx")}function RSAGenerate(B,E){var rng=new SecureRandom,qs=B>>1;this.e=parseInt(E,16);for(var ee=new BigInteger(E,16);;){for(;this.p=new BigInteger(B-qs,1,rng),0!=this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(qs,1,rng),0!=this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var t=this.p;this.p=this.q,this.q=t}var p1=this.p.subtract(BigInteger.ONE),q1=this.q.subtract(BigInteger.ONE),phi=p1.multiply(q1);if(0==phi.gcd(ee).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=ee.modInverse(phi),this.dmp1=this.d.mod(p1),this.dmq1=this.d.mod(q1),this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=!0}function RSADoPrivate(x){if(null==this.p||null==this.q)return x.modPow(this.d,this.n);for(var xp=x.mod(this.p).modPow(this.dmp1,this.p),xq=x.mod(this.q).modPow(this.dmq1,this.q);xp.compareTo(xq)<0;)xp=xp.add(this.p);return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq)}function RSADecrypt(ctext){var c=parseBigInt(ctext,16),m=this.doPrivate(c);return null==m?null:pkcs1unpad2(m,this.n.bitLength()+7>>3)}function RSADecryptOAEP(ctext,hash){var c=parseBigInt(ctext,16),m=this.doPrivate(c);return null==m?null:oaep_unpad(m,this.n.bitLength()+7>>3,hash)}function _rsapem_pemToBase64(sPEMPrivateKey){var s=sPEMPrivateKey;return s=s.replace("-----BEGIN RSA PRIVATE KEY-----",""),s=s.replace("-----END RSA PRIVATE KEY-----",""),s=s.replace(/[ \n]+/g,"")}function _rsapem_getPosArrayOfChildrenFromHex(hPrivateKey){var a=new Array,v1=ASN1HEX.getStartPosOfV_AtObj(hPrivateKey,0),n1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,v1),e1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,n1),d1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,e1),p1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,d1),q1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,p1),dp1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,q1),dq1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dp1),co1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dq1);return a.push(v1,n1,e1,d1,p1,q1,dp1,dq1,co1),a}function _rsapem_getHexValueArrayOfChildrenFromHex(hPrivateKey){var posArray=_rsapem_getPosArrayOfChildrenFromHex(hPrivateKey),v=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[0]),n=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[1]),e=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[2]),d=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[3]),p=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[4]),q=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[5]),dp=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[6]),dq=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[7]),co=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[8]),a=new Array;return a.push(v,n,e,d,p,q,dp,dq,co),a}function _rsapem_readPrivateKeyFromASN1HexString(keyHex){var a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function _rsapem_readPrivateKeyFromPEMString(keyPEM){var keyB64=_rsapem_pemToBase64(keyPEM),keyHex=b64tohex(keyB64),a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function _rsasign_getHexPaddedDigestInfoForString(d,e,a){var b=function(f){return KJUR.crypto.Util.hashString(f,a)},c=b(d);return KJUR.crypto.Util.getPaddedDigestInfoHex(c,a,e)}function _zeroPaddingOfSignature(e,d){for(var c="",a=d/4-e.length,b=0;a>b;b++)c+="0";return c+e}function _rsasign_signString(d,a){var b=function(e){return KJUR.crypto.Util.hashString(e,a)},c=b(d);return this.signWithMessageHash(c,a)}function _rsasign_signWithMessageHash(e,c){var f=KJUR.crypto.Util.getPaddedDigestInfoHex(e,c,this.n.bitLength()),b=parseBigInt(f,16),d=this.doPrivate(b),a=d.toString(16);return _zeroPaddingOfSignature(a,this.n.bitLength())}function _rsasign_signStringWithSHA1(a){return _rsasign_signString.call(this,a,"sha1")}function _rsasign_signStringWithSHA256(a){return _rsasign_signString.call(this,a,"sha256")}function pss_mgf1_str(c,a,e){for(var b="",d=0;b.length<a;)b+=hextorstr(e(rstrtohex(c+String.fromCharCode.apply(String,[(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))),d+=1;return b}function _rsasign_signStringPSS(e,a,d){var c=function(f){return KJUR.crypto.Util.hashHex(f,a)},b=c(rstrtohex(e));return void 0===d&&(d=-1),this.signWithMessageHashPSS(b,a,d)}function _rsasign_signWithMessageHashPSS(l,a,k){var d,b=hextorstr(l),g=b.length,m=this.n.bitLength()-1,c=Math.ceil(m/8),o=function(i){return KJUR.crypto.Util.hashHex(i,a)};if(-1===k||void 0===k)k=g;else if(-2===k)k=c-g-2;else if(-2>k)throw"invalid salt length";if(g+k+2>c)throw"data too long";var f="";k>0&&(f=new Array(k),(new SecureRandom).nextBytes(f),f=String.fromCharCode.apply(String,f));var n=hextorstr(o(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+b+f))),j=[];for(d=0;c-k-g-2>d;d+=1)j[d]=0;var e=String.fromCharCode.apply(String,j)+""+f,h=pss_mgf1_str(n,e.length,o),q=[];for(d=0;d<e.length;d+=1)q[d]=e.charCodeAt(d)^h.charCodeAt(d);var p=65280>>8*c-m&255;for(q[0]&=~p,d=0;g>d;d++)q.push(n.charCodeAt(d));return q.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(q)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(a,d,c){var b=new RSAKey;b.setPublic(d,c);var e=b.doPublic(a);return e}function _rsasign_getHexDigestInfoFromSig(a,c,b){var e=_rsasign_getDecryptSignatureBI(a,c,b),d=e.toString(16).replace(/^1f+00/,"");return d}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(f){for(var e in KJUR.crypto.Util.DIGESTINFOHEAD){var d=KJUR.crypto.Util.DIGESTINFOHEAD[e],b=d.length;if(f.substring(0,b)==d){var c=[e,f.substring(b)];return c}}return[]}function _rsasign_verifySignatureWithArgs(f,b,g,j){var e=_rsasign_getHexDigestInfoFromSig(b,g,j),h=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==h.length)return!1;var d=h[0],i=h[1],a=function(k){return KJUR.crypto.Util.hashString(k,d)},c=a(f);return i==c}function _rsasign_verifyHexSignatureForMessage(c,b){var d=parseBigInt(c,16),a=_rsasign_verifySignatureWithArgs(b,d,this.n.toString(16),this.e.toString(16));return a}function _rsasign_verifyString(f,j){j=j.replace(_RE_HEXDECONLY,""),j=j.replace(/[ \n]+/g,"");var b=parseBigInt(j,16);if(b.bitLength()>this.n.bitLength())return 0;var i=this.doPublic(b),e=i.toString(16).replace(/^1f+00/,""),g=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==g.length)return!1;var d=g[0],h=g[1],a=function(k){return KJUR.crypto.Util.hashString(k,d)},c=a(f);return h==c}function _rsasign_verifyWithMessageHash(e,a){a=a.replace(_RE_HEXDECONLY,""),a=a.replace(/[ \n]+/g,"");var b=parseBigInt(a,16);if(b.bitLength()>this.n.bitLength())return 0;var h=this.doPublic(b),g=h.toString(16).replace(/^1f+00/,""),c=_rsasign_getAlgNameAndHashFromHexDisgestInfo(g);if(0==c.length)return!1;var f=(c[0],c[1]);return f==e}function _rsasign_verifyStringPSS(c,b,a,f){var e=function(g){return KJUR.crypto.Util.hashHex(g,a)},d=e(rstrtohex(c));return void 0===f&&(f=-1),this.verifyWithMessageHashPSS(d,b,a,f)}function _rsasign_verifyWithMessageHashPSS(f,s,l,c){var k=new BigInteger(s,16);if(k.bitLength()>this.n.bitLength())return!1;var q,r=function(i){return KJUR.crypto.Util.hashHex(i,l)},j=hextorstr(f),h=j.length,g=this.n.bitLength()-1,m=Math.ceil(g/8);if(-1===c||void 0===c)c=h;else if(-2===c)c=m-h-2;else if(-2>c)throw"invalid salt length";if(h+c+2>m)throw"data too long";var a=this.doPublic(k).toByteArray();for(q=0;q<a.length;q+=1)a[q]&=255;for(;a.length<m;)a.unshift(0);if(188!==a[m-1])throw"encoded message does not end in 0xbc";a=String.fromCharCode.apply(String,a);var d=a.substr(0,m-h-1),e=a.substr(d.length,h),p=65280>>8*m-g&255;if(0!==(d.charCodeAt(0)&p))throw"bits beyond keysize not zero";var n=pss_mgf1_str(e,d.length,r),o=[];for(q=0;q<d.length;q+=1)o[q]=d.charCodeAt(q)^n.charCodeAt(q);o[0]&=~p;var b=m-h-c-2;for(q=0;b>q;q+=1)if(0!==o[q])throw"leftmost octets not zero";if(1!==o[b])throw"0x01 marker not found";return e===hextorstr(r(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+j+String.fromCharCode.apply(String,o.slice(-c)))))}function X509(){this.subjectPublicKeyRSA=null,this.subjectPublicKeyRSA_hN=null,this.subjectPublicKeyRSA_hE=null,this.hex=null,this.getSerialNumberHex=function(){return ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,1])},this.getIssuerHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3])},this.getIssuerString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3]))},this.getSubjectHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5])},this.getSubjectString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5]))},this.getNotBefore=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,0]);return s=s.replace(/(..)/g,"%$1"),s=decodeURIComponent(s)},this.getNotAfter=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,1]);return s=s.replace(/(..)/g,"%$1"),s=decodeURIComponent(s)},this.readCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert),rsa=new RSAKey;rsa.setPublic(a[0],a[1]),this.subjectPublicKeyRSA=rsa,this.subjectPublicKeyRSA_hN=a[0],this.subjectPublicKeyRSA_hE=a[1],this.hex=hCert},this.readCertPEMWithoutRSAInit=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert);this.subjectPublicKeyRSA.setPublic(a[0],a[1]),this.subjectPublicKeyRSA_hN=a[0],this.subjectPublicKeyRSA_hE=a[1],this.hex=hCert}}function Base64x(){}function stoBA(s){for(var a=new Array,i=0;i<s.length;i++)a[i]=s.charCodeAt(i);return a}function BAtos(a){for(var s="",i=0;i<a.length;i++)s+=String.fromCharCode(a[i]);return s}function BAtohex(a){for(var s="",i=0;i<a.length;i++){var hex1=a[i].toString(16);1==hex1.length&&(hex1="0"+hex1),s+=hex1}return s}function stohex(s){return BAtohex(stoBA(s))}function stob64(s){return hex2b64(stohex(s))}function stob64u(s){return b64tob64u(hex2b64(stohex(s)))}function b64utos(s){return BAtos(b64toBA(b64utob64(s)))}function b64tob64u(s){return s=s.replace(/\=/g,""),s=s.replace(/\+/g,"-"),s=s.replace(/\//g,"_")}function b64utob64(s){return s.length%4==2?s+="==":s.length%4==3&&(s+="="),s=s.replace(/-/g,"+"),s=s.replace(/_/g,"/")}function hextob64u(s){return b64tob64u(hex2b64(s))}function b64utohex(s){return b64tohex(b64utob64(s))}function utf8tob64(s){return hex2b64(uricmptohex(encodeURIComponentAll(s)))}function b64toutf8(s){return decodeURIComponent(hextouricmp(b64tohex(s)))}function utf8tohex(s){return uricmptohex(encodeURIComponentAll(s))}function hextoutf8(s){return decodeURIComponent(hextouricmp(s))}function hextorstr(sHex){for(var s="",i=0;i<sHex.length-1;i+=2)s+=String.fromCharCode(parseInt(sHex.substr(i,2),16));return s}function rstrtohex(s){for(var result="",i=0;i<s.length;i++)result+=("0"+s.charCodeAt(i).toString(16)).slice(-2);return result}function hextob64(s){return hex2b64(s)}function hextob64nl(s){var b64=hextob64(s),b64nl=b64.replace(/(.{64})/g,"$1\r\n");return b64nl=b64nl.replace(/\r\n$/,"")}function b64nltohex(s){var b64=s.replace(/[^0-9A-Za-z\/+=]*/g,""),hex=b64tohex(b64);return hex}function uricmptohex(s){return s.replace(/%/g,"")}function hextouricmp(s){return s.replace(/(..)/g,"%$1")}function encodeURIComponentAll(u8){for(var s=encodeURIComponent(u8),s2="",i=0;i<s.length;i++)"%"==s[i]?(s2+=s.substr(i,3),i+=2):s2=s2+"%"+stohex(s[i]);return s2}function newline_toUnix(s){return s=s.replace(/\r\n/gm,"\n")}function newline_toDos(s){return s=s.replace(/\r\n/gm,"\n"),s=s.replace(/\n/gm,"\r\n")}function DefaultHttpRequest(){function setHeaders(xhr,headers){for(var keys=Object.keys(headers),i=0;i<keys.length;i++){var key=keys[i],value=headers[key];xhr.setRequestHeader(key,value)}}this.getJSON=function(url,config){return _promiseFactory.create(function(resolve,reject){try{var xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.responseType="json",config&&config.headers&&setHeaders(xhr,config.headers),xhr.onload=function(){try{if(200===xhr.status){var response=xhr.response;"string"==typeof response&&(response=JSON.parse(response)),resolve(response)}else reject(Error(xhr.statusText+"("+xhr.status+")"))}catch(err){reject(err)}},xhr.onerror=function(){reject(Error("Network error"))},xhr.send()}catch(err){return reject(err)}})}}function DefaultPromise(promise){this.then=function(successCallback,errorCallback){var childPromise=promise.then(successCallback,errorCallback);return new DefaultPromise(childPromise)},this["catch"]=function(errorCallback){var childPromise=promise["catch"](errorCallback);return new DefaultPromise(childPromise)}}function DefaultPromiseFactory(){this.resolve=function(value){return new DefaultPromise(Promise.resolve(value))},this.reject=function(reason){return new DefaultPromise(Promise.reject(reason))},this.create=function(callback){return new DefaultPromise(new Promise(callback))}}function log(){}function copy(obj,target){target=target||{};for(var key in obj)obj.hasOwnProperty(key)&&(target[key]=obj[key]);return target}function rand(){return((Date.now()+Math.random())*Math.random()).toString().replace(".","")}function error(message){return _promiseFactory.reject(Error(message))}function parseOidcResult(queryString){log("parseOidcResult"),queryString=queryString||location.hash;var idx=queryString.lastIndexOf("#");idx>=0&&(queryString=queryString.substr(idx+1));for(var m,params={},regex=/([^&=]+)=([^&]*)/g,counter=0;m=regex.exec(queryString);)if(params[decodeURIComponent(m[1])]=decodeURIComponent(m[2]),counter++>50)return{error:"Response exceeded expected number of parameters"};for(var prop in params)return params}function getJson(url,token){log("getJson",url);var config={};return token&&(config.headers={Authorization:"Bearer "+token}),_httpRequest.getJSON(url,config)}function OidcClient(settings){this._settings=settings||{},this._settings.request_state_key||(this._settings.request_state_key="OidcClient.request_state"),this._settings.request_state_store||(this._settings.request_state_store=window.localStorage),"undefined"==typeof this._settings.load_user_profile&&(this._settings.load_user_profile=!0),"undefined"==typeof this._settings.filter_protocol_claims&&(this._settings.filter_protocol_claims=!0),this._settings.authority&&this._settings.authority.indexOf(".well-known/openid-configuration")<0&&("/"!==this._settings.authority[this._settings.authority.length-1]&&(this._settings.authority+="/"),this._settings.authority+=".well-known/openid-configuration"),this._settings.response_type||(this._settings.response_type="id_token token"),Object.defineProperty(this,"isOidc",{get:function(){if(this._settings.response_type){var result=this._settings.response_type.split(/\s+/g).filter(function(item){return"id_token"===item});return!!result[0]}return!1}}),Object.defineProperty(this,"isOAuth",{get:function(){if(this._settings.response_type){var result=this._settings.response_type.split(/\s+/g).filter(function(item){return"token"===item});return!!result[0]}return!1}})}var _promiseFactory,_httpRequest,CryptoJS=CryptoJS||function(Math,undefined){var C={},C_lib=C.lib={},Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;return overrides&&subtype.mixIn(overrides),subtype.hasOwnProperty("init")||(subtype.init=function(){subtype.$super.init.apply(this,arguments)}),subtype.init.prototype=subtype,subtype.$super=this,subtype},create:function(){var instance=this.extend();return instance.init.apply(instance,arguments),instance},init:function(){},mixIn:function(properties){for(var propertyName in properties)properties.hasOwnProperty(propertyName)&&(this[propertyName]=properties[propertyName]);properties.hasOwnProperty("toString")&&(this.toString=properties.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],sigBytes!=undefined?this.sigBytes=sigBytes:this.sigBytes=4*words.length},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words,thatWords=wordArray.words,thisSigBytes=this.sigBytes,thatSigBytes=wordArray.sigBytes;if(this.clamp(),thisSigBytes%4)for(var i=0;thatSigBytes>i;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}else if(thatWords.length>65535)for(var i=0;thatSigBytes>i;i+=4)thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2];else thisWords.push.apply(thisWords,thatWords);return this.sigBytes+=thatSigBytes,this},clamp:function(){var words=this.words,sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8,words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);return clone.words=this.words.slice(0),clone},random:function(nBytes){for(var words=[],i=0;nBytes>i;i+=4)words.push(4294967296*Math.random()|0);return new WordArray.init(words,nBytes)}}),C_enc=C.enc={},Hex=C_enc.Hex={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,hexChars=[],i=0;sigBytes>i;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16)),hexChars.push((15&bite).toString(16))}return hexChars.join("")},parse:function(hexStr){for(var hexStrLength=hexStr.length,words=[],i=0;hexStrLength>i;i+=2)words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4;return new WordArray.init(words,hexStrLength/2)}},Latin1=C_enc.Latin1={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,latin1Chars=[],i=0;sigBytes>i;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){for(var latin1StrLength=latin1Str.length,words=[],i=0;latin1StrLength>i;i++)words[i>>>2]|=(255&latin1Str.charCodeAt(i))<<24-i%4*8;return new WordArray.init(words,latin1StrLength)}},Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}},BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init,
this._nDataBytes=0},_append:function(data){"string"==typeof data&&(data=Utf8.parse(data)),this._data.concat(data),this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data,dataWords=data.words,dataSigBytes=data.sigBytes,blockSize=this.blockSize,blockSizeBytes=4*blockSize,nBlocksReady=dataSigBytes/blockSizeBytes;nBlocksReady=doFlush?Math.ceil(nBlocksReady):Math.max((0|nBlocksReady)-this._minBufferSize,0);var nWordsReady=nBlocksReady*blockSize,nBytesReady=Math.min(4*nWordsReady,dataSigBytes);if(nWordsReady){for(var offset=0;nWordsReady>offset;offset+=blockSize)this._doProcessBlock(dataWords,offset);var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0}),C_algo=(C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg),this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this),this._doReset()},update:function(messageUpdate){return this._append(messageUpdate),this._process(),this},finalize:function(messageUpdate){messageUpdate&&this._append(messageUpdate);var hash=this._doFinalize();return hash},blockSize:16,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}}),C.algo={});return C}(Math);!function(){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,W=[],SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=new WordArray.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],i=0;80>i;i++){if(16>i)W[i]=0|M[offset+i];else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=n<<1|n>>>31}var t=(a<<5|a>>>27)+e+W[i];t+=20>i?(b&c|~b&d)+1518500249:40>i?(b^c^d)+1859775393:60>i?(b&c|b&d|c&d)-1894007588:(b^c^d)-899497514,e=d,d=c,c=b<<30|b>>>2,b=a,a=t}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA1=Hasher._createHelper(SHA1),C.HmacSHA1=Hasher._createHmacHelper(SHA1)}(),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,H=[],K=[];!function(){function isPrime(n){for(var sqrtN=Math.sqrt(n),factor=2;sqrtN>=factor;factor++)if(!(n%factor))return!1;return!0}function getFractionalBits(n){return 4294967296*(n-(0|n))|0}for(var n=2,nPrime=0;64>nPrime;)isPrime(n)&&(8>nPrime&&(H[nPrime]=getFractionalBits(Math.pow(n,.5))),K[nPrime]=getFractionalBits(Math.pow(n,1/3)),nPrime++),n++}();var W=[],SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],f=H[5],g=H[6],h=H[7],i=0;64>i;i++){if(16>i)W[i]=0|M[offset+i];else{var gamma0x=W[i-15],gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3,gamma1x=W[i-2],gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var ch=e&f^~e&g,maj=a&b^a&c^b&c,sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25),t1=h+sigma1+ch+K[i]+W[i],t2=sigma0+maj;h=g,g=f,f=e,e=d+t1|0,d=c,c=b,b=a,a=t1+t2|0}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0,H[5]=H[5]+f|0,H[6]=H[6]+g|0,H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA256=Hasher._createHelper(SHA256),C.HmacSHA256=Hasher._createHmacHelper(SHA256)}(Math),function(undefined){var C=CryptoJS,C_lib=C.lib,Base=C_lib.Base,X32WordArray=C_lib.WordArray,C_x64=C.x64={};C_x64.Word=Base.extend({init:function(high,low){this.high=high,this.low=low}}),C_x64.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],sigBytes!=undefined?this.sigBytes=sigBytes:this.sigBytes=8*words.length},toX32:function(){for(var x64Words=this.words,x64WordsLength=x64Words.length,x32Words=[],i=0;x64WordsLength>i;i++){var x64Word=x64Words[i];x32Words.push(x64Word.high),x32Words.push(x64Word.low)}return X32WordArray.create(x32Words,this.sigBytes)},clone:function(){for(var clone=Base.clone.call(this),words=clone.words=this.words.slice(0),wordsLength=words.length,i=0;wordsLength>i;i++)words[i]=words[i].clone();return clone}})}(),function(){function X64Word_create(){return X64Word.create.apply(X64Word,arguments)}var C=CryptoJS,C_lib=C.lib,Hasher=C_lib.Hasher,C_x64=C.x64,X64Word=C_x64.Word,X64WordArray=C_x64.WordArray,C_algo=C.algo,K=[X64Word_create(1116352408,3609767458),X64Word_create(1899447441,602891725),X64Word_create(3049323471,3964484399),X64Word_create(3921009573,2173295548),X64Word_create(961987163,4081628472),X64Word_create(1508970993,3053834265),X64Word_create(2453635748,2937671579),X64Word_create(2870763221,3664609560),X64Word_create(3624381080,2734883394),X64Word_create(310598401,1164996542),X64Word_create(607225278,1323610764),X64Word_create(1426881987,3590304994),X64Word_create(1925078388,4068182383),X64Word_create(2162078206,991336113),X64Word_create(2614888103,633803317),X64Word_create(3248222580,3479774868),X64Word_create(3835390401,2666613458),X64Word_create(4022224774,944711139),X64Word_create(264347078,2341262773),X64Word_create(604807628,2007800933),X64Word_create(770255983,1495990901),X64Word_create(1249150122,1856431235),X64Word_create(1555081692,3175218132),X64Word_create(1996064986,2198950837),X64Word_create(2554220882,3999719339),X64Word_create(2821834349,766784016),X64Word_create(2952996808,2566594879),X64Word_create(3210313671,3203337956),X64Word_create(3336571891,1034457026),X64Word_create(3584528711,2466948901),X64Word_create(113926993,3758326383),X64Word_create(338241895,168717936),X64Word_create(666307205,1188179964),X64Word_create(773529912,1546045734),X64Word_create(1294757372,1522805485),X64Word_create(1396182291,2643833823),X64Word_create(1695183700,2343527390),X64Word_create(1986661051,1014477480),X64Word_create(2177026350,1206759142),X64Word_create(2456956037,344077627),X64Word_create(2730485921,1290863460),X64Word_create(2820302411,3158454273),X64Word_create(3259730800,3505952657),X64Word_create(3345764771,106217008),X64Word_create(3516065817,3606008344),X64Word_create(3600352804,1432725776),X64Word_create(4094571909,1467031594),X64Word_create(275423344,851169720),X64Word_create(430227734,3100823752),X64Word_create(506948616,1363258195),X64Word_create(659060556,3750685593),X64Word_create(883997877,3785050280),X64Word_create(958139571,3318307427),X64Word_create(1322822218,3812723403),X64Word_create(1537002063,2003034995),X64Word_create(1747873779,3602036899),X64Word_create(1955562222,1575990012),X64Word_create(2024104815,1125592928),X64Word_create(2227730452,2716904306),X64Word_create(2361852424,442776044),X64Word_create(2428436474,593698344),X64Word_create(2756734187,3733110249),X64Word_create(3204031479,2999351573),X64Word_create(3329325298,3815920427),X64Word_create(3391569614,3928383900),X64Word_create(3515267271,566280711),X64Word_create(3940187606,3454069534),X64Word_create(4118630271,4000239992),X64Word_create(116418474,1914138554),X64Word_create(174292421,2731055270),X64Word_create(289380356,3203993006),X64Word_create(460393269,320620315),X64Word_create(685471733,587496836),X64Word_create(852142971,1086792851),X64Word_create(1017036298,365543100),X64Word_create(1126000580,2618297676),X64Word_create(1288033470,3409855158),X64Word_create(1501505948,4234509866),X64Word_create(1607167915,987167468),X64Word_create(1816402316,1246189591)],W=[];!function(){for(var i=0;80>i;i++)W[i]=X64Word_create()}();var SHA512=C_algo.SHA512=Hasher.extend({_doReset:function(){this._hash=new X64WordArray.init([new X64Word.init(1779033703,4089235720),new X64Word.init(3144134277,2227873595),new X64Word.init(1013904242,4271175723),new X64Word.init(2773480762,1595750129),new X64Word.init(1359893119,2917565137),new X64Word.init(2600822924,725511199),new X64Word.init(528734635,4215389547),new X64Word.init(1541459225,327033209)])},_doProcessBlock:function(M,offset){for(var H=this._hash.words,H0=H[0],H1=H[1],H2=H[2],H3=H[3],H4=H[4],H5=H[5],H6=H[6],H7=H[7],H0h=H0.high,H0l=H0.low,H1h=H1.high,H1l=H1.low,H2h=H2.high,H2l=H2.low,H3h=H3.high,H3l=H3.low,H4h=H4.high,H4l=H4.low,H5h=H5.high,H5l=H5.low,H6h=H6.high,H6l=H6.low,H7h=H7.high,H7l=H7.low,ah=H0h,al=H0l,bh=H1h,bl=H1l,ch=H2h,cl=H2l,dh=H3h,dl=H3l,eh=H4h,el=H4l,fh=H5h,fl=H5l,gh=H6h,gl=H6l,hh=H7h,hl=H7l,i=0;80>i;i++){var Wi=W[i];if(16>i)var Wih=Wi.high=0|M[offset+2*i],Wil=Wi.low=0|M[offset+2*i+1];else{var gamma0x=W[i-15],gamma0xh=gamma0x.high,gamma0xl=gamma0x.low,gamma0h=(gamma0xh>>>1|gamma0xl<<31)^(gamma0xh>>>8|gamma0xl<<24)^gamma0xh>>>7,gamma0l=(gamma0xl>>>1|gamma0xh<<31)^(gamma0xl>>>8|gamma0xh<<24)^(gamma0xl>>>7|gamma0xh<<25),gamma1x=W[i-2],gamma1xh=gamma1x.high,gamma1xl=gamma1x.low,gamma1h=(gamma1xh>>>19|gamma1xl<<13)^(gamma1xh<<3|gamma1xl>>>29)^gamma1xh>>>6,gamma1l=(gamma1xl>>>19|gamma1xh<<13)^(gamma1xl<<3|gamma1xh>>>29)^(gamma1xl>>>6|gamma1xh<<26),Wi7=W[i-7],Wi7h=Wi7.high,Wi7l=Wi7.low,Wi16=W[i-16],Wi16h=Wi16.high,Wi16l=Wi16.low,Wil=gamma0l+Wi7l,Wih=gamma0h+Wi7h+(gamma0l>>>0>Wil>>>0?1:0),Wil=Wil+gamma1l,Wih=Wih+gamma1h+(gamma1l>>>0>Wil>>>0?1:0),Wil=Wil+Wi16l,Wih=Wih+Wi16h+(Wi16l>>>0>Wil>>>0?1:0);Wi.high=Wih,Wi.low=Wil}var chh=eh&fh^~eh&gh,chl=el&fl^~el&gl,majh=ah&bh^ah&ch^bh&ch,majl=al&bl^al&cl^bl&cl,sigma0h=(ah>>>28|al<<4)^(ah<<30|al>>>2)^(ah<<25|al>>>7),sigma0l=(al>>>28|ah<<4)^(al<<30|ah>>>2)^(al<<25|ah>>>7),sigma1h=(eh>>>14|el<<18)^(eh>>>18|el<<14)^(eh<<23|el>>>9),sigma1l=(el>>>14|eh<<18)^(el>>>18|eh<<14)^(el<<23|eh>>>9),Ki=K[i],Kih=Ki.high,Kil=Ki.low,t1l=hl+sigma1l,t1h=hh+sigma1h+(hl>>>0>t1l>>>0?1:0),t1l=t1l+chl,t1h=t1h+chh+(chl>>>0>t1l>>>0?1:0),t1l=t1l+Kil,t1h=t1h+Kih+(Kil>>>0>t1l>>>0?1:0),t1l=t1l+Wil,t1h=t1h+Wih+(Wil>>>0>t1l>>>0?1:0),t2l=sigma0l+majl,t2h=sigma0h+majh+(sigma0l>>>0>t2l>>>0?1:0);hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,el=dl+t1l|0,eh=dh+t1h+(dl>>>0>el>>>0?1:0)|0,dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,al=t1l+t2l|0,ah=t1h+t2h+(t1l>>>0>al>>>0?1:0)|0}H0l=H0.low=H0l+al,H0.high=H0h+ah+(al>>>0>H0l>>>0?1:0),H1l=H1.low=H1l+bl,H1.high=H1h+bh+(bl>>>0>H1l>>>0?1:0),H2l=H2.low=H2l+cl,H2.high=H2h+ch+(cl>>>0>H2l>>>0?1:0),H3l=H3.low=H3l+dl,H3.high=H3h+dh+(dl>>>0>H3l>>>0?1:0),H4l=H4.low=H4l+el,H4.high=H4h+eh+(el>>>0>H4l>>>0?1:0),H5l=H5.low=H5l+fl,H5.high=H5h+fh+(fl>>>0>H5l>>>0?1:0),H6l=H6.low=H6l+gl,H6.high=H6h+gh+(gl>>>0>H6l>>>0?1:0),H7l=H7.low=H7l+hl,H7.high=H7h+hh+(hl>>>0>H7l>>>0?1:0)},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+128>>>10<<5)+30]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+128>>>10<<5)+31]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process();var hash=this._hash.toX32();return hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone},blockSize:32});C.SHA512=Hasher._createHelper(SHA512),C.HmacSHA512=Hasher._createHmacHelper(SHA512)}();var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=",dbits,canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary);j_lm&&"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=am2,dbits=30):j_lm&&"Netscape"!=navigator.appName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;9>=vv;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;var SHA1_SIZE=20;RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA";var SHA1_SIZE=20;RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP,RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString,RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi"),RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash,RSAKey.prototype.signString=_rsasign_signString,RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.sign=_rsasign_signString,RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS,RSAKey.prototype.signStringPSS=_rsasign_signStringPSS,RSAKey.prototype.signPSS=_rsasign_signStringPSS,RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash,RSAKey.prototype.verifyString=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verify=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS,RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS,RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS,RSAKey.SALT_LEN_RECOVER=-2;var ASN1HEX=new function(){this.getByteLengthOfL_AtObj=function(s,pos){if("8"!=s.substring(pos+2,pos+3))return 1;var i=parseInt(s.substring(pos+3,pos+4));return 0==i?-1:i>0&&10>i?i+1:-2},this.getHexOfL_AtObj=function(s,pos){var len=this.getByteLengthOfL_AtObj(s,pos);return 1>len?"":s.substring(pos+2,pos+2+2*len)},this.getIntOfL_AtObj=function(s,pos){var hLength=this.getHexOfL_AtObj(s,pos);if(""==hLength)return-1;var bi;return bi=parseInt(hLength.substring(0,1))<8?new BigInteger(hLength,16):new BigInteger(hLength.substring(2),16),bi.intValue()},this.getStartPosOfV_AtObj=function(s,pos){var l_len=this.getByteLengthOfL_AtObj(s,pos);return 0>l_len?l_len:pos+2*(l_len+1)},this.getHexOfV_AtObj=function(s,pos){var pos1=this.getStartPosOfV_AtObj(s,pos),len=this.getIntOfL_AtObj(s,pos);return s.substring(pos1,pos1+2*len)},this.getHexOfTLV_AtObj=function(s,pos){var hT=s.substr(pos,2),hL=this.getHexOfL_AtObj(s,pos),hV=this.getHexOfV_AtObj(s,pos);return hT+hL+hV},this.getPosOfNextSibling_AtObj=function(s,pos){var pos1=this.getStartPosOfV_AtObj(s,pos),len=this.getIntOfL_AtObj(s,pos);return pos1+2*len},this.getPosArrayOfChildren_AtObj=function(h,pos){var a=new Array,p0=this.getStartPosOfV_AtObj(h,pos);a.push(p0);for(var len=this.getIntOfL_AtObj(h,pos),p=p0,k=0;;){var pNext=this.getPosOfNextSibling_AtObj(h,p);if(null==pNext||pNext-p0>=2*len)break;if(k>=200)break;a.push(pNext),p=pNext,k++}return a},this.getNthChildIndex_AtObj=function(h,idx,nth){var a=this.getPosArrayOfChildren_AtObj(h,idx);return a[nth]},this.getDecendantIndexByNthList=function(h,currentIndex,nthList){if(0==nthList.length)return currentIndex;var firstNth=nthList.shift(),a=this.getPosArrayOfChildren_AtObj(h,currentIndex);return this.getDecendantIndexByNthList(h,a[firstNth],nthList)},this.getDecendantHexTLVByNthList=function(h,currentIndex,nthList){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);return this.getHexOfTLV_AtObj(h,idx)},this.getDecendantHexVByNthList=function(h,currentIndex,nthList){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);return this.getHexOfV_AtObj(h,idx)}};ASN1HEX.getVbyList=function(h,currentIndex,nthList,checkingTag){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);if(void 0===idx)throw"can't find nthList object";if(void 0!==checkingTag&&h.substr(idx,2)!=checkingTag)throw"checking tag doesn't match: "+h.substr(idx,2)+"!="+checkingTag;return this.getHexOfV_AtObj(h,idx)},ASN1HEX.hextooidstr=function(hex){var zeroPadding=function(s,len){return s.length>=len?s:new Array(len-s.length+1).join("0")+s},a=[],hex0=hex.substr(0,2),i0=parseInt(hex0,16);a[0]=new String(Math.floor(i0/40)),a[1]=new String(i0%40);for(var hex1=hex.substr(2),b=[],i=0;i<hex1.length/2;i++)b.push(parseInt(hex1.substr(2*i,2),16));for(var c=[],cbin="",i=0;i<b.length;i++)128&b[i]?cbin+=zeroPadding((127&b[i]).toString(2),7):(cbin+=zeroPadding((127&b[i]).toString(2),7),c.push(new String(parseInt(cbin,2))),cbin="");var s=a.join(".");return c.length>0&&(s=s+"."+c.join(".")),s},X509.pemToBase64=function(sCertPEM){var s=sCertPEM;return s=s.replace("-----BEGIN CERTIFICATE-----",""),s=s.replace("-----END CERTIFICATE-----",""),s=s.replace(/[ \n]+/g,"")},X509.pemToHex=function(sCertPEM){var b64Cert=X509.pemToBase64(sCertPEM),hCert=b64tohex(b64Cert);return hCert},X509.getSubjectPublicKeyPosFromCertHex=function(hCert){var pInfo=X509.getSubjectPublicKeyInfoPosFromCertHex(hCert);if(-1==pInfo)return-1;var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pInfo);if(2!=a.length)return-1;var pBitString=a[1];if("03"!=hCert.substring(pBitString,pBitString+2))return-1;var pBitStringV=ASN1HEX.getStartPosOfV_AtObj(hCert,pBitString);return"00"!=hCert.substring(pBitStringV,pBitStringV+2)?-1:pBitStringV+2},X509.getSubjectPublicKeyInfoPosFromCertHex=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0),a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pTbsCert);return a.length<1?-1:"a003020102"==hCert.substring(a[0],a[0]+10)?a.length<6?-1:a[6]:a.length<5?-1:a[5]},X509.getPublicKeyHexArrayFromCertHex=function(hCert){var p=X509.getSubjectPublicKeyPosFromCertHex(hCert),a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,p);if(2!=a.length)return[];var hN=ASN1HEX.getHexOfV_AtObj(hCert,a[0]),hE=ASN1HEX.getHexOfV_AtObj(hCert,a[1]);return null!=hN&&null!=hE?[hN,hE]:[]},X509.getHexTbsCertificateFromCert=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0);return pTbsCert},X509.getPublicKeyHexArrayFromCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert);return a},X509.hex2dn=function(hDN){for(var s="",a=ASN1HEX.getPosArrayOfChildren_AtObj(hDN,0),i=0;i<a.length;i++){var hRDN=ASN1HEX.getHexOfTLV_AtObj(hDN,a[i]);s=s+"/"+X509.hex2rdn(hRDN)}return s},X509.hex2rdn=function(hRDN){var hType=ASN1HEX.getDecendantHexTLVByNthList(hRDN,0,[0,0]),hValue=ASN1HEX.getDecendantHexVByNthList(hRDN,0,[0,1]),type="";try{type=X509.DN_ATTRHEX[hType]}catch(ex){type=hType}hValue=hValue.replace(/(..)/g,"%$1");var value=decodeURIComponent(hValue);return type+"="+value},X509.DN_ATTRHEX={"0603550406":"C","060355040a":"O","060355040b":"OU","0603550403":"CN","0603550405":"SN","0603550408":"ST","0603550407":"L"},X509.getPublicKeyFromCertPEM=function(sCertPEM){var info=X509.getPublicKeyInfoPropOfCertPEM(sCertPEM);if("2a864886f70d010101"==info.algoid){var aRSA=KEYUTIL.parsePublicRawRSAKeyHex(info.keyhex),key=new RSAKey;return key.setPublic(aRSA.n,aRSA.e),key}if("2a8648ce3d0201"==info.algoid){var curveName=KJUR.crypto.OID.oidhex2name[info.algparam],key=new KJUR.crypto.ECDSA({curve:curveName,info:info.keyhex});return key.setPublicKeyHex(info.keyhex),key}if("2a8648ce380401"==info.algoid){var p=ASN1HEX.getVbyList(info.algparam,0,[0],"02"),q=ASN1HEX.getVbyList(info.algparam,0,[1],"02"),g=ASN1HEX.getVbyList(info.algparam,0,[2],"02"),y=ASN1HEX.getHexOfV_AtObj(info.keyhex,0);y=y.substr(2);var key=new KJUR.crypto.DSA;return key.setPublic(new BigInteger(p,16),new BigInteger(q,16),new BigInteger(g,16),new BigInteger(y,16)),key}throw"unsupported key"},X509.getPublicKeyInfoPropOfCertPEM=function(sCertPEM){var result={};result.algparam=null;var hCert=X509.pemToHex(sCertPEM),a1=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,0);if(3!=a1.length)throw"malformed X.509 certificate PEM (code:001)";if("30"!=hCert.substr(a1[0],2))throw"malformed X.509 certificate PEM (code:002)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a1[0]);if(a2.length<7)throw"malformed X.509 certificate PEM (code:003)";var a3=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a2[6]);if(2!=a3.length)throw"malformed X.509 certificate PEM (code:004)";var a4=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a3[0]);if(2!=a4.length)throw"malformed X.509 certificate PEM (code:005)";if(result.algoid=ASN1HEX.getHexOfV_AtObj(hCert,a4[0]),"06"==hCert.substr(a4[1],2)?result.algparam=ASN1HEX.getHexOfV_AtObj(hCert,a4[1]):"30"==hCert.substr(a4[1],2)&&(result.algparam=ASN1HEX.getHexOfTLV_AtObj(hCert,a4[1])),"03"!=hCert.substr(a3[1],2))throw"malformed X.509 certificate PEM (code:006)";var unusedBitAndKeyHex=ASN1HEX.getHexOfV_AtObj(hCert,a3[1]);return result.keyhex=unusedBitAndKeyHex.substr(2),result},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:"CryptoJS.algo.MD5",sha1:"CryptoJS.algo.SHA1",sha224:"CryptoJS.algo.SHA224",sha256:"CryptoJS.algo.SHA256",sha384:"CryptoJS.algo.SHA384",sha512:"CryptoJS.algo.SHA512",ripemd160:"CryptoJS.algo.RIPEMD160"},this.getDigestInfoHex=function(hHash,alg){if("undefined"==typeof this.DIGESTINFOHEAD[alg])throw"alg not supported in Util.DIGESTINFOHEAD: "+alg;return this.DIGESTINFOHEAD[alg]+hHash},this.getPaddedDigestInfoHex=function(hHash,alg,keySize){var hDigestInfo=this.getDigestInfoHex(hHash,alg),pmStrLen=keySize/4;if(hDigestInfo.length+22>pmStrLen)throw"key is too short for SigAlg: keylen="+keySize+","+alg;for(var hHead="0001",hTail="00"+hDigestInfo,hMid="",fLen=pmStrLen-hHead.length-hTail.length,i=0;fLen>i;i+=2)hMid+="ff";var hPaddedMessage=hHead+hMid+hTail;return hPaddedMessage},this.hashString=function(s,alg){var md=new KJUR.crypto.MessageDigest({alg:alg});return md.digestString(s)},this.hashHex=function(sHex,alg){var md=new KJUR.crypto.MessageDigest({alg:alg});return md.digestHex(sHex)},this.sha1=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"});return md.digestString(s)},this.sha256=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestString(s)},this.sha256Hex=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestHex(s)},this.sha512=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestString(s)},this.sha512Hex=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestHex(s)},this.md5=function(s){var md=new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return md.digestString(s)},this.ripemd160=function(s){var md=new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return md.digestString(s)},this.getCryptoJSMDByName=function(s){}},KJUR.crypto.MessageDigest=function(params){var md=null,algName=null,provName=null;this.setAlgAndProvider=function(alg,prov){if(null!=alg&&void 0===prov&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(alg)&&"cryptojs"==prov){try{this.md=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[alg]).create()}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)},this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.md.update(wHex)},this.digest=function(){var hash=this.md.finalize();return hash.toString(CryptoJS.enc.Hex)},this.digestString=function(str){return this.updateString(str),this.digest()},this.digestHex=function(hex){return this.updateHex(hex),this.digest()}}if(-1!=":sha256:".indexOf(alg)&&"sjcl"==prov){try{this.md=new sjcl.hash.sha256}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)},this.updateHex=function(hex){var baHex=sjcl.codec.hex.toBits(hex);this.md.update(baHex)},this.digest=function(){var hash=this.md.finalize();return sjcl.codec.hex.fromBits(hash)},this.digestString=function(str){return this.updateString(str),this.digest()},this.digestHex=function(hex){return this.updateHex(hex),this.digest()}}},this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==params&&void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.Mac=function(params){var mac=null,pass=null,algName=null,provName=null,algProv=null;this.setAlgAndProvider=function(alg,prov){if(null==alg&&(alg="hmacsha1"),alg=alg.toLowerCase(),"hmac"!=alg.substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+alg;
void 0===prov&&(prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg]),this.algProv=alg+"/"+prov;var hashAlg=alg.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(hashAlg)&&"cryptojs"==prov){try{var mdObj=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[hashAlg]);this.mac=CryptoJS.algo.HMAC.create(mdObj,this.pass)}catch(ex){throw"setAlgAndProvider hash alg set fail hashAlg="+hashAlg+"/"+ex}this.updateString=function(str){this.mac.update(str)},this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.mac.update(wHex)},this.doFinal=function(){var hash=this.mac.finalize();return hash.toString(CryptoJS.enc.Hex)},this.doFinalString=function(str){return this.updateString(str),this.doFinal()},this.doFinalHex=function(hex){return this.updateHex(hex),this.doFinal()}}},this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},void 0!==params&&(void 0!==params.pass&&(this.pass=params.pass),void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(params){var prvKey=null;if(this._setAlgNames=function(){this.algName.match(/^(.+)with(.+)$/)&&(this.mdAlgName=RegExp.$1.toLowerCase(),this.pubkeyAlgName=RegExp.$2.toLowerCase())},this._zeroPaddingOfSignature=function(hex,bitLength){for(var s="",nZero=bitLength/4-hex.length,i=0;nZero>i;i++)s+="0";return s+hex},this.setAlgAndProvider=function(alg,prov){if(this._setAlgNames(),"cryptojs/jsrsa"!=prov)throw"provider not supported: "+prov;if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+ex}this.init=function(keyparam,pass){var keyObj=null;try{keyObj=void 0===pass?KEYUTIL.getKey(keyparam):KEYUTIL.getKey(keyparam,pass)}catch(ex){throw"init failed:"+ex}if(keyObj.isPrivate===!0)this.prvKey=keyObj,this.state="SIGN";else{if(keyObj.isPublic!==!0)throw"init failed.:"+keyObj;this.pubKey=keyObj,this.state="VERIFY"}},this.initSign=function(params){"string"==typeof params.ecprvhex&&"string"==typeof params.eccurvename?(this.ecprvhex=params.ecprvhex,this.eccurvename=params.eccurvename):this.prvKey=params,this.state="SIGN"},this.initVerifyByPublicKey=function(params){"string"==typeof params.ecpubhex&&"string"==typeof params.eccurvename?(this.ecpubhex=params.ecpubhex,this.eccurvename=params.eccurvename):params instanceof KJUR.crypto.ECDSA?this.pubKey=params:params instanceof RSAKey&&(this.pubKey=params),this.state="VERIFY"},this.initVerifyByCertificatePEM=function(certPEM){var x509=new X509;x509.readCertPEM(certPEM),this.pubKey=x509.subjectPublicKeyRSA,this.state="VERIFY"},this.updateString=function(str){this.md.updateString(str)},this.updateHex=function(hex){this.md.updateHex(hex)},this.sign=function(){if(this.sHashHex=this.md.digest(),"undefined"!=typeof this.ecprvhex&&"undefined"!=typeof this.eccurvename){var ec=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=ec.signHex(this.sHashHex,this.ecprvhex)}else if("rsaandmgf1"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if("rsa"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(str){return this.updateString(str),this.sign()},this.signHex=function(hex){return this.updateHex(hex),this.sign()},this.verify=function(hSigVal){if(this.sHashHex=this.md.digest(),"undefined"!=typeof this.ecpubhex&&"undefined"!=typeof this.eccurvename){var ec=new KJUR.crypto.ECDSA({curve:this.eccurvename});return ec.verifyHex(this.sHashHex,hSigVal,this.ecpubhex)}if("rsaandmgf1"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,hSigVal,this.mdAlgName,this.pssSaltLen);if("rsa"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal);if(this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal);if(this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(key,pass){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.initVerifyByPublicKey=function(rsaPubKey){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName},this.initVerifyByCertificatePEM=function(certPEM){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName},this.initSign=function(prvKey){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName},this.updateString=function(str){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(str){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(hex){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(hSigVal){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=params,void 0!==params&&(void 0!==params.alg&&(this.algName=params.alg,void 0===params.prov?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=params.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==params.psssaltlen&&(this.pssSaltLen=params.psssaltlen),void 0!==params.prvkeypem)){if(void 0!==params.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{var prvKey=new RSAKey;prvKey.readPrivateKeyFromPEMString(params.prvkeypem),this.initSign(prvKey)}catch(ex){throw"fatal error to load pem private key: "+ex}}},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};var utf8tob64u,b64utoutf8;"function"==typeof Buffer?(utf8tob64u=function(s){return b64tob64u(new Buffer(s,"utf8").toString("base64"))},b64utoutf8=function(s){return new Buffer(b64utob64(s),"base64").toString("utf8")}):(utf8tob64u=function(s){return hextob64u(uricmptohex(encodeURIComponentAll(s)))},b64utoutf8=function(s){return decodeURIComponent(hextouricmp(b64utohex(s)))});var jsonParse=function(){function unescapeOne(_,ch,hex){return ch?escapes[ch]:String.fromCharCode(parseInt(hex,16))}var number="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",oneChar='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',string='(?:"'+oneChar+'*")',jsonToken=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+number+"|"+string+")","g"),escapeSequence=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),escapes={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},EMPTY_STRING=new String(""),SLASH="\\",hop=({"{":Object,"[":Array},Object.hasOwnProperty);return function(json,opt_reviver){var result,toks=json.match(jsonToken),tok=toks[0],topLevelPrimitive=!1;"{"===tok?result={}:"["===tok?result=[]:(result=[],topLevelPrimitive=!0);for(var key,stack=[result],i=1-topLevelPrimitive,n=toks.length;n>i;++i){tok=toks[i];var cont;switch(tok.charCodeAt(0)){default:cont=stack[0],cont[key||cont.length]=+tok,key=void 0;break;case 34:if(tok=tok.substring(1,tok.length-1),-1!==tok.indexOf(SLASH)&&(tok=tok.replace(escapeSequence,unescapeOne)),cont=stack[0],!key){if(!(cont instanceof Array)){key=tok||EMPTY_STRING;break}key=cont.length}cont[key]=tok,key=void 0;break;case 91:cont=stack[0],stack.unshift(cont[key||cont.length]=[]),key=void 0;break;case 93:stack.shift();break;case 102:cont=stack[0],cont[key||cont.length]=!1,key=void 0;break;case 110:cont=stack[0],cont[key||cont.length]=null,key=void 0;break;case 116:cont=stack[0],cont[key||cont.length]=!0,key=void 0;break;case 123:cont=stack[0],stack.unshift(cont[key||cont.length]={}),key=void 0;break;case 125:stack.shift()}}if(topLevelPrimitive){if(1!==stack.length)throw new Error;result=result[0]}else if(stack.length)throw new Error;if(opt_reviver){var walk=function(holder,key){var value=holder[key];if(value&&"object"==typeof value){var toDelete=null;for(var k in value)if(hop.call(value,k)&&value!==holder){var v=walk(value,k);void 0!==v?value[k]=v:(toDelete||(toDelete=[]),toDelete.push(k))}if(toDelete)for(var i=toDelete.length;--i>=0;)delete value[toDelete[i]]}return opt_reviver.call(holder,key,value)};result=walk({"":result},"")}return result}}();"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){function _getSignatureInputByString(sHead,sPayload){return utf8tob64u(sHead)+"."+utf8tob64u(sPayload)}function _jws_getHashAlgFromParsedHead(head){var sigAlg=head.alg,hashAlg="";if("RS256"!=sigAlg&&"RS512"!=sigAlg&&"PS256"!=sigAlg&&"PS512"!=sigAlg)throw"JWS signature algorithm not supported: "+sigAlg;return"256"==sigAlg.substr(2)&&(hashAlg="sha256"),"512"==sigAlg.substr(2)&&(hashAlg="sha512"),hashAlg}function _jws_getHashAlgFromHead(sHead){return _jws_getHashAlgFromParsedHead(jsonParse(sHead))}function _jws_generateSignatureValueBySI_NED(sHead,sPayload,sSI,hN,hE,hD){var rsa=new RSAKey;rsa.setPrivate(hN,hE,hD);var hashAlg=_jws_getHashAlgFromHead(sHead),sigValue=rsa.signString(sSI,hashAlg);return sigValue}function _jws_generateSignatureValueBySI_Key(sHead,sPayload,sSI,key,head){var hashAlg=null;hashAlg="undefined"==typeof head?_jws_getHashAlgFromHead(sHead):_jws_getHashAlgFromParsedHead(head);var isPSS="PS"==head.alg.substr(0,2);return key.hashAndSign?b64tob64u(key.hashAndSign(hashAlg,sSI,"binary","base64",isPSS)):hextob64u(isPSS?key.signStringPSS(sSI,hashAlg):key.signString(sSI,hashAlg))}function _jws_generateSignatureValueBySI_PemPrvKey(sHead,sPayload,sSI,sPemPrvKey){var rsa=new RSAKey;rsa.readPrivateKeyFromPEMString(sPemPrvKey);var hashAlg=_jws_getHashAlgFromHead(sHead),sigValue=rsa.signString(sSI,hashAlg);return sigValue}this.parseJWS=function(sJWS,sigValNotNeeded){if(void 0===this.parsedJWS||!sigValNotNeeded&&void 0===this.parsedJWS.sigvalH){if(null==sJWS.match(/^([^.]+)\.([^.]+)\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var b6Head=RegExp.$1,b6Payload=RegExp.$2,b6SigVal=RegExp.$3,sSI=b6Head+"."+b6Payload;if(this.parsedJWS={},this.parsedJWS.headB64U=b6Head,this.parsedJWS.payloadB64U=b6Payload,this.parsedJWS.sigvalB64U=b6SigVal,this.parsedJWS.si=sSI,!sigValNotNeeded){var hSigVal=b64utohex(b6SigVal),biSigVal=parseBigInt(hSigVal,16);this.parsedJWS.sigvalH=hSigVal,this.parsedJWS.sigvalBI=biSigVal}var sHead=b64utoutf8(b6Head),sPayload=b64utoutf8(b6Payload);if(this.parsedJWS.headS=sHead,this.parsedJWS.payloadS=sPayload,!KJUR.jws.JWS.isSafeJSONString(sHead,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+sHead}},this.verifyJWSByNE=function(sJWS,hN,hE){return this.parseJWS(sJWS),_rsasign_verifySignatureWithArgs(this.parsedJWS.si,this.parsedJWS.sigvalBI,hN,hE)},this.verifyJWSByKey=function(sJWS,key){this.parseJWS(sJWS);var hashAlg=_jws_getHashAlgFromParsedHead(this.parsedJWS.headP),isPSS="PS"==this.parsedJWS.headP.alg.substr(0,2);return key.hashAndVerify?key.hashAndVerify(hashAlg,new Buffer(this.parsedJWS.si,"utf8").toString("base64"),b64utob64(this.parsedJWS.sigvalB64U),"base64",isPSS):isPSS?key.verifyStringPSS(this.parsedJWS.si,this.parsedJWS.sigvalH,hashAlg):key.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.verifyJWSByPemX509Cert=function(sJWS,sPemX509Cert){this.parseJWS(sJWS);var x509=new X509;return x509.readCertPEM(sPemX509Cert),x509.subjectPublicKeyRSA.verifyString(this.parsedJWS.si,this.parsedJWS.sigvalH)},this.generateJWSByNED=function(sHead,sPayload,hN,hE,hD){if(!KJUR.jws.JWS.isSafeJSONString(sHead))throw"JWS Head is not safe JSON string: "+sHead;var sSI=_getSignatureInputByString(sHead,sPayload),hSigValue=_jws_generateSignatureValueBySI_NED(sHead,sPayload,sSI,hN,hE,hD),b64SigValue=hextob64u(hSigValue);return this.parsedJWS={},this.parsedJWS.headB64U=sSI.split(".")[0],this.parsedJWS.payloadB64U=sSI.split(".")[1],this.parsedJWS.sigvalB64U=b64SigValue,sSI+"."+b64SigValue},this.generateJWSByKey=function(sHead,sPayload,key){var obj={};if(!KJUR.jws.JWS.isSafeJSONString(sHead,obj,"headP"))throw"JWS Head is not safe JSON string: "+sHead;var sSI=_getSignatureInputByString(sHead,sPayload),b64SigValue=_jws_generateSignatureValueBySI_Key(sHead,sPayload,sSI,key,obj.headP);return this.parsedJWS={},this.parsedJWS.headB64U=sSI.split(".")[0],this.parsedJWS.payloadB64U=sSI.split(".")[1],this.parsedJWS.sigvalB64U=b64SigValue,sSI+"."+b64SigValue},this.generateJWSByP1PrvKey=function(sHead,sPayload,sPemPrvKey){if(!KJUR.jws.JWS.isSafeJSONString(sHead))throw"JWS Head is not safe JSON string: "+sHead;var sSI=_getSignatureInputByString(sHead,sPayload),hSigValue=_jws_generateSignatureValueBySI_PemPrvKey(sHead,sPayload,sSI,sPemPrvKey),b64SigValue=hextob64u(hSigValue);return this.parsedJWS={},this.parsedJWS.headB64U=sSI.split(".")[0],this.parsedJWS.payloadB64U=sSI.split(".")[1],this.parsedJWS.sigvalB64U=b64SigValue,sSI+"."+b64SigValue}},KJUR.jws.JWS.sign=function(alg,sHeader,sPayload,key,pass){var ns1=KJUR.jws.JWS;if(!ns1.isSafeJSONString(sHeader))throw"JWS Head is not safe JSON string: "+sHead;var pHeader=ns1.readSafeJSONString(sHeader);""!=alg&&null!=alg||void 0===pHeader.alg||(alg=pHeader.alg),""!=alg&&null!=alg&&void 0===pHeader.alg&&(pHeader.alg=alg,sHeader=JSON.stringify(pHeader));var sigAlg=null;if(void 0===ns1.jwsalg2sigalg[alg])throw"unsupported alg name: "+alg;sigAlg=ns1.jwsalg2sigalg[alg];var uHeader=utf8tob64u(sHeader),uPayload=utf8tob64u(sPayload),uSignatureInput=uHeader+"."+uPayload,hSig="";if("Hmac"==sigAlg.substr(0,4)){if(void 0===key)throw"hexadecimal key shall be specified for HMAC";var mac=new KJUR.crypto.Mac({alg:sigAlg,pass:hextorstr(key)});mac.updateString(uSignatureInput),hSig=mac.doFinal()}else if(-1!=sigAlg.indexOf("withECDSA")){var sig=new KJUR.crypto.Signature({alg:sigAlg});sig.init(key,pass),sig.updateString(uSignatureInput),hASN1Sig=sig.sign(),hSig=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)}else if("none"!=sigAlg){var sig=new KJUR.crypto.Signature({alg:sigAlg});sig.init(key,pass),sig.updateString(uSignatureInput),hSig=sig.sign()}var uSig=hextob64u(hSig);return uSignatureInput+"."+uSig},KJUR.jws.JWS.verify=function(sJWS,key){var jws=KJUR.jws.JWS,a=sJWS.split("."),uHeader=a[0],uPayload=a[1],uSignatureInput=uHeader+"."+uPayload,hSig=b64utohex(a[2]),pHeader=jws.readSafeJSONString(b64utoutf8(a[0])),alg=null;if(void 0===pHeader.alg)throw"algorithm not specified in header";alg=pHeader.alg;var sigAlg=null;if(void 0===jws.jwsalg2sigalg[pHeader.alg])throw"unsupported alg name: "+alg;if(sigAlg=jws.jwsalg2sigalg[alg],"none"==sigAlg)return!0;if("Hmac"==sigAlg.substr(0,4)){if(void 0===key)throw"hexadecimal key shall be specified for HMAC";var mac=new KJUR.crypto.Mac({alg:sigAlg,pass:hextorstr(key)});return mac.updateString(uSignatureInput),hSig2=mac.doFinal(),hSig==hSig2}if(-1!=sigAlg.indexOf("withECDSA")){var hASN1Sig=null;try{hASN1Sig=KJUR.crypto.ECDSA.concatSigToASN1Sig(hSig)}catch(ex){return!1}var sig=new KJUR.crypto.Signature({alg:sigAlg});return sig.init(key),sig.updateString(uSignatureInput),sig.verify(hASN1Sig)}var sig=new KJUR.crypto.Signature({alg:sigAlg});return sig.init(key),sig.updateString(uSignatureInput),sig.verify(hSig)},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(s,h,p){var o=null;try{return o=jsonParse(s),"object"!=typeof o?0:o.constructor===Array?0:(h&&(h[p]=o),1)}catch(ex){return 0}},KJUR.jws.JWS.readSafeJSONString=function(s){var o=null;try{return o=jsonParse(s),"object"!=typeof o?null:o.constructor===Array?null:o}catch(ex){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(sJWS){if(null==sJWS.match(/^[^.]+\.[^.]+\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return RegExp.$1},KJUR.jws.IntDate=function(){},KJUR.jws.IntDate.get=function(s){if("now"==s)return KJUR.jws.IntDate.getNow();if("now + 1hour"==s)return KJUR.jws.IntDate.getNow()+3600;if("now + 1day"==s)return KJUR.jws.IntDate.getNow()+86400;if("now + 1month"==s)return KJUR.jws.IntDate.getNow()+2592e3;if("now + 1year"==s)return KJUR.jws.IntDate.getNow()+31536e3;if(s.match(/Z$/))return KJUR.jws.IntDate.getZulu(s);if(s.match(/^[0-9]+$/))return parseInt(s);throw"unsupported format: "+s},KJUR.jws.IntDate.getZulu=function(s){if(a=s.match(/(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/)){var year=parseInt(RegExp.$1),month=parseInt(RegExp.$2)-1,day=parseInt(RegExp.$3),hour=parseInt(RegExp.$4),min=parseInt(RegExp.$5),sec=parseInt(RegExp.$6),d=new Date(Date.UTC(year,month,day,hour,min,sec));return~~(d/1e3)}throw"unsupported format: "+s},KJUR.jws.IntDate.getNow=function(){var d=~~(new Date/1e3);return d},KJUR.jws.IntDate.intDate2UTCString=function(intDate){var d=new Date(1e3*intDate);return d.toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(intDate){var d=new Date(1e3*intDate),year=("0000"+d.getUTCFullYear()).slice(-4),mon=("00"+(d.getUTCMonth()+1)).slice(-2),day=("00"+d.getUTCDate()).slice(-2),hour=("00"+d.getUTCHours()).slice(-2),min=("00"+d.getUTCMinutes()).slice(-2),sec=("00"+d.getUTCSeconds()).slice(-2);return year+mon+day+hour+min+sec+"Z"},function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}function lib$es6$promise$utils$$isFunction(x){return"function"==typeof x}function lib$es6$promise$utils$$isMaybeThenable(x){return"object"==typeof x&&null!==x}function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}function lib$es6$promise$asap$$useNextTick(){return function(){process.nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0,observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=lib$es6$promise$asap$$flush,function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}function lib$es6$promise$asap$$flush(){for(var i=0;lib$es6$promise$asap$$len>i;i+=2){var callback=lib$es6$promise$asap$$queue[i],arg=lib$es6$promise$asap$$queue[i+1];callback(arg),lib$es6$promise$asap$$queue[i]=void 0,lib$es6$promise$asap$$queue[i+1]=void 0}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertx(){try{var r=require,vertx=r("vertx");return lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext,lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}function lib$es6$promise$$internal$$noop(){}function lib$es6$promise$$internal$$selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){return lib$es6$promise$$internal$$GET_THEN_ERROR.error=error,lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=!1,error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?lib$es6$promise$$internal$$resolve(promise,value):lib$es6$promise$$internal$$fulfill(promise,value))},function(reason){sealed||(sealed=!0,lib$es6$promise$$internal$$reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));!sealed&&error&&(sealed=!0,lib$es6$promise$$internal$$reject(promise,error))},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){thenable._state===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,thenable._result):thenable._state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,thenable._result):lib$es6$promise$$internal$$subscribe(thenable,void 0,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor)lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable);else{var then=lib$es6$promise$$internal$$getThen(maybeThenable);then===lib$es6$promise$$internal$$GET_THEN_ERROR?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error):void 0===then?lib$es6$promise$$internal$$fulfill(promise,maybeThenable):lib$es6$promise$utils$$isFunction(then)?lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then):lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}function lib$es6$promise$$internal$$resolve(promise,value){promise===value?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFulfillment()):lib$es6$promise$utils$$objectOrFunction(value)?lib$es6$promise$$internal$$handleMaybeThenable(promise,value):lib$es6$promise$$internal$$fulfill(promise,value)}function lib$es6$promise$$internal$$publishRejection(promise){promise._onerror&&promise._onerror(promise._result),lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._result=value,promise._state=lib$es6$promise$$internal$$FULFILLED,0!==promise._subscribers.length&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise))}function lib$es6$promise$$internal$$reject(promise,reason){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._state=lib$es6$promise$$internal$$REJECTED,promise._result=reason,lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise))}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers,length=subscribers.length;parent._onerror=null,subscribers[length]=child,subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment,subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection,0===length&&parent._state&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child,callback,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){return lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e,lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var value,error,succeeded,failed,hasCallback=lib$es6$promise$utils$$isFunction(callback);if(hasCallback){if(value=lib$es6$promise$$internal$$tryCatch(callback,detail),value===lib$es6$promise$$internal$$TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,promise===value)return void lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==lib$es6$promise$$internal$$PENDING||(hasCallback&&succeeded?lib$es6$promise$$internal$$resolve(promise,value):failed?lib$es6$promise$$internal$$reject(promise,error):settled===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,value):settled===lib$es6$promise$$internal$$REJECTED&&lib$es6$promise$$internal$$reject(promise,value))}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$enumerator$$Enumerator(Constructor,input){var enumerator=this;enumerator._instanceConstructor=Constructor,enumerator.promise=new Constructor(lib$es6$promise$$internal$$noop),enumerator._validateInput(input)?(enumerator._input=input,enumerator.length=input.length,enumerator._remaining=input.length,enumerator._init(),0===enumerator.length?lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result):(enumerator.length=enumerator.length||0,enumerator._enumerate(),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result))):lib$es6$promise$$internal$$reject(enumerator.promise,enumerator._validationError())}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}function lib$es6$promise$promise$race$$race(entries){function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries))return lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race.")),promise;for(var length=entries.length,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),void 0,onFulfillment,onRejection);return promise}function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$resolve(promise,object),promise}function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$reject(promise,reason),promise}function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++,this._state=void 0,this._result=void 0,this._subscribers=[],lib$es6$promise$$internal$$noop!==resolver&&(lib$es6$promise$utils$$isFunction(resolver)||lib$es6$promise$promise$$needsResolver(),this instanceof lib$es6$promise$promise$$Promise||lib$es6$promise$promise$$needsNew(),lib$es6$promise$$internal$$initializePromise(this,resolver))}function lib$es6$promise$polyfill$$polyfill(){var local;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;(!P||"[object Promise]"!==Object.prototype.toString.call(P.resolve())||P.cast)&&(local.Promise=lib$es6$promise$promise$$default)}var lib$es6$promise$utils$$_isArray;lib$es6$promise$utils$$_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var lib$es6$promise$asap$$vertxNext,lib$es6$promise$asap$$customSchedulerFn,lib$es6$promise$asap$$scheduleFlush,lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray,lib$es6$promise$asap$$len=0,lib$es6$promise$asap$$asap=({}.toString,function(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback,lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg,lib$es6$promise$asap$$len+=2,2===lib$es6$promise$asap$$len&&(lib$es6$promise$asap$$customSchedulerFn?lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush):lib$es6$promise$asap$$scheduleFlush())}),lib$es6$promise$asap$$browserWindow="undefined"!=typeof window?window:void 0,lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{},lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver,lib$es6$promise$asap$$isNode="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),lib$es6$promise$asap$$isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,lib$es6$promise$asap$$queue=new Array(1e3);lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$isNode?lib$es6$promise$asap$$useNextTick():lib$es6$promise$asap$$BrowserMutationObserver?lib$es6$promise$asap$$useMutationObserver():lib$es6$promise$asap$$isWorker?lib$es6$promise$asap$$useMessageChannel():void 0===lib$es6$promise$asap$$browserWindow&&"function"==typeof require?lib$es6$promise$asap$$attemptVertx():lib$es6$promise$asap$$useSetTimeout();var lib$es6$promise$$internal$$PENDING=void 0,lib$es6$promise$$internal$$FULFILLED=1,lib$es6$promise$$internal$$REJECTED=2,lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject,lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;lib$es6$promise$enumerator$$Enumerator.prototype._validateInput=function(input){return lib$es6$promise$utils$$isArray(input)},lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},lib$es6$promise$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){for(var enumerator=this,length=enumerator.length,promise=enumerator.promise,input=enumerator._input,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)enumerator._eachEntry(input[i],i);
},lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var enumerator=this,c=enumerator._instanceConstructor;lib$es6$promise$utils$$isMaybeThenable(entry)?entry.constructor===c&&entry._state!==lib$es6$promise$$internal$$PENDING?(entry._onerror=null,enumerator._settledAt(entry._state,i,entry._result)):enumerator._willSettleAt(c.resolve(entry),i):(enumerator._remaining--,enumerator._result[i]=entry)},lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var enumerator=this,promise=enumerator.promise;promise._state===lib$es6$promise$$internal$$PENDING&&(enumerator._remaining--,state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,value):enumerator._result[i]=value),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(promise,enumerator._result)},lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,void 0,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all,lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race,lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve,lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject,lib$es6$promise$promise$$counter=0,lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default,lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default,lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default,lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default,lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler,lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap,lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap,lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this,state=parent._state;if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection)return this;var child=new this.constructor(lib$es6$promise$$internal$$noop),result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection);return child},"catch":function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill,lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};"function"==typeof define&&define.amd?define(function(){return lib$es6$promise$umd$$ES6Promise}):"undefined"!=typeof module&&module.exports?module.exports=lib$es6$promise$umd$$ES6Promise:"undefined"!=typeof this&&(this.ES6Promise=lib$es6$promise$umd$$ES6Promise),lib$es6$promise$polyfill$$default()}.call(this),_httpRequest=new DefaultHttpRequest,_promiseFactory=new DefaultPromiseFactory,OidcClient.parseOidcResult=parseOidcResult,OidcClient.prototype.loadMetadataAsync=function(){log("OidcClient.loadMetadataAsync");var settings=this._settings;return settings.metadata?_promiseFactory.resolve(settings.metadata):settings.authority?getJson(settings.authority).then(function(metadata){return settings.metadata=metadata,metadata},function(err){return error("Failed to load metadata ("+err.message+")")}):error("No authority configured")},OidcClient.prototype.loadX509SigningKeyAsync=function(){function getKeyAsync(jwks){if(!jwks.keys||!jwks.keys.length)return error("Signing keys empty");var key=jwks.keys[0];return"RSA"!==key.kty?error("Signing key not RSA"):key.x5c&&key.x5c.length?_promiseFactory.resolve(key.x5c[0]):error("RSA keys empty")}log("OidcClient.loadX509SigningKeyAsync");var settings=this._settings;return settings.jwks?getKeyAsync(settings.jwks):this.loadMetadataAsync().then(function(metadata){return metadata.jwks_uri?getJson(metadata.jwks_uri).then(function(jwks){return settings.jwks=jwks,getKeyAsync(jwks)},function(err){return error("Failed to load signing keys ("+err.message+")")}):error("Metadata does not contain jwks_uri")})},OidcClient.prototype.loadUserProfile=function(access_token){return log("OidcClient.loadUserProfile"),this.loadMetadataAsync().then(function(metadata){return metadata.userinfo_endpoint?getJson(metadata.userinfo_endpoint,access_token):_promiseFactory.reject(Error("Metadata does not contain userinfo_endpoint"))})},OidcClient.prototype.loadAuthorizationEndpoint=function(){return log("OidcClient.loadAuthorizationEndpoint"),this._settings.authorization_endpoint?_promiseFactory.resolve(this._settings.authorization_endpoint):this._settings.authority?this.loadMetadataAsync().then(function(metadata){return metadata.authorization_endpoint?metadata.authorization_endpoint:error("Metadata does not contain authorization_endpoint")}):error("No authorization_endpoint configured")},OidcClient.prototype.createTokenRequestAsync=function(){log("OidcClient.createTokenRequestAsync");var client=this,settings=client._settings;return client.loadAuthorizationEndpoint().then(function(authorization_endpoint){var state=rand(),url=authorization_endpoint+"?state="+encodeURIComponent(state);if(client.isOidc){var nonce=rand();url+="&nonce="+encodeURIComponent(nonce)}var required=["client_id","redirect_uri","response_type","scope"];required.forEach(function(key){var value=settings[key];value&&(url+="&"+key+"="+encodeURIComponent(value))});var optional=["prompt","display","max_age","ui_locales","id_token_hint","login_hint","acr_values"];optional.forEach(function(key){var value=settings[key];value&&(url+="&"+key+"="+encodeURIComponent(value))});var request_state={oidc:client.isOidc,oauth:client.isOAuth,state:state};return nonce&&(request_state.nonce=nonce),settings.request_state_store.setItem(settings.request_state_key,JSON.stringify(request_state)),{request_state:request_state,url:url}})},OidcClient.prototype.createLogoutRequestAsync=function(id_token_hint){log("OidcClient.createLogoutRequestAsync");var settings=this._settings;return this.loadMetadataAsync().then(function(metadata){if(!metadata.end_session_endpoint)return error("No end_session_endpoint in metadata");var url=metadata.end_session_endpoint;return id_token_hint&&settings.post_logout_redirect_uri&&(url+="?post_logout_redirect_uri="+encodeURIComponent(settings.post_logout_redirect_uri),url+="&id_token_hint="+encodeURIComponent(id_token_hint)),url})},OidcClient.prototype.validateIdTokenAsync=function(id_token,nonce,access_token){log("OidcClient.validateIdTokenAsync");var client=this,settings=client._settings;return client.loadX509SigningKeyAsync().then(function(cert){var jws=new KJUR.jws.JWS;if(jws.verifyJWSByPemX509Cert(id_token,cert)){var id_token_contents=JSON.parse(jws.parsedJWS.payloadS);return nonce!==id_token_contents.nonce?error("Invalid nonce"):client.loadMetadataAsync().then(function(metadata){if(id_token_contents.iss!==metadata.issuer)return error("Invalid issuer");if(id_token_contents.aud!==settings.client_id)return error("Invalid audience");var now=parseInt(Date.now()/1e3),diff=now-id_token_contents.iat;return diff>300?error("Token issued too long ago"):id_token_contents.exp<now?error("Token expired"):access_token&&settings.load_user_profile?client.loadUserProfile(access_token,id_token_contents).then(function(profile){return copy(profile,id_token_contents)}):id_token_contents})}return error("JWT failed to validate")})},OidcClient.prototype.validateAccessTokenAsync=function(id_token_contents,access_token){if(log("OidcClient.validateAccessTokenAsync"),!id_token_contents.at_hash)return error("No at_hash in id_token");var hash=KJUR.crypto.Util.sha256(access_token),left=hash.substr(0,hash.length/2),left_b64u=hextob64u(left);return left_b64u!==id_token_contents.at_hash?error("at_hash failed to validate"):_promiseFactory.resolve()},OidcClient.prototype.validateIdTokenAndAccessTokenAsync=function(id_token,nonce,access_token){log("OidcClient.validateIdTokenAndAccessTokenAsync");var client=this;return client.validateIdTokenAsync(id_token,nonce,access_token).then(function(id_token_contents){return client.validateAccessTokenAsync(id_token_contents,access_token).then(function(){return id_token_contents})})},OidcClient.prototype.processResponseAsync=function(queryString){log("OidcClient.processResponseAsync");var client=this,settings=client._settings,request_state=settings.request_state_store.getItem(settings.request_state_key);if(settings.request_state_store.removeItem(settings.request_state_key),!request_state)return error("No request state loaded");if(request_state=JSON.parse(request_state),!request_state)return error("No request state loaded");if(!request_state.state)return error("No state loaded");var result=parseOidcResult(queryString);if(!result)return error("No OIDC response");if(result.error)return error(result.error);if(result.state!==request_state.state)return error("Invalid state");if(request_state.oidc){if(!result.id_token)return error("No identity token");if(!request_state.nonce)return error("No nonce loaded")}if(request_state.oauth){if(!result.access_token)return error("No access token");if(!result.token_type||"bearer"!==result.token_type.toLowerCase())return error("Invalid token type");if(!result.expires_in)return error("No token expiration")}var promise=_promiseFactory.resolve();return request_state.oidc&&request_state.oauth?promise=client.validateIdTokenAndAccessTokenAsync(result.id_token,request_state.nonce,result.access_token):request_state.oidc&&(promise=client.validateIdTokenAsync(result.id_token,request_state.nonce)),promise.then(function(profile){if(profile&&settings.filter_protocol_claims){var remove=["nonce","at_hash","iat","nbf","exp","aud","iss"];remove.forEach(function(key){delete profile[key]})}return{profile:profile,id_token:result.id_token,access_token:result.access_token,expires_in:result.expires_in,scope:result.scope,session_state:result.session_state}})},window.OidcClient=OidcClient}();var _httpRequest=new DefaultHttpRequest,_promiseFactory=new DefaultPromiseFactory;Token.fromResponse=function(response){if(response.access_token){var now=parseInt(Date.now()/1e3);response.expires_at=now+parseInt(response.expires_in)}return new Token(response)},Token.fromJSON=function(json){if(json)try{var obj=JSON.parse(json);return new Token(obj)}catch(e){}return new Token(null)},Token.prototype.toJSON=function(){return JSON.stringify({profile:this.profile,id_token:this.id_token,access_token:this.access_token,expires_at:this.expires_at,scope:this.scopes.join(" "),session_state:this.session_state})},FrameLoader.prototype.loadAsync=function(url){return url=url||this.url,url?_promiseFactory.create(function(resolve,reject){function cleanup(){window.removeEventListener("message",message,!1),handle&&window.clearTimeout(handle),handle=null,window.document.body.removeChild(frame)}function cancel(e){cleanup(),reject()}function message(e){handle&&e.origin===location.protocol+"//"+location.host&&e.source==frame.contentWindow&&(cleanup(),resolve(e.data))}var frame=window.document.createElement("iframe");frame.style.display="none";var handle=window.setTimeout(cancel,5e3);window.addEventListener("message",message,!1),window.document.body.appendChild(frame),frame.src=url}):_promiseFactory.reject("No url provided")},TokenManager.setPromiseFactory=function(promiseFactory){_promiseFactory=promiseFactory},TokenManager.setHttpRequest=function(httpRequest){if("object"!=typeof httpRequest||"function"!=typeof httpRequest.getJSON)throw Error("The provided value is not a valid http request.");_httpRequest=httpRequest},TokenManager.prototype._callTokenRemoved=function(){this._callbacks.tokenRemovedCallbacks.forEach(function(cb){cb()})},TokenManager.prototype._callTokenExpiring=function(){this._callbacks.tokenExpiringCallbacks.forEach(function(cb){cb()})},TokenManager.prototype._callTokenExpired=function(){this._callbacks.tokenExpiredCallbacks.forEach(function(cb){cb()})},TokenManager.prototype._callTokenObtained=function(){this._callbacks.tokenObtainedCallbacks.forEach(function(cb){cb()})},TokenManager.prototype._callSilentTokenRenewFailed=function(){this._callbacks.silentTokenRenewFailedCallbacks.forEach(function(cb){cb()})},TokenManager.prototype.saveToken=function(token){!token||token instanceof Token||(token=Token.fromResponse(token)),this._token=token,this._settings.persist&&!this.expired?this._settings.store.setItem(this._settings.persistKey,token.toJSON()):this._settings.store.removeItem(this._settings.persistKey),token?this._callTokenObtained():this._callTokenRemoved()},TokenManager.prototype.addOnTokenRemoved=function(cb){this._callbacks.tokenRemovedCallbacks.push(cb)},TokenManager.prototype.addOnTokenObtained=function(cb){this._callbacks.tokenObtainedCallbacks.push(cb)},TokenManager.prototype.addOnTokenExpiring=function(cb){this._callbacks.tokenExpiringCallbacks.push(cb)},TokenManager.prototype.addOnTokenExpired=function(cb){this._callbacks.tokenExpiredCallbacks.push(cb)},TokenManager.prototype.addOnSilentTokenRenewFailed=function(cb){this._callbacks.silentTokenRenewFailedCallbacks.push(cb)},TokenManager.prototype.removeToken=function(){this.saveToken(null)},TokenManager.prototype.redirectForToken=function(){var oidc=this.oidcClient;oidc.createTokenRequestAsync().then(function(request){window.location=request.url},function(err){console.error("TokenManager.redirectForToken error: "+(err&&err.message||err||""))})},TokenManager.prototype.redirectForLogout=function(){var mgr=this;mgr.oidcClient.createLogoutRequestAsync(mgr.id_token).then(function(url){mgr.removeToken(),window.location=url},function(err){console.error("TokenManager.redirectForLogout error: "+(err&&err.message||err||""))})},TokenManager.prototype.processTokenCallbackAsync=function(queryString){var mgr=this;return mgr.oidcClient.processResponseAsync(queryString).then(function(token){mgr.saveToken(token)})},TokenManager.prototype.renewTokenSilentAsync=function(){var mgr=this;if(!mgr._settings.silent_redirect_uri)return _promiseFactory.reject("silent_redirect_uri not configured");var settings=copy(mgr._settings);settings.redirect_uri=settings.silent_redirect_uri,settings.prompt="none";var oidc=new OidcClient(settings);return oidc.createTokenRequestAsync().then(function(request){var frame=new FrameLoader(request.url);return frame.loadAsync().then(function(hash){return oidc.processResponseAsync(hash).then(function(token){mgr.saveToken(token)})})})},TokenManager.prototype.processTokenCallbackSilent=function(hash){if(window.parent&&window!==window.parent){var hash=hash||window.location.hash;hash&&window.parent.postMessage(hash,location.protocol+"//"+location.host)}},TokenManager.prototype.openPopupForTokenAsync=function(popupSettings){function cleanup(name){handle&&window.clearInterval(handle),popup.close(),delete mgr._pendingPopup,name&&delete window[name]}function checkClosed(){popup.window||(cleanup(),reject_popup(Error({msg:"Popup closed"})))}popupSettings=popupSettings||{},popupSettings.features=popupSettings.features||"location=no,toolbar=no",popupSettings.target=popupSettings.target||"_blank";var callback_prefix="tokenmgr_callback_";window.openPopupForTokenAsyncCallback||(window.openPopupForTokenAsyncCallback=function(hash){var result=OidcClient.parseOidcResult(hash);result&&result.state&&window[callback_prefix+result.state]&&window[callback_prefix+result.state](hash)});var mgr=this,settings=copy(mgr._settings);if(settings.redirect_uri=settings.popup_redirect_uri||settings.redirect_uri,mgr._pendingPopup)return _promiseFactory.create(function(resolve,reject){reject(Error("Already a pending popup token request."))});var popup=window.open(settings.redirect_uri,popupSettings.target,popupSettings.features);if(!popup)return _promiseFactory.create(function(resolve,reject){reject(Error("Error opening popup."))});mgr._pendingPopup=!0;var reject_popup,handle=window.setInterval(checkClosed,1e3);return _promiseFactory.create(function(resolve,reject){reject_popup=reject;var oidc=new OidcClient(settings);oidc.createTokenRequestAsync().then(function(request){function redirectPopup(){popup.setUrl?popup.setUrl(request.url):total_times>count?(count++,window.setTimeout(redirectPopup,interval)):(cleanup(callback_name),reject(Error("Timeout error on popup")))}var callback_name=callback_prefix+request.request_state.state;window[callback_name]=function(hash){cleanup(callback_name),oidc.processResponseAsync(hash).then(function(token){mgr.saveToken(token),resolve()},function(err){reject(err)})};var seconds_to_wait=5,interval=500,total_times=1e3*seconds_to_wait/interval,count=0;redirectPopup()},function(err){cleanup(),reject(err)})})},TokenManager.prototype.processTokenPopup=function(hash){hash=hash||window.location.hash,window.setUrl=function(url){window.location=url},hash&&window.opener.openPopupForTokenAsyncCallback(hash)},window.OidcTokenManager=TokenManager}();